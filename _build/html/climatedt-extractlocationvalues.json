{"version":2,"kind":"Notebook","sha256":"19ab6a905f09e1c7126c8b69108ba7f9b01485871f5da1cc9d0da950b832611e","slug":"climatedt-extractlocationvalues","location":"/production/HDA/DestinE_Digital_Twins/ClimateDT-ExtractLocationValues.ipynb","dependencies":[],"frontmatter":{"title":"HDA Extract Location Values - Tutorial","subtitle":"This notebook provides a hands-on introduction to working with data from the Destination Earth Climate Digital Twin (DT).","tags":["HDA","ECMWF","Digital Twin"],"copyright":"Â© 2025 EUMETSAT","authors":[{"id":"Author: Eumetsat","name":"Author: Eumetsat"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"ClimateDT-ExtractLocationValues.ipynb","url":"/build/ClimateDT-ExtractLoc-e54730e06a4c8abcc15405fe3bf9d8f9.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ClimateDT-ParameterPlotter.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"ðŸš€ Launch in JupyterHub","key":"eEi7iX5acA"}],"key":"Dem9b1GwCV"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ClimateDT-ParameterPlotter.ipynb","key":"tauVYi4Mwr"}],"key":"aLDBqbPiO1"}],"key":"ScXiiSHKC9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Is it going to rain in the next 3 weekends?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TxKf2jNXH6"}],"identifier":"is-it-going-to-rain-in-the-next-3-weekends","label":"Is it going to rain in the next 3 weekends?","html_id":"is-it-going-to-rain-in-the-next-3-weekends","implicit":true,"key":"EkyjP3VYGU"}],"key":"I9pfkWlpZB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook provides a hands-on introduction to working with data from the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Nqw1GvOgCM"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Destination Earth Climate Digital Twin (DT).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qIH6nzD7Li"}],"key":"l4D6pNtZp0"},{"type":"text","value":"\nThe goal is to give you a quick taste of how to access, explore, and handle DT data. Itâ€™s not meant to be a scientific study, but rather an accessible walkthrough that highlights some of the possibilities the data offers.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y4cgNwqjb0"}],"key":"kByKAf42l0"},{"type":"blockquote","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"â€œA simple question with local impact: will it rain here soon?â€","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hLBqWfmtV6"}],"key":"Wq2e3J8mAx"}],"key":"gwUVVlJh8i"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"In this exercise we will:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"J6jGz7dqUZ"}],"key":"XeU9BmXsaa"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Select the right variable/scenario from the Climate DT in order to have precipitation forecasts.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"pRJe5kPscV"}],"key":"OflXmhy6GW"}],"key":"jYPm4sZHDX"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Order the Climate DT data","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"yt93uKlffU"}],"key":"rBUj3YLadW"}],"key":"Lz2sbGF7iz"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Extract values for your place location.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gtfPbxwedG"}],"key":"xWdUCmCBSR"}],"key":"dpXkxT2cRF"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Aggregate rainfall totals over each weekend and report the answer in text and in a plot","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zYUf4GTMe7"}],"key":"K40tLGTEU8"}],"key":"fNmvrffKjM"}],"key":"ZmN2jVBvpy"}],"key":"l8kRApvtua"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fQAgDBj5bk"}],"identifier":"setup","label":"Setup","html_id":"setup","implicit":true,"key":"nXyoahXdfO"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Letâ€™s import useful packages","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ku1nFis83w"}],"key":"xvO13vFF9i"}],"key":"EADlLo6HuJ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import destinelab as deauth\nimport json\nimport importlib\nimport importlib.metadata as metadata\nimport requests\nfrom requests.adapters import HTTPAdapter\nimport os\nfrom getpass import getpass\nfrom tqdm import tqdm\nimport time\nfrom urllib.parse import unquote\nfrom time import sleep\nfrom IPython.display import JSON\nimport sys\nfrom packaging import version\nfrom IPython.display import display, HTML\nfrom datetime import datetime, timedelta\nimport pandas as pd\nimport xarray as xr\nimport matplotlib.pyplot as plt","visibility":"show","key":"rYx4rpDC2z"},{"type":"output","id":"Sf3G_yXDpzgm0lz7xk75h","data":[],"visibility":"show","key":"tKkp8lOqpy"}],"visibility":"show","key":"UfbnG65arh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1 - Select the right variable/scenario from the Climate DT in order to have precipitation forecasts.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tw4spIQtld"}],"identifier":"id-1-select-the-right-variable-scenario-from-the-climate-dt-in-order-to-have-precipitation-forecasts","label":"1 - Select the right variable/scenario from the Climate DT in order to have precipitation forecasts.","html_id":"id-1-select-the-right-variable-scenario-from-the-climate-dt-in-order-to-have-precipitation-forecasts","implicit":true,"key":"sgOtAqRxiW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"seqk0d5a3Y"},{"type":"crossReference","url":"/climatedt-parameterplotter","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Simulation Selection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kZ7C05h8yK"}],"urlSource":"ClimateDT-ParameterPlotter.ipynb#Scenario-Simulation-Selection","dataUrl":"/climatedt-parameterplotter.json","identifier":"scenario-simulation-selection","label":"Scenario-Simulation-Selection","remote":true,"protocol":"file","key":"fuGGgAQO0a"},{"type":"text","value":" to select the desired scenario simulation for Climate DT data and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WrGhC67vlt"},{"type":"crossReference","url":"/climatedt-parameterplotter","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Parameter Selection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rXlAMnG54H"}],"urlSource":"ClimateDT-ParameterPlotter.ipynb#Parameter-Selection","dataUrl":"/climatedt-parameterplotter.json","identifier":"parameter-selection","label":"Parameter-Selection","remote":true,"protocol":"file","key":"bfkM91tuDN"},{"type":"text","value":" to select the total precipitation  variable for the selected scenario.\nWe then need to select our time range of interest starting from the next Friday.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f72JrRMLY9"}],"key":"vy6vIvlyQG"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The selection will give you the json payload to place the order via HDA.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FcEnc3mDYf"}],"key":"MR6C7sg2uz"}],"key":"S0wqFQswQX"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"order_body={\n'ecmwf:resolution': 'high',\n 'ecmwf:model': 'IFS-NEMO',\n 'ecmwf:type': 'fc',\n 'ecmwf:dataset': 'climate-dt',\n 'ecmwf:param': '228',\n 'ecmwf:levtype': 'sfc',\n 'ecmwf:expver': '0001',\n 'ecmwf:date': '20251002/to/20251020',\n 'ecmwf:realization': '1',\n 'ecmwf:activity': 'ScenarioMIP',\n 'ecmwf:class': 'd1',\n 'ecmwf:stream': 'clte',\n 'ecmwf:time': '2300',\n 'ecmwf:experiment': 'SSP3-7.0',\n 'ecmwf:generation': '1'}\n\n","visibility":"show","key":"lRrFXW7ena"},{"type":"output","id":"S9EVevDkgXQ1ALgJHaa3q","data":[],"visibility":"show","key":"ispSZlFUNS"}],"visibility":"show","key":"TooYrAWxDp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To place the order we need to authenticate using our DESP account","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LC0MapJslp"}],"key":"kY08ialDE3"}],"key":"M1Epyxc2iJ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"Av91Ya8JCW"},{"type":"output","id":"j56HgmU9PySDxGNKpFtjf","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username:  eum-dedl-user\nPlease input your DESP password:  Â·Â·Â·Â·Â·Â·Â·Â·\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"PEeVZpsNzo"}],"visibility":"show","key":"S57lFJfuFV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check if we can access DT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CTnc2BUEi6"}],"key":"GhN0Q058ny"}],"key":"McKmxzABx9"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"installed_version = importlib.metadata.version(\"destinelab\")\nversion_number = installed_version.split('.')[1]\n\ncond1 = int(version_number) >= 8 \ncond2 = float(installed_version) < 1\ncond3 = float(installed_version) >= 1\n\nif (cond1 and cond2) or cond3:\n    auth.is_DTaccess_allowed(access_token)","visibility":"show","key":"CaANV6vvPz"},{"type":"output","id":"2p3o9CPaDhPc04iWcUUMS","data":[{"name":"stdout","output_type":"stream","text":"DT Output access allowed\n"}],"visibility":"show","key":"rnPnzmY0A7"}],"visibility":"show","key":"VsRXqGVmnj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2 - Order the Climate DT data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P56URIIvax"}],"identifier":"id-2-order-the-climate-dt-data","label":"2 - Order the Climate DT data","html_id":"id-2-order-the-climate-dt-data","implicit":true,"key":"mpDWfAHSrv"}],"key":"pLyBkLgkyX"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"\nCOLLECTION_ID=\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\"","visibility":"show","key":"ik0N5Eaptb"},{"type":"output","id":"u2BD7F1j-s8cIt9GgYqhv","data":[],"visibility":"show","key":"BdbHOa0SX4"}],"visibility":"show","key":"LUAvn5UZ5I"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json=order_body, headers=auth_headers)\n\nif response.status_code != 200:\n    print(response.content)\nresponse.raise_for_status()\n\nordered_item = response.json()\n\nproduct_id = ordered_item[\"id\"]\nstorage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\norder_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\nfederation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\nprint(f\"Product ordered: {product_id}\")\nprint(f\"Provider: {federation_backend}\")\nprint(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\nprint(f\"Order status: {order_status}\")    ","visibility":"show","key":"EzJAHRcgfM"},{"type":"output","id":"IZS0e7K8GcNOTxZFwTjW8","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: 4aaac2fd-8036-497e-8ba2-dbabf48cedd4\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\n"}],"visibility":"show","key":"XO3zNEL3dc"}],"visibility":"show","key":"U4mnnq2Gwo"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\nself_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\nitem = {}\n\nfor i in range(0, TIMEOUT, STEP):\n    print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n    response = requests.get(self_url, headers=auth_headers)\n    if response.status_code != 200:\n        print(response.content)\n    response.raise_for_status()\n    item = response.json()\n\n    storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n    if storage_tier == ONLINE_STATUS:\n        download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n        print(\"Product is ready to be downloaded.\")\n        print(f\"Asset URL: {download_url}\")\n        break\n\n    start = time.perf_counter()\n    while time.perf_counter() - start < 1:\n        pass  # do nothing for ~1 second\nelse:\n    order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n    print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")","visibility":"show","key":"xu9RPuwvmK"},{"type":"output","id":"Hwyj_ecYeotfK9hSmIxJl","data":[{"name":"stdout","output_type":"stream","text":"Polling 1/300\nPolling 2/300\nPolling 3/300\nPolling 4/300\nPolling 5/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.lumi.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/4aaac2fd-8036-497e-8ba2-dbabf48cedd4/downloadLink\n"}],"visibility":"show","key":"EdyTAdftS6"}],"visibility":"show","key":"wJD9sneTBL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.get(download_url, stream=True, headers=auth_headers)\nresponse.raise_for_status()\n\ncontent_disposition = response.headers.get('Content-Disposition')\ntotal_size = int(response.headers.get(\"content-length\", 0))\nif content_disposition:\n    filename = content_disposition.split('filename=')[1].strip('\"')\n    filename = unquote(filename)\nelse:\n    filename = os.path.basename(self_url)\n\n# Open a local file in binary write mode and write the content\nprint(f\"downloading {filename}\")\n\nwith tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n    with open(filename, 'wb') as f:\n        for data in response.iter_content(1024):\n            progress_bar.update(len(data))\n            f.write(data)","visibility":"show","key":"BmQWcUR6Lf"},{"type":"output","id":"pEqtSoMsr_heI8vmjvFTT","data":[{"name":"stdout","output_type":"stream","text":"downloading 4aaac2fd-8036-497e-8ba2-dbabf48cedd4.grib\n"},{"name":"stderr","output_type":"stream","text":"253MB [00:06, 36.5MB/s] \n"}],"visibility":"show","key":"OHngstK9Iv"}],"visibility":"show","key":"Gf60msOoB8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3 - Extract values for your place location","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A3MONkgKgZ"}],"identifier":"id-3-extract-values-for-your-place-location","label":"3 - Extract values for your place location","html_id":"id-3-extract-values-for-your-place-location","implicit":true,"key":"WLINs4KLgF"}],"key":"lDTT0S1Qmy"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#Riga\nyour_place_lon= 24.11\nyour_place_lat= 56.95","visibility":"show","key":"xgGGmEHnN9"},{"type":"output","id":"4VNUWnNA7PP1GS2iq0uFd","data":[],"visibility":"show","key":"REjP8K04gx"}],"visibility":"show","key":"bzE0K7QlBR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#London\nyour_place_lon= -0.128\nyour_place_lat= 51.508","key":"y90GMnVlxt"},{"type":"output","id":"HY9blqaiPeSl_Ld-JahBG","data":[],"key":"QEzX62JKHK"}],"key":"qlK8Bkc80l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Darmstad\nyour_place_lon= 8.65\nyour_place_lat=49.88","key":"l51g4gNQx3"},{"type":"output","id":"kNTL0IAPGHEy8SddwZatn","data":[],"key":"h1sXH6IDVn"}],"key":"kDrS33gRwN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Milan\nyour_place_lon= 9.25\nyour_place_lat=45.46","key":"Ehx4yzilsA"},{"type":"output","id":"oW5WWaUHBna60bF5OBnb7","data":[],"key":"IhmcnGRiAG"}],"key":"G9qI3zQfsK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from earthkit.data import from_source\nimport earthkit.data as ekd\nfrom earthkit.geo import  nearest_point_kdtree\n\nds = from_source(\"file\",filename)\nds.ls()","key":"y3LSm0ZvTA"},{"type":"output","id":"adKR-bYGx8K7pcpgoCkq6","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>centre</th>\n      <th>shortName</th>\n      <th>typeOfLevel</th>\n      <th>level</th>\n      <th>dataDate</th>\n      <th>dataTime</th>\n      <th>stepRange</th>\n      <th>dataType</th>\n      <th>number</th>\n      <th>gridType</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251002</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251003</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251004</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251005</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251006</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251007</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251008</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251009</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251010</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251011</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251012</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251013</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251014</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251015</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251016</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251017</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251018</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251019</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>ecmf</td>\n      <td>tp</td>\n      <td>surface</td>\n      <td>0</td>\n      <td>20251020</td>\n      <td>2300</td>\n      <td>0-1</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>healpix</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   centre shortName typeOfLevel  level  dataDate  dataTime stepRange dataType  \\\n0    ecmf        tp     surface      0  20251002      2300       0-1       fc   \n1    ecmf        tp     surface      0  20251003      2300       0-1       fc   \n2    ecmf        tp     surface      0  20251004      2300       0-1       fc   \n3    ecmf        tp     surface      0  20251005      2300       0-1       fc   \n4    ecmf        tp     surface      0  20251006      2300       0-1       fc   \n5    ecmf        tp     surface      0  20251007      2300       0-1       fc   \n6    ecmf        tp     surface      0  20251008      2300       0-1       fc   \n7    ecmf        tp     surface      0  20251009      2300       0-1       fc   \n8    ecmf        tp     surface      0  20251010      2300       0-1       fc   \n9    ecmf        tp     surface      0  20251011      2300       0-1       fc   \n10   ecmf        tp     surface      0  20251012      2300       0-1       fc   \n11   ecmf        tp     surface      0  20251013      2300       0-1       fc   \n12   ecmf        tp     surface      0  20251014      2300       0-1       fc   \n13   ecmf        tp     surface      0  20251015      2300       0-1       fc   \n14   ecmf        tp     surface      0  20251016      2300       0-1       fc   \n15   ecmf        tp     surface      0  20251017      2300       0-1       fc   \n16   ecmf        tp     surface      0  20251018      2300       0-1       fc   \n17   ecmf        tp     surface      0  20251019      2300       0-1       fc   \n18   ecmf        tp     surface      0  20251020      2300       0-1       fc   \n\n   number gridType  \n0    None  healpix  \n1    None  healpix  \n2    None  healpix  \n3    None  healpix  \n4    None  healpix  \n5    None  healpix  \n6    None  healpix  \n7    None  healpix  \n8    None  healpix  \n9    None  healpix  \n10   None  healpix  \n11   None  healpix  \n12   None  healpix  \n13   None  healpix  \n14   None  healpix  \n15   None  healpix  \n16   None  healpix  \n17   None  healpix  \n18   None  healpix  ","content_type":"text/plain"}}}],"key":"BZ9RxNbjH6"}],"key":"nllPlUePUj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data as ekd\nfrom earthkit.geo import nearest_point_haversine\n\nlatlon = ds.to_latlon()\nlat = latlon[\"lat\"]\nlon = latlon[\"lon\"]\n\np_ref = (your_place_lat, your_place_lon)\nidx, dist = nearest_point_haversine(p_ref, (lat, lon))\nidx, dist","key":"ZplCpC63k0"},{"type":"output","id":"AfnS1IK9cROxoFJvRIXCZ","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"(array([750865]), array([3445.65461327]))","content_type":"text/plain"}}}],"key":"Hk0o3g18s6"}],"key":"VnQrFyGWUv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_xr=ds.to_xarray()\nsubset = ds_xr.isel(values=idx)","key":"EqMuFZemWE"},{"type":"output","id":"LUH2-X3TMqynZZhE2L0IW","data":[],"key":"zGAUaAh3pS"}],"key":"bPQpC9GVRI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subset","key":"sCtyl5yCX2"},{"type":"output","id":"BwsALcYprF6cAtWAE12CR","data":[],"key":"c1tz1xF2ay"}],"key":"QAoLNgKBEc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"weekends = pd.date_range(\"2025-10-02\", periods=3, freq=\"7D\")\n\nweekends","key":"DOCVRJiSRn"},{"type":"output","id":"MZA3Di50mNMtKFQsFdiTI","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"DatetimeIndex(['2025-10-02', '2025-10-09', '2025-10-16'], dtype='datetime64[ns]', freq='7D')","content_type":"text/plain"}}}],"key":"rKo85GqAVE"}],"key":"gYFCSKgI9O"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"results = {}\n\nfor start in weekends:\n    # Weekend = Sat (start) + Sun (start+1)\n    end = start + pd.Timedelta(days=1)\n    \n    weekend_data = subset.sel(forecast_reference_time=slice(start, end))\n    total_precip = weekend_data['tp'].sum().item()\n    \n    results[str(start.date())] = \"Rain\" if total_precip > 0.001 else \"No Rain\"\n\ndisplay(results)","visibility":"show","key":"ZuxdSACIY6"},{"type":"output","id":"QKMhVgPqNR9M5n3kIbbsA","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"{'2025-10-02': 'No Rain', '2025-10-09': 'No Rain', '2025-10-16': 'No Rain'}","content_type":"text/plain"}}}],"visibility":"show","key":"nSEeSecVbM"}],"visibility":"show","key":"lgnZZsJDB2"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Extract precipitation time series for your_place\ntp = subset.tp.astype(\"float32\") * 1000\nyour_place_precip = tp.to_pandas()\n\n# Plot only the period covering the 3 weekends\nplot_start = weekends[0]\nplot_end = weekends[-1] + pd.Timedelta(days=1)\nyour_place_precip = your_place_precip.loc[plot_start:plot_end]\n\n# Plot\nfig, ax = plt.subplots(figsize=(10, 4))\nyour_place_precip.plot(ax=ax, lw=2, color=\"blue\",marker=\"o\", label=\"tot\")\n\n# Highlight weekends\nfor start in weekends:\n    end = start + pd.Timedelta(days=1)\n    ax.axvspan(start, end, color=\"lightgray\", alpha=0.3, label=\"Weekend\" if start == weekends[0] else \"\")\n\nax.set_title(\"Precipitation Forecast for your_place (Next 3 Weekends)\")\nax.set_ylabel(\"Precipitation (mm)\")\nax.set_xlabel(\"Date\")\nax.legend()\nplt.show()","visibility":"show","key":"dqsbMdx1Zg"},{"type":"output","id":"guTQgXbFS7258lH8HBNNK","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"25d5b919ce0b9190c9b17d849d6d204d","path":"/build/25d5b919ce0b9190c9b17d849d6d204d.png"},"text/plain":{"content":"<Figure size 1000x400 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"EygvxghPWo"}],"visibility":"show","key":"slxgNGzHAH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"'''\n#Climate data are GRIB data defined on a HEALPix nested grid.\n#We can interpolate it in a regular latitude-longitude grid\n\nfrom earthkit.regrid import interpolate\nfrom earthkit.data import from_source\n\nds = from_source(\"file\",filename)\n\n# the target grid is a global 0.1x0.1 degree regular latitude-longitude grid\nout_grid = {\"grid\": [5,5]}\n\n# perform interpolation for each field and add results to a new fieldlist stored in memory\nr = interpolate(ds, out_grid=out_grid, method=\"linear\")\n\nd=r.to_xarray()\n'''","key":"yTBsvPvoao"},{"type":"output","id":"H1pDF_4UyIFZQGyis9GUC","data":[],"key":"tahgQIxsgB"}],"key":"cpIWdSRHlH"}],"key":"fYcQcW1Hvo"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}