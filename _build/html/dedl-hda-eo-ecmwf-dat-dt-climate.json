{"version":2,"kind":"Notebook","sha256":"c6417682836231090604bddd26b11a86087d88ab64523a4d30d6f121ea07f3e6","slug":"dedl-hda-eo-ecmwf-dat-dt-climate","location":"/production/HDA/DestinE_Digital_Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb","dependencies":[],"frontmatter":{"title":"Climate DT Parameter - Data Access using DEDL HDA","subtitle":"This notebook authenticates with the DestinE API, queries ECMWF Climate Digital Twin adaptation data based on ScenarioMIP parameters, downloads the selected forecast data using a robust retry mechanism, and visualizes it using EarthKit.","tags":["HDA","ECMWF","Authentication","Digital Twin"],"copyright":"漏 2025 EUMETSAT","authors":[{"id":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)","name":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb","url":"/build/DEDL-HDA-EO.ECMWF.DA-657c6e6d98fd450a5977d15cf9337f02.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":" Launch in JupyterHub","key":"vtuNshpkOv"}],"key":"qyBH3YkmZy"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb","key":"V2NLTft5Ol"}],"key":"lgaloioGhO"}],"key":"PtaOc0hMXS"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"Prerequisites:","key":"BbroSeOR85"}],"key":"j5gDkEwE8O"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DEDL data a ","key":"CKofMO5TJj"},{"type":"link","url":"https://platform.destine.eu/","children":[{"type":"text","value":"DestinE user account","key":"jt12BeTZnG"}],"urlSource":"https://platform.destine.eu/","key":"L9OQMq0ugF"},{"type":"text","value":" is needed","key":"rIpqzxT29y"}],"key":"ZRyhjHsRHo"}],"key":"CZHted813Y"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DT data an ","key":"wgzd19VvGc"},{"type":"link","url":"https://platform.destine.eu/support-pages/access-policy/","children":[{"type":"text","value":"upgraded access","key":"Ztle8SnDqk"}],"urlSource":"https://platform.destine.eu/support-pages/access-policy/","key":"iikOTXBLc0"},{"type":"text","value":" is needed.","key":"bAdULpivQM"}],"key":"EiB3ZOqVBn"}],"key":"cFQQ24FWUg"}],"key":"An30Tp1JNp"},{"type":"strong","children":[{"type":"text","value":"References:","key":"iJKS6vJKOO"}],"key":"S0TSZEiXiD"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","children":[{"type":"text","value":"DestinE Data Lake (DEDL) Harmonized Data Access (HDA) documentation","key":"r16XP5FvBp"}],"urlSource":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","key":"rASjVYbFUy"}],"key":"XLwA8RMySJ"}],"key":"TAJx56DHuE"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine.ecmwf.int/climate-change-adaptation-digital-twin-climate-dt/","children":[{"type":"text","value":"Climate Change Adaptation DT (Climate DT)","key":"NdLXI5c6jA"}],"urlSource":"https://destine.ecmwf.int/climate-change-adaptation-digital-twin-climate-dt/","key":"xCSRsWz0FM"}],"key":"raRWNxt16F"}],"key":"mlJ9iTwDLN"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://confluence.ecmwf.int/display/DDCZ/Climate+DT+Phase+1+data+catalogue","children":[{"type":"text","value":"Climate DT data catalogue","key":"LYQ8HMRWgF"}],"urlSource":"https://confluence.ecmwf.int/display/DDCZ/Climate+DT+Phase+1+data+catalogue","key":"W8FrDgXJaK"}],"key":"f70WnK8umN"}],"key":"FOZ7DmtJ4X"}],"key":"J4WvWzZ9qU"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"Y1G4HD7vov"}],"key":"Zt9tPxLNuu"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Earthkit and HDA Polytope used in this context are both packages provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"eoQqGYFyJJ"}],"key":"Zn1SzZZkg4"}],"key":"rUfFwTAKSv"}],"key":"HNa4O8axam"}],"key":"UAnDPIT7km"}],"key":"gTobVrBHgw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uCWbg35ZM4"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA (Harmonized Data Access)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ALEFBt4oeb"}],"key":"b7VQCkDcXW"},{"type":"text","value":" API to query and access Climate DT data to plot a parameter series.\nBelow the main steps covered by this tutorial.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kzC8UEFCY6"}],"key":"Hd9PIkNlxi"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zNFfSEOu3l"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_climate.ipynb-setup","label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb-Setup","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-ipynb-setup","key":"XZM4GxjVM4"},{"type":"text","value":": Import the required libraries.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"q6l75MtcUO"}],"key":"rNJE2X8MRg"}],"key":"Onug3guhCS"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"urfhLFV1zZ"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_climate.ipynb-order-and-download","label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb-Order-and-Download","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-ipynb-order-and-download","key":"pWLxf5Zccb"},{"type":"text","value":": How to filter and download Climate DT data.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OXsvKN7iwp"}],"key":"Q1n7c15Qnw"}],"key":"IICJ7GzKD7"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Plot","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SiiQ6pCUIr"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_climate.ipynb-earthkit","label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb-EarthKit","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-ipynb-earthkit","key":"Xr1KVw0PgV"},{"type":"text","value":": How to visualize hourly data on single levels data through Earthkit.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ymht5IKPHf"}],"key":"rxfiXIMODN"}],"key":"rzW8nMLKqI"}],"key":"jZNvwvckoJ"}],"key":"AFtxTrxFTL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gdYg6nPOEQ"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb-Setup","identifier":"dedl-hda-eo.ecmwf.dat.dt_climate.ipynb-setup","html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-ipynb-setup","key":"bXl6QjtRiH"}],"key":"KougwhS7E2"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import all the required packages.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Lvueyvnwtz"}],"key":"Jk9oJrUaW3"}],"visibility":"show","key":"L3Q2tl4yah"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import destinelab as deauth\nimport json\nimport datetime\nimport importlib.metadata\n\nimport requests\nfrom requests.adapters import HTTPAdapter\nfrom urllib3.util.retry import Retry\nimport os\nfrom getpass import getpass\nfrom tqdm import tqdm\nimport time\nfrom datetime import datetime\nfrom urllib.parse import unquote\nfrom time import sleep\nfrom IPython.display import JSON","visibility":"show","key":"skHTTVijaU"},{"type":"output","id":"wU73Rs-BoCPjAUxnqgiEg","data":[],"visibility":"show","key":"Po1VSXz0ci"}],"visibility":"show","key":"q3ZARIzpQA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zzHCnGOxYJ"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb-Order-and-Download","identifier":"dedl-hda-eo.ecmwf.dat.dt_climate.ipynb-order-and-download","html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-ipynb-order-and-download","key":"z8X6I7jhiN"}],"key":"Z4jzTQbXn7"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Obtain Authentication Token","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NNufXep2JG"}],"identifier":"obtain-authentication-token","label":"Obtain Authentication Token","html_id":"obtain-authentication-token","implicit":true,"key":"MpPB5ET3n8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To access data we need to be authenticated.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fQbAtMiLE4"}],"key":"lqfzFC205D"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Below how to request of an authentication token using the destinelab package.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"upBqjCDqnq"}],"key":"QGZbd8hB3p"}],"visibility":"show","key":"FQ98imJsbB"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"Fu701DfotG"},{"type":"output","id":"4X_jOE6wpMu5U_WjsKvIh","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username:  eum-dedl-user\nPlease input your DESP password:  路路路路路路路路\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"sPpHWehr2X"}],"visibility":"show","key":"VEWLsofXfe"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check if DT access is granted","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"afBoMqCWbA"}],"identifier":"check-if-dt-access-is-granted","label":"Check if DT access is granted","html_id":"check-if-dt-access-is-granted","implicit":true,"key":"RxKvUogyTb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If DT access is not granted, you will not be able to execute the rest of the notebook.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QnCGmCW3sg"}],"key":"kmpMOjtJtN"}],"visibility":"show","key":"d4xVfcxU3s"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import importlib\ninstalled_version = importlib.metadata.version(\"destinelab\")\nversion_number = installed_version.split('.')[1]\nif((int(version_number) >= 8 and float(installed_version) < 1) or float(installed_version) >= 1):\n    auth.is_DTaccess_allowed(access_token)","visibility":"show","key":"cGW3hZVY23"},{"type":"output","id":"j203IuaGhnk_Dpgv4x_cN","data":[{"name":"stdout","output_type":"stream","text":"DT Output access allowed\n"}],"visibility":"show","key":"kqjyTdWW9W"}],"visibility":"show","key":"cxTYPGgxEB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA Endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Eayx8MT3yV"}],"identifier":"hda-endpoint","label":"HDA Endpoint","html_id":"hda-endpoint","implicit":true,"key":"SOmPNZElSi"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HDA API is based on the Spatio Temporal Asset Catalog specification (STAC), it is convenient define a costant with its endpoint.\nAnd another one with the ID of the Cliamte DT collection.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BVhN2LPiIY"}],"key":"Mr8NiOXJvm"}],"key":"MTU9NyYaBR"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"\nCOLLECTION_ID=\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\"","visibility":"show","key":"WeqBRQog8F"},{"type":"output","id":"AZ1cETTXU0SjSF8voQFpQ","data":[],"visibility":"show","key":"V6pZUlKx6v"}],"visibility":"show","key":"Z3jSJNy7tz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Order and download data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jXzLevVQW4"}],"identifier":"order-and-download-data","label":"Order and download data","html_id":"order-and-download-data","implicit":true,"key":"RgWc9VNxVG"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Climate Digital Twin collection, as well as all the ECMWF datasets, in the DestinE Data Lake requires an ordering workflow.\nThe ordering workflow consists of the following steps:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Py20Bg9MSb"}],"key":"jpjDQzSFkV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"submit an order with parameters directly to the collection,","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lC0L75BEPX"}],"key":"bT5R8HswVH"}],"key":"dVcCNKXmy9"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"monitor the returned STAC item status,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ytzNU9xeW7"}],"key":"asDDz6doIy"}],"key":"rSkVBUCkf3"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"download the asset when ready.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mYkYO8NvUa"}],"key":"SGymWR3Itn"}],"key":"UpRFCLEVCG"}],"key":"B924VQXerg"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Note:\nECMWF data follows this process, the STAC item in this case will always contain one asset with the requested data.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"TBwDdocoJC"}],"key":"OzmjyWO9AG"}],"key":"qS5udGa0Ib"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Submit an Order","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BZfPwUmx2v"}],"identifier":"submit-an-order","label":"Submit an Order","html_id":"submit-an-order","implicit":true,"key":"oxHfNHocWN"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To submit an order we need to select our parameters of interest.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WB2bzDej1E"}],"key":"rP8Bmv9Y28"}],"key":"eGLhFF5cgE"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"datechoice = \"20280610\"\nfilter_params = {\n        \"ecmwf:class\": \"d1\",             # fixed \n        \"ecmwf:dataset\": \"climate-dt\",   # fixed climate-dt access\n        \"ecmwf:activity\": \"ScenarioMIP\", # activity + experiment + model (go together)\n        \"ecmwf:experiment\": \"SSP3-7.0\",  # activity + experiment + model (go together)\n        \"ecmwf:model\": \"IFS-NEMO\",       # activity + experiment + model (go together)\n        \"ecmwf:generation\": \"1\",         # fixed Specifies the generation of the dataset, which can be incremented as required (latest is 1)\n        \"ecmwf:realization\": \"1\",        # fixed Specifies the climate realization. Default 1. Based on perturbations of initial conditions\n        \"ecmwf:resolution\": \"high\",      # standard/ high \n        \"ecmwf:expver\": \"0001\",          # fixed experiment version \n        \"ecmwf:stream\": \"clte\",          # fixed climate\n        \"ecmwf:time\": \"0000\",            # choose the hourly slot(s)\n        \"ecmwf:type\": \"fc\",              # fixed forecasted fields\n        \"ecmwf:levtype\": \"sfc\",          # Surface fields (levtype=sfc), Height level fields (levtype=hl), Pressure level fields (levtype=pl), Model Level (Levtype=ml)\n#        \"levelist\": \"1/2/3/...\",  # for ml/pl/sol type data\n        \"ecmwf:param\": \"134\",             # Surface Pressure parameter\n        \"ecmwf:date\":datechoice+\"/to/\"+datechoice\n    }","visibility":"show","key":"Yz5y5F6ebM"},{"type":"output","id":"SX54HgJBR5s7Qgh9Dk_XB","data":[],"visibility":"show","key":"rgjidJhaJ8"}],"visibility":"show","key":"TLvmhxaK79"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\nresponse = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json=filter_params, headers=auth_headers)\n\nif response.status_code != 200:\n    print(response.content)\nresponse.raise_for_status()\n\nordered_item = response.json()\n\nproduct_id = ordered_item[\"id\"]\nstorage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\norder_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\nfederation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\nprint(f\"Product ordered: {product_id}\")\nprint(f\"Provider: {federation_backend}\")\nprint(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\nprint(f\"Order status: {order_status}\")      \n\nself_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\nitem = {}\n\n","visibility":"show","key":"B0s2Prf4DV"},{"type":"output","id":"mQAwHih0J3F17erGsyRYz","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: e36cc9bb-edfb-4c13-93be-c1dcaaa3a724\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\n"}],"visibility":"show","key":"F1IjQvbTr8"}],"visibility":"show","key":"dT0twkOrUx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Monitor the status","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g5UhgcdBcy"}],"identifier":"monitor-the-status","label":"Monitor the status","html_id":"monitor-the-status","implicit":true,"key":"WasODlvkSg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The status of an order can be:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aVPyhfmwph"}],"key":"GlOSEhwnTz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"shipping, that means that the order is in progress;","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GyLtk1l1Kg"}],"key":"Bk723lgreZ"}],"key":"tBLlakeKfO"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"succeeded, that means that the order is completed;","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iKKrgqH0gT"}],"key":"H2QWBvKLbf"}],"key":"N3pl0dtYwc"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"failed, that means that the order is in error.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Nj2FjNGbGb"}],"key":"bmY8Wzdmcf"}],"key":"l7VroNs5os"}],"key":"Ue0aZJ89cb"}],"key":"OHyERzjy1j"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"for i in range(0, TIMEOUT, STEP):\n    print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n    response = requests.get(self_url, headers=auth_headers)\n    if response.status_code != 200:\n        print(response.content)\n    response.raise_for_status()\n    item = response.json()\n\n    storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n    if storage_tier == ONLINE_STATUS:\n        download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n        print(\"Product is ready to be downloaded.\")\n        print(f\"Asset URL: {download_url}\")\n        break\n    sleep(STEP)\nelse:\n    order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n    print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")\n    \nresponse = requests.get(download_url, stream=True, headers=auth_headers)\nresponse.raise_for_status()","visibility":"show","key":"WUFblk23xC"},{"type":"output","id":"ZAQgYwK5S-5lkevjStY4N","data":[{"name":"stdout","output_type":"stream","text":"Polling 1/300\nPolling 2/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/e36cc9bb-edfb-4c13-93be-c1dcaaa3a724/downloadLink\n"}],"visibility":"show","key":"DdI8OwmT3c"}],"visibility":"show","key":"kqa4wkVPSm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"h8vkqXngk1"}],"identifier":"download","label":"Download","html_id":"download","implicit":true,"key":"tL5wdar8se"}],"key":"RiGqsHlTi8"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"content_disposition = response.headers.get('Content-Disposition')\ntotal_size = int(response.headers.get(\"content-length\", 0))\nif content_disposition:\n    filename = content_disposition.split('filename=')[1].strip('\"')\n    filename = unquote(filename)\nelse:\n    filename = os.path.basename(url)\n\n# Open a local file in binary write mode and write the content\nprint(f\"downloading {filename}\")\n\nwith tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n    with open(filename, 'wb') as f:\n        for data in response.iter_content(1024):\n            progress_bar.update(len(data))\n            f.write(data)","visibility":"show","key":"AZy84J9Xh1"},{"type":"output","id":"UrCBTNkqEblVAaGTDW0Wx","data":[{"name":"stdout","output_type":"stream","text":"downloading e36cc9bb-edfb-4c13-93be-c1dcaaa3a724.grib\n"},{"name":"stderr","output_type":"stream","text":"23.6MB [00:00, 38.0MB/s]\n"}],"visibility":"show","key":"U4SSxtG7zH"}],"visibility":"show","key":"X6mUOOhdWN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PLjYqhQXye"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.ipynb-EarthKit","identifier":"dedl-hda-eo.ecmwf.dat.dt_climate.ipynb-earthkit","html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-ipynb-earthkit","key":"nxM2kh9qxl"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Lets plot the result file with ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"t7USHtUCWg"},{"type":"link","url":"https://earthkit.readthedocs.io/en/latest/index.html","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"qeevpuDdTd"}],"urlSource":"https://earthkit.readthedocs.io/en/latest/index.html","key":"b3uqtgfjFH"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ONHbZIQ4vp"}],"key":"MIXABwgLqz"}],"key":"pxjnmETkIe"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data\nimport earthkit.plots\nimport earthkit.regrid\n\ndata = earthkit.data.from_source(\"file\", filename)\nearthkit.plots.quickplot(data)","visibility":"show","key":"QiV4165ntw"},{"type":"output","id":"MEF3xTaGexhEsyDPSk5nS","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"<earthkit.plots.components.figures.Figure at 0x7f3871c14050>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"751cc9a0ce03f06a24434bd0dfb73df0","path":"/build/751cc9a0ce03f06a24434bd0dfb73df0.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"tap00WglAd"}],"visibility":"show","key":"FdNz15Rgtp"}],"key":"E3Wq1Wnzry"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}