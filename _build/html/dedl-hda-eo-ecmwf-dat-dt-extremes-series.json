{"version":2,"kind":"Notebook","sha256":"135a7d3f4ff83cd66051ee4907fc6661ecd8686a97750ed047436a2c1ac533e1","slug":"dedl-hda-eo-ecmwf-dat-dt-extremes-series","location":"/production/HDA/DestinE_Digital_Twins/DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb","dependencies":[],"frontmatter":{"title":"Weather-Induced Extremes Digital Twin Series","subtitle":"his notebook authenticates with the DestinE API, queries ECMWF Extremes Digital Twin forecast data for a user-selected date within the last 14 days, downloads it, and visualizes wind gust and sea-level pressure fields using EarthKit.","tags":["HDA","ECMWF","Authentication","Digital Twin"],"copyright":"Â© 2025 EUMETSAT","authors":[{"id":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)","name":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb","url":"/build/DEDL-HDA-EO.ECMWF.DA-d49885b79c51ba8d7fc26291c46b786c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"ðŸš€ Launch in JupyterHub","key":"CVU1nrr3bt"}],"key":"LfGPOYeVBb"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb","key":"Tda0bBhM81"}],"key":"ET8FhDDlX9"}],"key":"Qo2CJ6gAk3"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"Prerequisites:","key":"QdW2YsHh4T"}],"key":"bCvmx0DQ8R"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DEDL data a ","key":"gwr8UuAp4p"},{"type":"link","url":"https://platform.destine.eu/","children":[{"type":"text","value":"DestinE user account","key":"KUjbiSkTDb"}],"urlSource":"https://platform.destine.eu/","key":"u3NfrLybTg"},{"type":"text","value":" is needed","key":"I7UJaRoZVm"}],"key":"OjuvwGgQyC"}],"key":"ChoynRt5ml"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DT data an ","key":"yDSZVzxEQ6"},{"type":"link","url":"https://platform.destine.eu/support-pages/access-policy/","children":[{"type":"text","value":"upgraded access","key":"A6X8Rq0Emy"}],"urlSource":"https://platform.destine.eu/support-pages/access-policy/","key":"nKC9hCmiID"},{"type":"text","value":" is needed.","key":"liGxuwWQms"}],"key":"qZTivmtPK0"}],"key":"qlMCGeAUXU"}],"key":"XqWP9gsTpu"},{"type":"strong","children":[{"type":"text","value":"References:","key":"djOYgrejQf"}],"key":"WZ97TaeOxo"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","children":[{"type":"text","value":"DestinE Data Lake (DEDL) Harmonized Data Access (HDA) documentation","key":"prH9NbVvSL"}],"urlSource":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","key":"uw8Um2Ci7M"}],"key":"e6I5lKdJAF"}],"key":"TljUcKzuqE"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine.ecmwf.int/weather-induced-extremes-digital-twin-1/","children":[{"type":"text","value":"Weather-Induced Extremes Digital Twin (Extremes DT)","key":"O8GLjeEYBD"}],"urlSource":"https://destine.ecmwf.int/weather-induced-extremes-digital-twin-1/","key":"W6QArPqak9"}],"key":"PdHDIbt8Tx"}],"key":"swWKflFSQM"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://confluence.ecmwf.int/display/DDCZ/Extremes+DT+data+catalogue","children":[{"type":"text","value":"Extreme DT data catalogue","key":"t6F8mMM19W"}],"urlSource":"https://confluence.ecmwf.int/display/DDCZ/Extremes+DT+data+catalogue","key":"o99zS0vwLj"}],"key":"rezsL5Q6tt"}],"key":"BsAk48rNal"}],"key":"QTxEllVZ2W"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"uYhbKKRNOB"}],"key":"xduSCqmqVz"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Earthkit and HDA Polytope used in this context are both packages provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"rMz4JelMpD"}],"key":"PqOixofeiM"}],"key":"V9CYMGhB2E"}],"key":"zViFkIRo0v"}],"key":"YGUPJ2mZU3"}],"key":"F9umshlbTV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I0rWM1CZtM"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA (Harmonized Data Access)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BFaAs0Mikc"}],"key":"GgXqMtSqm8"},{"type":"text","value":" API to query and access Extremes DT data to plot a parameter.\nBelow the main steps covered by this tutorial.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QpL6klsd92"}],"key":"hAnTevvwOV"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"c6IPhEdiUV"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_extremes-series.ipynb-setup","label":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb-Setup","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-extremes-series-ipynb-setup","key":"V3IINJKKPm"},{"type":"text","value":": Import the required libraries.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GbORWBqVwd"}],"key":"XJWXBquXwg"}],"key":"DKJir9j9b1"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"v4kNsHuJA3"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_extremes-series.ipynb-order-and-download","label":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb-Order-and-Download","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-extremes-series-ipynb-order-and-download","key":"xsbK9JWEq3"},{"type":"text","value":": How to filter and download Extremes DT data series.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"adSuDm9SnL"}],"key":"TwNJVNcH1X"}],"key":"iirH3rxpEo"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Plot","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UJRKtvBWHn"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_extremes-series.ipynb-render-the-variables-on-a-map","label":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb-Render-the-variables-on-a-map","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-extremes-series-ipynb-render-the-variables-on-a-map","key":"sDw4XW4L8u"},{"type":"text","value":": How to visualize hourly data on single levels data through Earthkit.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vHMPp47ZqM"}],"key":"WaO1iEDssN"}],"key":"bdxZTHlrHp"}],"key":"l8TFucPyem"}],"key":"WIKOawNm5D"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"s1S74jv2zw"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb-Setup","identifier":"dedl-hda-eo.ecmwf.dat.dt_extremes-series.ipynb-setup","html_id":"dedl-hda-eo-ecmwf-dat-dt-extremes-series-ipynb-setup","key":"bMbZhEg7rP"}],"key":"zsTfBqSRoS"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import all the required packages.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xS6aHSmktX"}],"key":"Gqus3dRJXS"}],"visibility":"show","key":"nJsTpzGqAi"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import destinelab as deauth\nimport json\nimport datetime\nimport importlib.metadata\n\nimport requests\nfrom requests.adapters import HTTPAdapter\nfrom urllib3.util.retry import Retry\nimport os\nfrom getpass import getpass\nfrom tqdm import tqdm\nimport time\nfrom datetime import datetime\nfrom urllib.parse import unquote\nfrom time import sleep\nfrom IPython.display import JSON\nimport ipywidgets as widgets","visibility":"show","key":"zSvJbT8F0I"},{"type":"output","id":"LbzQCMkE4ewoC7nIOfLNi","data":[],"visibility":"show","key":"xM06SPIbCe"}],"visibility":"show","key":"btp89VpUqs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Fy1tb54BOK"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb-Order-and-Download","identifier":"dedl-hda-eo.ecmwf.dat.dt_extremes-series.ipynb-order-and-download","html_id":"dedl-hda-eo-ecmwf-dat-dt-extremes-series-ipynb-order-and-download","key":"dJPNt0Nanc"}],"key":"EJnSQSaIhX"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Obtain Authentication Token","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"On6w6oDFDC"}],"identifier":"obtain-authentication-token","label":"Obtain Authentication Token","html_id":"obtain-authentication-token","implicit":true,"key":"Uy5qHRsy1O"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To access data we need to be authenticated.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UKgQDKoQpr"}],"key":"mewklawf8t"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Below how to request of an authentication token using the destinelab package.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PFXG5FnNca"}],"key":"Ho8IRE3Chb"}],"visibility":"show","key":"OSePhjDOi0"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username or email: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"Z72kggsRqR"},{"type":"output","id":"7jQQeGx8RuQusapen9msj","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username or email:  eum-dedl-user\nPlease input your DESP password:  Â·Â·Â·Â·Â·Â·Â·Â·\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"CbRYPru4vM"}],"visibility":"show","key":"CxMew7U0FB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check if DT access is granted","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fMi5l4OMRg"}],"identifier":"check-if-dt-access-is-granted","label":"Check if DT access is granted","html_id":"check-if-dt-access-is-granted","implicit":true,"key":"pj3r9MlRai"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If DT access is not granted, you will not be able to execute the rest of the notebook.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TwaP0zb4Mi"}],"key":"kiY50SrMKi"}],"key":"xjFZ1i1LN3"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import importlib\ninstalled_version = importlib.metadata.version(\"destinelab\")\nversion_number = installed_version.split('.')[1]\nif((int(version_number) >= 8 and float(installed_version) < 1) or float(installed_version) >= 1):\n    auth.is_DTaccess_allowed(access_token)","visibility":"show","key":"swaUl8c5pj"},{"type":"output","id":"wx9J1bPcCw5hMJiJPpCVY","data":[{"name":"stdout","output_type":"stream","text":"DT Output access allowed\n"}],"visibility":"show","key":"rWIxeEhCiM"}],"visibility":"show","key":"TfTdu9w3eq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA Endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q1xy19JcMP"}],"identifier":"hda-endpoint","label":"HDA Endpoint","html_id":"hda-endpoint","implicit":true,"key":"zRVFmpPYko"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HDA API is based on the Spatio Temporal Asset Catalog specification (STAC), it is convenient define a costant with its endpoint.\nAnd another one with the ID of the Cliamte DT collection.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"i9vOdJsKlk"}],"key":"Fti7dvUvAx"}],"key":"KNf4rC3Uw1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"\nCOLLECTION_ID=\"EO.ECMWF.DAT.DT_EXTREMES\"","visibility":"show","key":"ywzi7xg5uM"},{"type":"output","id":"3d8A6HFQ-zby4rouT8tsD","data":[],"visibility":"show","key":"wYwYKlqzXi"}],"visibility":"show","key":"WzUPPBYSrO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Order and download data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"swT56luuJf"}],"identifier":"order-and-download-data","label":"Order and download data","html_id":"order-and-download-data","implicit":true,"key":"DlABZ4RCvH"}],"key":"FXJYRIKszZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Weather-Induced Extremes Digital Twin collection, as well as all the ECMWF datasets, in the DestinE Data Lake requires an ordering workflow.\nThe ordering workflow consists of the following steps:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v7FA6Wfa8b"}],"key":"wzfO9iumDR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"submit an order with parameters directly to the collection,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PBLVjfNrYF"}],"key":"mcKADbpXKh"}],"key":"ArJnBJamAS"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"monitor the returned STAC item status,","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aK7yYZSSbX"}],"key":"R8XBTbipXz"}],"key":"XpzNFBW0yN"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"download the asset when ready.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qMzlCkX5Bl"}],"key":"g5kN2TTfg1"}],"key":"M6vyZTSLm1"}],"key":"OV8Ii7xcdO"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Note:\nECMWF data follows this process, the STAC item in this case will always contain one asset with the requested data.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IZcwUnWLBW"}],"key":"u2vWupFA9M"}],"key":"HHwY3dfGmB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Extreme DT data availability","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iSNCgNeyUt"}],"identifier":"extreme-dt-data-availability","label":"Extreme DT data availability","html_id":"extreme-dt-data-availability","implicit":true,"key":"GquxDxq6oL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Extreme DT data is available for specific time ranges (last 14 days) around the current date.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gvJ0iW3Vvv"}],"key":"wjmFAAeCNN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"It is possible to use the ECMWF Aviso package to check data availability in the last 14 days (see ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ufH41LDZWo"},{"type":"link","url":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/DestinE Digital Twins/ExtremeDT-dataAvailability.ipynb","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Pwjayf831r"}],"urlSource":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","data":{"kind":"file","org":"destination-earth","repo":"DestinE-DataLake-Lab","reference":"main","file":"HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","raw":"https://raw.githubusercontent.com/destination-earth/DestinE-DataLake-Lab/main/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb"},"internal":false,"protocol":"github","key":"TO6wFILXp7"},{"type":"text","value":" or ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CRc3xPLfw0"},{"type":"link","url":"https://github.com/destination-earth-digital-twins/aviso-examples/blob/main/aviso-extremes-dt.py","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"avisoâ€‹-extremesâ€‹-dtâ€‹.py","key":"WP4uKDHV17"}],"urlSource":"https://github.com/destination-earth-digital-twins/aviso-examples/blob/main/aviso-extremes-dt.py","data":{"kind":"file","org":"destination-earth-digital-twins","repo":"aviso-examples","reference":"main","file":"aviso-extremes-dt.py","raw":"https://raw.githubusercontent.com/destination-earth-digital-twins/aviso-examples/main/aviso-extremes-dt.py"},"internal":false,"protocol":"github","key":"AlvazLyAdt"},{"type":"text","value":") and request data accordingly.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"T3amp9iDgF"}],"key":"FIYULQ2raa"}],"key":"E1eZqttg1m"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime, timedelta\n\n# Get the current date and time in UTC\ncurrent_date = datetime.utcnow()\n\n# Calculate the date 14 days before the current date\ndate_14_days_ago = current_date - timedelta(days=14)\n\n# Format the date as YYYYMMDD and set the time to 0000 UTC\nformatted_date = date_14_days_ago.strftime('%Y%m%d') + '0000'\n# Convert the formatted date back to a datetime object\ndate_from = datetime.strptime(formatted_date, '%Y%m%d%H%M%S').date()\n\n# Format the date as YYYYMMDD and set the time to 0000 UTC\nformatted_date = current_date.strftime('%Y%m%d') + '0000'\n# Convert the formatted date back to a datetime object\ndate_to = datetime.strptime(formatted_date, '%Y%m%d%H%M%S').date()\n\n","visibility":"show","key":"iMZOEPOf2n"},{"type":"output","id":"30O4rsyJVTRkNaLpiW5L4","data":[],"visibility":"show","key":"IfTBFeBxOB"}],"visibility":"show","key":"YFsiLKQhr4"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"start_date_picker = widgets.DatePicker(description='Start Date:', disabled=False)\n\n# Set initial values directly\nstart_date_picker.min = date_from\nstart_date_picker.max = date_to\nstart_date_picker.value = date_from\n\ndef get_selected_values():\n    selected_start_date = start_date_picker.value\n    return selected_start_date\n\n# Display widgets\ndisplay(start_date_picker)","visibility":"show","key":"i5ju5BsM2i"},{"type":"output","id":"Lq19OA3VAN56AMlVcFaIX","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"2eebe5348d15406ba7f80da9cef4ac03\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"DatePicker(value=datetime.date(2025, 10, 7), description='Start Date:', max=datetime.date(2025, 10, 21), min=dâ€¦","content_type":"text/plain"}}}],"visibility":"show","key":"AlyN5WKoFf"}],"visibility":"show","key":"GQhkCHc7fU"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Example usage:\ndatechoice =  get_selected_values().strftime(\"%Y%m%d\")\n#print(datechoice)\nfilter_params = {\n        \"ecmwf:class\": \"d1\",             # fixed (rd or d1)\n        \"ecmwf:dataset\": \"extremes-dt\",  # fixed extreme dt \n        \"ecmwf:expver\": \"0001\",          # fixed experiment version \n        \"ecmwf:stream\": \"oper\",          # fixed oper\n        \"ecmwf:step\": \"0/6/12/18/24\",    # Forcast step hourly (1..96)\n        \"ecmwf:type\": \"fc\",              # fixed forecasted fields\n        \"ecmwf:levtype\": \"sfc\",          # Surface fields (levtype=sfc), Height level fields (levtype=hl), Pressure level fields (levtype=pl), Model Level (Levtype=ml)\n        \"ecmwf:param\": \"151/228029\",     # 10m Wind gust & Mean Sea Level Pressure\n        \"ecmwf:date\":datechoice+\"/to/\"+datechoice\n}","visibility":"show","key":"i8UJpPJH4A"},{"type":"output","id":"HXKsGCkxY-WP2tNS_4oQA","data":[],"visibility":"show","key":"HRli9qxHJP"}],"visibility":"show","key":"GuS3RqwjFg"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\nresponse = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json=filter_params, headers=auth_headers)\n\nif response.status_code != 200:\n    print(response.content)\nresponse.raise_for_status()\n\nordered_item = response.json()\n\nproduct_id = ordered_item[\"id\"]\nstorage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\norder_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\nfederation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\nprint(f\"Product ordered: {product_id}\")\nprint(f\"Provider: {federation_backend}\")\nprint(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\nprint(f\"Order status: {order_status}\")      \n\nself_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\nitem = {}","visibility":"show","key":"INEmAxtxAB"},{"type":"output","id":"QtPBr2z5ve45cvX30-vYG","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: 2186cd55-86e1-4ffd-b56c-4b6af514a087\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\n"}],"visibility":"show","key":"xs4tlkaLPy"}],"visibility":"show","key":"L6vkgP5eDC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Monitor the status","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nHSmlokxX0"}],"identifier":"monitor-the-status","label":"Monitor the status","html_id":"monitor-the-status","implicit":true,"key":"niBSPRSiQf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The status of an order can be:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iwY3ltO8qJ"}],"key":"fRCN5k6yDU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"shipping, that means that the order is in progress;","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XCxuVP286e"}],"key":"vpxxRRW7F1"}],"key":"ZxpJ53ZEfi"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"succeeded, that means that the order is completed;","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"a6N1SNhdYg"}],"key":"GFAqRawhwS"}],"key":"io3X2dk2tW"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"failed, that means that the order is in error.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"HwqSSHNO7T"}],"key":"dBUbysOqbz"}],"key":"BzZRv4DSjw"}],"key":"tJORRGLxEu"}],"key":"xdaVKdTIfb"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"for i in range(0, TIMEOUT, STEP):\n    print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n    response = requests.get(self_url, headers=auth_headers)\n    if response.status_code != 200:\n        print(response.content)\n    response.raise_for_status()\n    item = response.json()\n\n    storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n    if storage_tier == ONLINE_STATUS:\n        download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n        print(\"Product is ready to be downloaded.\")\n        print(f\"Asset URL: {download_url}\")\n        break\n    sleep(STEP)\nelse:\n    order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n    print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")\n    \nresponse = requests.get(download_url, stream=True, headers=auth_headers)\nresponse.raise_for_status()\n","visibility":"show","key":"d2Tfsc54N3"},{"type":"output","id":"RbJvWjyUzMlID9Zylema3","data":[{"name":"stdout","output_type":"stream","text":"Polling 1/300\nPolling 2/300\nPolling 3/300\nPolling 4/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.lumi.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_EXTREMES/2186cd55-86e1-4ffd-b56c-4b6af514a087/downloadLink\n"}],"visibility":"show","key":"ou80mJRGYZ"}],"visibility":"show","key":"cy44znNZT4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dAWyZJlZfT"}],"identifier":"download","label":"Download","html_id":"download","implicit":true,"key":"cUow6gjHBD"}],"key":"o6Gl8nCUxR"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"\ncontent_disposition = response.headers.get('Content-Disposition')\ntotal_size = int(response.headers.get(\"content-length\", 0))\nif content_disposition:\n    filename = content_disposition.split('filename=')[1].strip('\"')\n    filename = unquote(filename)\nelse:\n    filename = os.path.basename(url)\n\n# Open a local file in binary write mode and write the content\nprint(f\"downloading {filename}\")\n\nwith tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n    with open(filename, 'wb') as f:\n        for data in response.iter_content(1024):\n            progress_bar.update(len(data))\n            f.write(data)","visibility":"show","key":"tuCXjxqq4f"},{"type":"output","id":"hL1dN0WEzCQmbmv8ZQGnk","data":[{"name":"stdout","output_type":"stream","text":"downloading 2186cd55-86e1-4ffd-b56c-4b6af514a087.grib\n"},{"name":"stderr","output_type":"stream","text":"531MB [00:59, 8.98MB/s] \n"}],"visibility":"show","key":"h5uNrDRY3d"}],"visibility":"show","key":"GIqEqV1h9e"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Render the variables on a map","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oWnKKi6be6"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.ipynb-Render-the-variables-on-a-map","identifier":"dedl-hda-eo.ecmwf.dat.dt_extremes-series.ipynb-render-the-variables-on-a-map","html_id":"dedl-hda-eo-ecmwf-dat-dt-extremes-series-ipynb-render-the-variables-on-a-map","key":"DAKFAUJJix"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Lets plot the result file","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Xl2Z4tlogy"}],"key":"qFTBo72AOM"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This section requires that you have ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FInKHW5kM0"},{"type":"inlineCode","value":"ecCodes >= 2.35","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mbolq33hv9"},{"type":"text","value":" installed on your system.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"rcjohY1yjm"},{"type":"break","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mzmlEFoldv"},{"type":"text","value":"You can follow the installation procedure at ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fGZehla1Iw"},{"type":"link","url":"https://confluence.ecmwf.int/display/ECC/ecCodes+installation","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"https://â€‹confluenceâ€‹.ecmwfâ€‹.intâ€‹/displayâ€‹/ECCâ€‹/ecCodes+installation","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JBHUwCtja1"}],"urlSource":"https://confluence.ecmwf.int/display/ECC/ecCodes+installation","key":"l2kWuAtHv0"}],"key":"RkDa1rxWj2"}],"key":"bGtMST6Nzg"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data\nimport earthkit.maps\n\ndata = earthkit.data.from_source(\"file\", filename)\ndata.ls()","visibility":"show","key":"ksJf2lwdPp"},{"type":"output","id":"EJHrziN3Q5tD0SvH-K4vt","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>centre</th>\n      <th>shortName</th>\n      <th>typeOfLevel</th>\n      <th>level</th>\n      <th>dataDate</th>\n      <th>dataTime</th>\n      <th>stepRange</th>\n      <th>dataType</th>\n      <th>number</th>\n      <th>gridType</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ecmf</td>\n      <td>msl</td>\n      <td>meanSea</td>\n      <td>0</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>0</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>ecmf</td>\n      <td>i10fg</td>\n      <td>heightAboveGround</td>\n      <td>10</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>0</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>ecmf</td>\n      <td>msl</td>\n      <td>meanSea</td>\n      <td>0</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>6</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>ecmf</td>\n      <td>i10fg</td>\n      <td>heightAboveGround</td>\n      <td>10</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>6</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>ecmf</td>\n      <td>msl</td>\n      <td>meanSea</td>\n      <td>0</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>12</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>ecmf</td>\n      <td>i10fg</td>\n      <td>heightAboveGround</td>\n      <td>10</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>12</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>ecmf</td>\n      <td>msl</td>\n      <td>meanSea</td>\n      <td>0</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>18</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>ecmf</td>\n      <td>i10fg</td>\n      <td>heightAboveGround</td>\n      <td>10</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>18</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>ecmf</td>\n      <td>msl</td>\n      <td>meanSea</td>\n      <td>0</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>24</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>ecmf</td>\n      <td>i10fg</td>\n      <td>heightAboveGround</td>\n      <td>10</td>\n      <td>20251021</td>\n      <td>0</td>\n      <td>24</td>\n      <td>fc</td>\n      <td>None</td>\n      <td>reduced_gg</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"  centre shortName        typeOfLevel  level  dataDate  dataTime stepRange  \\\n0   ecmf       msl            meanSea      0  20251021         0         0   \n1   ecmf     i10fg  heightAboveGround     10  20251021         0         0   \n2   ecmf       msl            meanSea      0  20251021         0         6   \n3   ecmf     i10fg  heightAboveGround     10  20251021         0         6   \n4   ecmf       msl            meanSea      0  20251021         0        12   \n5   ecmf     i10fg  heightAboveGround     10  20251021         0        12   \n6   ecmf       msl            meanSea      0  20251021         0        18   \n7   ecmf     i10fg  heightAboveGround     10  20251021         0        18   \n8   ecmf       msl            meanSea      0  20251021         0        24   \n9   ecmf     i10fg  heightAboveGround     10  20251021         0        24   \n\n  dataType number    gridType  \n0       fc   None  reduced_gg  \n1       fc   None  reduced_gg  \n2       fc   None  reduced_gg  \n3       fc   None  reduced_gg  \n4       fc   None  reduced_gg  \n5       fc   None  reduced_gg  \n6       fc   None  reduced_gg  \n7       fc   None  reduced_gg  \n8       fc   None  reduced_gg  \n9       fc   None  reduced_gg  ","content_type":"text/plain"}}}],"visibility":"show","key":"gs86pfBsV5"}],"visibility":"show","key":"xL8aX8gyME"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\nchart = earthkit.maps.Chart(domain=[-5, 23, 40, 58], rows=3, columns=4)\n\ngust_style = earthkit.maps.Style(\n    colors=[\"#85AAEE\", \"#208EFC\", \"#6CA632\", \"#FFB000\", \"#FF0000\", \"#7A11B1\"],\n    levels=[12, 15, 20, 25, 30, 35, 50],\n    units=\"m s-1\",\n)\n\nchart.add_subplot(row=0, column=3)\nfor i in range(4):\n    chart.add_subplot(row=1+i//4, column=i%4)\n\nchart.plot(data.sel(shortName=\"i10fg\"), style=gust_style)\nchart.plot(data.sel(shortName=\"msl\"), units=\"hPa\")\n\nchart.land(color=\"lightgrey\")\nchart.coastlines()\n\nax = plt.axes((0.05, 0.8, 0.65, 0.025))\nchart.legend(ax=ax)\n\nchart.subplot_titles(\"{time:%Y-%m-%d %H} UTC (+{lead_time}h)\")\nchart.title(\n    \"ECMWF HRES Run: {base_time:%Y-%m-%d %H} UTC\\n{variable_name}\",\n    fontsize=15, horizontalalignment=\"left\", x=0, y=0.96,\n)\n\nchart.show()","visibility":"show","key":"UlFS12YLGF"},{"type":"output","id":"RJhSbrMc4-WSxJUphItbC","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"dade97be039dfc9f95fdb871541cfaa4","path":"/build/dade97be039dfc9f95fdb871541cfaa4.png"},"text/plain":{"content":"<Figure size 900x750 with 6 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"AA6SNLIIcx"}],"visibility":"show","key":"LwqBDBkDjR"}],"key":"rNL4nvzkCZ"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}