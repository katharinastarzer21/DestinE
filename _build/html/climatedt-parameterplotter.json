{"version":2,"kind":"Notebook","sha256":"48b8c85c2aeca21fe540aaba64dab7a848bc5e9dbe450b6507a85fa1de9d5a52","slug":"climatedt-parameterplotter","location":"/production/HDA/DestinE_Digital_Twins/ClimateDT-ParameterPlotter.ipynb","dependencies":[],"frontmatter":{"title":"HDA Climate DT Parameter Plotter - Tutorial","subtitle":"This notebook provides an interactive workflow to select, query, download, and visualize Climate Digital Twin parameters from the DestinE Data Lake using the DEDL HDA API.","tags":["HDA","ECMWF","earthkit","Digital Twin"],"copyright":"Â© 2025 EUMETSAT","authors":[{"id":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)","name":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"ClimateDT-ParameterPlotter.ipynb","url":"/build/ClimateDT-ParameterP-7614466bc9110ba90caffaa362b7ac47.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ClimateDT-ParameterPlotter.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"ðŸš€ Launch in JupyterHub","key":"fFbFmuOeg2"}],"key":"U0z0YOTUxV"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ClimateDT-ParameterPlotter.ipynb","key":"E604it5RAy"}],"key":"qUIgBNp6zw"}],"key":"Di1XZteaal"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"Prerequisites:","key":"MGDFJf3cfi"}],"key":"bbXQgNnZRQ"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DEDL data a ","key":"Ndwm8jF8Zb"},{"type":"link","url":"https://platform.destine.eu/","children":[{"type":"text","value":"DestinE user account","key":"W4GwJ9kbHf"}],"urlSource":"https://platform.destine.eu/","key":"a3nhqkcirZ"},{"type":"text","value":" is needed","key":"gyWRtlkc36"}],"key":"vjCctX1FTv"}],"key":"xNmi7NJTz1"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DT data an ","key":"xsZFscCJU5"},{"type":"link","url":"https://platform.destine.eu/support-pages/access-policy/","children":[{"type":"text","value":"upgraded access","key":"CaSHfD2KxN"}],"urlSource":"https://platform.destine.eu/support-pages/access-policy/","key":"wTXfFu1PDS"},{"type":"text","value":" is needed.","key":"BZp8Hd9Mho"}],"key":"CC6kvkowp3"}],"key":"IWznuvUbey"}],"key":"YCedewRWpM"},{"type":"strong","children":[{"type":"text","value":"References:","key":"AwOMfW4Dwa"}],"key":"YyDGh8P15m"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","children":[{"type":"text","value":"DestinE Data Lake (DEDL) Harmonized Data Access (HDA) documentation","key":"dQIACi8buG"}],"urlSource":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","key":"hL1RbhgWgg"}],"key":"FkiqzH360n"}],"key":"ZdHIxmc7Li"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine.ecmwf.int/climate-change-adaptation-digital-twin-climate-dt/","children":[{"type":"text","value":"Climate Change Adaptation DT (Climate DT)","key":"wOAdqruMVj"}],"urlSource":"https://destine.ecmwf.int/climate-change-adaptation-digital-twin-climate-dt/","key":"eCkPugCZ1c"}],"key":"GzFkbNjuh2"}],"key":"u5t4h2ZLQn"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://confluence.ecmwf.int/display/DDCZ/Climate+DT+Phase+1+data+catalogue","children":[{"type":"text","value":"Climate DT data catalogue","key":"C8LOyjzkfU"}],"urlSource":"https://confluence.ecmwf.int/display/DDCZ/Climate+DT+Phase+1+data+catalogue","key":"CUGuyQVoL7"}],"key":"sgNFJ7XSsq"}],"key":"TWfR7qxdA9"}],"key":"RtHQkYrwhK"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"Ghy5KyOg4S"}],"key":"ASoarJHYgj"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Earthkit and HDA Polytope used in this context are both packages provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"D8cqGGxGo9"}],"key":"SiolfGbsoa"}],"key":"BnjSqb2H7e"}],"key":"qY2xRePfp0"}],"key":"sLJ7Hbb9iy"}],"key":"SK1BhYqROI"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to access DT data for different types of simulations via ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uSEqT2rCDJ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA (Harmonized Data Access)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ca8AkYFW3z"}],"key":"FR2ckiig4b"},{"type":"text","value":" API.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n8PnJTtNeH"}],"key":"q32kRlq91K"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"A correct combination of parameters is necessary to access DT data for different types of simulations.\nThe aim of this notebook is to help you create the correct request to access the desired Climate DT data, through HDA, and visualize it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GAY7L8p3qI"}],"key":"P8qXwoYxKt"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Below the main steps covered by this tutorial.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ny81It0JsB"}],"key":"E2iAGRhvml"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IKrz8Wr4rn"}],"identifier":"climatedt-parameterplotter.ipynb-setup","label":"ClimateDT-ParameterPlotter.ipynb-Setup","kind":"heading","template":"{name}","resolved":true,"html_id":"climatedt-parameterplotter-ipynb-setup","key":"vqlsxIXeJ3"},{"type":"text","value":": Import the required libraries and define some function.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ZzRImdVbnG"}],"key":"clHyHmRqb9"}],"key":"QgLFnQKiQ6"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Simulation Selection","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ojrVcmVcIQ"}],"identifier":"climatedt-parameterplotter.ipynb-scenario-simulation-selection","label":"ClimateDT-ParameterPlotter.ipynb-Scenario-Simulation-Selection","kind":"heading","template":"{name}","resolved":true,"html_id":"climatedt-parameterplotter-ipynb-scenario-simulation-selection","key":"dQi7BabWcU"},{"type":"text","value":":  Print and select the desired scenario simulation for accessing Climate DT data.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IU6g5EMEdj"}],"key":"lnLcr8byiz"}],"key":"HNmWhHD1at"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Parameter Selection","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VaLQVj47iy"}],"identifier":"climatedt-parameterplotter.ipynb-parameter-selection","label":"ClimateDT-ParameterPlotter.ipynb-Parameter-Selection","kind":"heading","template":"{name}","resolved":true,"html_id":"climatedt-parameterplotter-ipynb-parameter-selection","key":"WtQN6wnXgk"},{"type":"text","value":": How to select the desired Climate DT variable among the ones available through the selected scenario.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"JKo9ALkQqo"}],"key":"dlvKRLGxWJ"}],"key":"DV7Y70uSLc"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Levels Selection","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"JqNsuYB01r"}],"identifier":"climatedt-parameterplotter.ipynb-levels-selection","label":"ClimateDT-ParameterPlotter.ipynb-Levels-Selection","kind":"heading","template":"{name}","resolved":true,"html_id":"climatedt-parameterplotter-ipynb-levels-selection","key":"eO5Vz7v0zE"},{"type":"text","value":": How to Handle different Levels to be selected (if any).","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"wEAqrWCHWV"}],"key":"S9LSTZHRzA"}],"key":"RVcJAsqxD7"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xvffm8GoOC"}],"identifier":"climatedt-parameterplotter.ipynb-order-and-download","label":"ClimateDT-ParameterPlotter.ipynb-Order-and-Download","kind":"heading","template":"{name}","resolved":true,"html_id":"climatedt-parameterplotter-ipynb-order-and-download","key":"uC6jlA0mNs"},{"type":"text","value":": How to order and download Climate DT data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BFpoGRgmw1"}],"key":"cRHyZu6w9K"}],"key":"Bx3va7WFga"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Plot","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"WmNe3RdRAc"}],"identifier":"climatedt-parameterplotter.ipynb-earthkit","label":"ClimateDT-ParameterPlotter.ipynb-EarthKit","kind":"heading","template":"{name}","resolved":true,"html_id":"climatedt-parameterplotter-ipynb-earthkit","key":"hzieAQZBlZ"},{"type":"text","value":": How to visualize hourly data on single levels data through Earthkit.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"RM3V4MYm6x"}],"key":"oBlzW58J5q"}],"key":"aDJchpDluu"}],"key":"KQAysufvLy"}],"visibility":"show","key":"QE4etfdAaU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ooMKQ5ZUIN"}],"label":"ClimateDT-ParameterPlotter.ipynb-Setup","identifier":"climatedt-parameterplotter.ipynb-setup","html_id":"climatedt-parameterplotter-ipynb-setup","key":"lRnyUplapy"}],"key":"nGDjxooHOA"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import the Climate DT parameters & scenarios dictionary and all the required packages.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SEfkZSacKD"}],"key":"B5sc2VEiW5"}],"visibility":"show","key":"mCWVixV0Z5"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import destinelab as deauth\nfrom destinelab import climate_dt_dictionary\nimport ipywidgets as widgets\nimport json\nimport datetime\nimport importlib\nimport importlib.metadata as metadata\n\nimport requests\nfrom requests.adapters import HTTPAdapter\nfrom urllib3.util.retry import Retry\nimport os\nfrom getpass import getpass\nfrom tqdm import tqdm\nimport time\nfrom urllib.parse import unquote\nfrom time import sleep\nfrom IPython.display import JSON\n\nimport sys\nimport subprocess\nfrom packaging import version\n\nfrom IPython.display import display, HTML","visibility":"show","key":"RWpGA5F6iA"},{"type":"output","id":"VdOyWfuY2zqT8cfep6ksg","data":[],"visibility":"show","key":"on4VfCWCcw"}],"visibility":"show","key":"FBHnhkjqjX"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define some useful funtions.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GBUyaOh32p"}],"key":"i4X8M7MlMc"}],"visibility":"show","key":"rchfR1lfEM"},{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#parameters\n\ndef filter_entries(search_string):\n    return [(name, index) for i, (name, index) in enumerate(model_filtered_options)\n            if search_string.lower() in name.lower()]\n\n\ndef on_search_change(change):\n    search_string = change.new\n    if search_string:\n        filtered_options = filter_entries(search_string)\n        entry_dropdown.options = filtered_options\n    else:\n        entry_dropdown.options =model_filtered_options\n        \ndef get_selected_entry():\n    return entry_dropdown.value\n\ndef get_selected_hours():\n    selected_hour = hour_dropdown.value\n    return selected_hour\n\n#simulations-scenarios\n################################\n\n# Function to generate hourly slots\ndef generate_hourly_slots():\n    hours = []\n    for hour in range(0, 24):\n        for minute in range(0, 60, 60):  # Step by 60 minutes (1 hour)\n            hours.append(datetime.time(hour, minute))\n    return hours\n\ndef on_scenario_change(change):\n    selected_scenario_index, selected_resolution = change.new\n    selected_sc_entry = scenario_simulation_table[selected_scenario_index]\n    output.clear_output()\n    with output:\n        if(selected_sc_entry['site']==\"MARENOSTRUM\"):\n            styled_message = widgets.HTML(\n                    value=\"<div style='color: red; font-weight: bold;'>The scenarios in Marenostrum are not available via HDA. Please select a scenario in LUMI</div>\"\n                )\n            display(styled_message)\n    date_from = datetime.datetime.strptime(selected_sc_entry['dateFrom'], '%m/%d/%Y').date()\n    start_date_picker.max = None\n    start_date_picker.min = date_from\n    start_date_picker.max = datetime.datetime.strptime(selected_sc_entry['dateTo'], '%m/%d/%Y').date()\n    start_date_picker.value = date_from\n    \ndef get_selected_values():\n    selected_scenario_index, selected_resolution = scenario_dropdown.value\n    selected_scenario = scenario_simulation_table[selected_scenario_index]\n    selected_start_date = start_date_picker.value\n    selected_end_date = \"\" # end_date_picker.value\n    selected_hour = \"00:00:00\"\n        \n    return selected_scenario_index, selected_scenario, selected_resolution, selected_start_date, selected_end_date, selected_hour\n\n# kevels\n\n# Define a global variable\nglobal global_widget\nglobal_widget = None\n\n# Create a function to generate the widget based on the selection mode\ndef generate_widget(selection_mode):\n    global global_widget\n    if selection_mode == 'Single':\n        global_widget = widgets.Dropdown(options=levelist, description='Select level:')\n        return global_widget\n    elif selection_mode == 'Multiple':\n        global_widget = widgets.SelectMultiple(options=levelist, description='Select levels:')\n        return global_widget\n    \n    \n# Function to display the widget based on the selection mode\ndef display_widget(selection_mode):\n    output.clear_output()\n    with output:\n        display(generate_widget(selection_mode))\n\n# Define a function to handle the change in selection mode\ndef on_dropdown_change(change):\n    display_widget(change.new)\n    \n# Function to convert tuple or single integer to string separated by \"/\"\ndef convert_to_string(input):\n    if isinstance(input, tuple):\n        return '/'.join(map(str, input))\n    elif isinstance(input, int):\n        return str(input)\n    else:\n        return None  # Handle other types if needed\n\n    \ndef ensure_package(package: str, min_version: str = None):\n    \"\"\"\n    Ensure that a given package is installed and optionally meets a minimum version.\n    \n    Args:\n        package (str): The name of the package to check/install.\n        min_version (str, optional): Minimum version required. If None, just ensures package is installed.\n    \"\"\"\n    try:\n        # Get current version\n        current_version = metadata.version(package)\n        print(f\"Current {package} version: {current_version}\")\n        \n        # Compare versions if needed\n        if min_version and version.parse(current_version) < version.parse(min_version):\n            print(f\"Upgrading {package} to >= {min_version} ...\")\n            subprocess.check_call([sys.executable, \"-m\", \"pip\", \"install\", \"--user\", f\"{package}>={min_version}\"])\n            print(f\"{package} updated successfully\")\n            return importlib.reload(importlib.import_module(package))\n        else:\n            print(f\"{package} is OK\")\n            return importlib.import_module(package)\n    \n    except metadata.PackageNotFoundError:\n        print(f\"{package} not installed. Installing...\")\n        install_target = f\"{package}>={min_version}\" if min_version else package\n        subprocess.check_call([sys.executable, \"-m\", \"pip\", \"install\", install_target])\n        print(f\"{package} installed successfully\")\n        return importlib.import_module(package)\n    ","visibility":"show","key":"gXmaXeLCmh"},{"type":"output","id":"IADB6XrJhgaQI4-nlHCoa","data":[],"visibility":"show","key":"T4K1TlPMwy"}],"visibility":"show","key":"zTb4p4hXbs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Scenario Simulation Selection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ekITJaKsOa"}],"label":"ClimateDT-ParameterPlotter.ipynb-Scenario-Simulation-Selection","identifier":"climatedt-parameterplotter.ipynb-scenario-simulation-selection","html_id":"climatedt-parameterplotter-ipynb-scenario-simulation-selection","key":"DydFcWv3L7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Letâ€™s select now the Scenario from which we want to obtain the Climate Parameter.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K96TvBwP4w"}],"key":"WtPQLsHqjb"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We need to ensure to have the right version of the climate DT dictionary.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aMQNJkrF3e"}],"key":"M96lRJk0O0"}],"key":"n6fFDK2AKS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"pd = ensure_package(\"destinelab\", \"1.13\")","visibility":"show","key":"pzC4uudcmC"},{"type":"output","id":"kbaKBgUdAMEpM3eXF_2vG","data":[{"name":"stdout","output_type":"stream","text":"Current destinelab version: 1.13\ndestinelab is OK\n"}],"visibility":"show","key":"CAx2GHvulv"}],"visibility":"show","key":"YAHEnCn8WG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Below the available ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hzvWR97VT4"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Climate DT simulations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vp0Q2IQx5I"}],"key":"q6l8Vsbi4i"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JIJIY2yF8u"}],"key":"HGOT9PPxyL"}],"key":"y0XCWXqzU6"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"\n#scenario dictionary in a rich table with title per scenario.\n\nscenario_simulation_table=climate_dt_dictionary.climateDT_scenario\n\nfor simulation in scenario_simulation_table:\n    if simulation[\"activity\"]==\"ScenarioMIP\" and  simulation.get(\"realization\")==None:\n        simulation[\"type\"] = \"Future projection\"\n        if simulation[\"model\"] == \"IFS-FESOM\":\n            simulation[\"site\"] = \"MARENOSTRUM\"\n        else:\n            simulation[\"site\"] = \"LUMI\" \n    elif simulation[\"activity\"]==\"ScenarioMIP\" and  simulation.get(\"realization\")==\"2\":\n        simulation[\"type\"] = \"Future projection (NextGEMS)\"\n        simulation[\"site\"] = \"LUMI\"\n        simulation[\"dateFrom\"] = \"01/20/2020\"\n    \n    if simulation[\"activity\"]==\"CMIP6\" and  simulation.get(\"class\")==\"d1\":\n        simulation[\"type\"] = \"Historical simulation\"\n        simulation[\"site\"] = \"LUMI\"\n    elif simulation[\"activity\"]==\"CMIP6\" and  simulation.get(\"class\")==\"ng\":\n        simulation[\"type\"] = \"Historical simulation (NextGEMS)\"\n        simulation[\"site\"] = \"LUMI\"\n    \n    if simulation[\"activity\"]==\"story-nudging\" and  simulation.get(\"experiment\")==\"hist\":\n        simulation[\"type\"] = \"Storyline simulation present climate\"\n        simulation[\"site\"] = \"LUMI\"\n    elif simulation[\"activity\"]==\"story-nudging\" and  simulation.get(\"experiment\")==\"cont\":\n        simulation[\"type\"] = \"Storyline simulation past climate\"\n        simulation[\"site\"] = \"LUMI\"\n    elif simulation[\"activity\"]==\"story-nudging\" and  simulation.get(\"experiment\")==\"Tplus2.0K\":\n        simulation[\"type\"] = \"Storyline simulation future climate\"\n        simulation[\"site\"] = \"LUMI\"\n    if simulation[\"activity\"].lower()==\"highresmip\" and  simulation.get(\"experiment\")==\"cont\" and  simulation[\"model\"]==\"IFS-FESOM\":\n        simulation[\"type\"] = \"Control\"\n        simulation[\"site\"] = \"MARENOSTRUM\"\n        simulation[\"activity\"] = \"HighResMIP\"\n        \n        \nnew_cont_sc = {\"experiment\": \"cont\", \"activity\": \"HighResMIP\", \"model\": \"IFS-NEMO\"}\n\nif any(all(d.get(k) == v for k, v in new_cont_sc.items())\n       for d in scenario_simulation_table):\n    print(\"All control scenarios exist\")                \nelse:\n    scenario_simulation_table.append({\n    \"type\": \"Control\",\n    \"activity\": \"HighResMIP\",\n    \"site\": \"LUMI\",\n    \"experiment\": \"cont\",\n    \"model\": \"IFS-NEMO\",\n    \"class\": \"d1\",\n    \"resolution\":  [\"high\",\"standard\"],\n    \"dateFrom\": \"01/01/1990\",\n    \"dateTo\": \"04/30/2020\"\n    } )      \n        \nimport pandas as pd\n# Convert list of dicts to DataFrame\ndf = pd.DataFrame(scenario_simulation_table)\n\n# Convert resolution list into a comma-separated string for display\ndf['resolution'] = df['resolution'].apply(lambda x: \", \".join(x))\n\n# Reorder columns\ncolumn_order = [\"type\", \"activity\", \"model\", \"resolution\", \"dateFrom\", \"dateTo\",\"experiment\" , \"site\", \"class\"]\ndf = df[column_order]\n\n# Bold specific fields \ndf['type'] = df['type'].apply(lambda x: f\"<b>{x}</b>\")\ndf['site'] = df['site'].apply(lambda x: f\"<b>{x}</b>\")\ndf['dateFrom'] = df['dateFrom'].apply(lambda x: f\"<b>{x}</b>\")\ndf['dateTo'] = df['dateTo'].apply(lambda x: f\"<b>{x}</b>\")\n\n# Display as HTML without index\ndisplay(HTML(df.to_html(escape=False, index=False)))","visibility":"show","key":"AzY7nWZitt"},{"type":"output","id":"mK5CzdiAhQ-rHowp8rhyU","data":[{"name":"stdout","output_type":"stream","text":"All control scenarios exist\n"},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>type</th>\n      <th>activity</th>\n      <th>model</th>\n      <th>resolution</th>\n      <th>dateFrom</th>\n      <th>dateTo</th>\n      <th>experiment</th>\n      <th>site</th>\n      <th>class</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><b>Future projection</b></td>\n      <td>ScenarioMIP</td>\n      <td>IFS-NEMO</td>\n      <td>high, standard</td>\n      <td><b>01/01/2020</b></td>\n      <td><b>12/30/2039</b></td>\n      <td>ssp3-7.0</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Future projection</b></td>\n      <td>ScenarioMIP</td>\n      <td>ICON</td>\n      <td>high</td>\n      <td><b>01/01/2020</b></td>\n      <td><b>09/30/2033</b></td>\n      <td>ssp3-7.0</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Historical simulation</b></td>\n      <td>CMIP6</td>\n      <td>IFS-NEMO</td>\n      <td>high, standard</td>\n      <td><b>01/01/1990</b></td>\n      <td><b>12/31/1996</b></td>\n      <td>hist</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Historical simulation</b></td>\n      <td>CMIP6</td>\n      <td>ICON</td>\n      <td>high</td>\n      <td><b>01/03/1991</b></td>\n      <td><b>10/30/2005</b></td>\n      <td>hist</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Storyline simulation present climate</b></td>\n      <td>story-nudging</td>\n      <td>IFS-FESOM</td>\n      <td>high, standard</td>\n      <td><b>01/01/2017</b></td>\n      <td><b>12/31/2023</b></td>\n      <td>hist</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Storyline simulation past climate</b></td>\n      <td>story-nudging</td>\n      <td>IFS-FESOM</td>\n      <td>high, standard</td>\n      <td><b>01/01/2017</b></td>\n      <td><b>12/31/2023</b></td>\n      <td>cont</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Storyline simulation future climate</b></td>\n      <td>story-nudging</td>\n      <td>IFS-FESOM</td>\n      <td>high, standard</td>\n      <td><b>01/01/2017</b></td>\n      <td><b>12/31/2023</b></td>\n      <td>Tplus2.0K</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Control</b></td>\n      <td>HighResMIP</td>\n      <td>IFS-FESOM</td>\n      <td>standard</td>\n      <td><b>01/01/1990</b></td>\n      <td><b>12/31/2004</b></td>\n      <td>cont</td>\n      <td><b>MARENOSTRUM</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Future projection</b></td>\n      <td>ScenarioMIP</td>\n      <td>IFS-FESOM</td>\n      <td>high, standard</td>\n      <td><b>01/01/2020</b></td>\n      <td><b>12/31/2039</b></td>\n      <td>ssp3-7.0</td>\n      <td><b>MARENOSTRUM</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Historical simulation (NextGEMS)</b></td>\n      <td>CMIP6</td>\n      <td>IFS-FESOM</td>\n      <td>high, standard</td>\n      <td><b>01/01/1990</b></td>\n      <td><b>12/31/2019</b></td>\n      <td>hist</td>\n      <td><b>LUMI</b></td>\n      <td>ng</td>\n    </tr>\n    <tr>\n      <td><b>Future projection (NextGEMS)</b></td>\n      <td>ScenarioMIP</td>\n      <td>IFS-FESOM</td>\n      <td>standard</td>\n      <td><b>01/20/2020</b></td>\n      <td><b>12/31/2049</b></td>\n      <td>ssp3-7.0</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n    <tr>\n      <td><b>Control</b></td>\n      <td>HighResMIP</td>\n      <td>IFS-NEMO</td>\n      <td>high, standard</td>\n      <td><b>01/01/1990</b></td>\n      <td><b>04/30/2020</b></td>\n      <td>cont</td>\n      <td><b>LUMI</b></td>\n      <td>d1</td>\n    </tr>\n  </tbody>\n</table>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"visibility":"show","key":"z3clRNhA6b"}],"visibility":"show","key":"huyznbYHVH"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"div","class":"alert alert-block alert-danger","children":[{"type":"strong","children":[{"type":"text","value":"Note:","key":"Ljbl3B93Up"}],"key":"bFtRgxKXeJ"},{"type":"paragraph","children":[{"type":"text","value":"Please note that the two scenarios in Marenostrum site are still not available through HDA.","key":"rWo2iiEZ8i"}],"key":"bcaTvoTENX"}],"key":"H3AVdHwC6p"}],"visibility":"show","key":"rjsXkpmDGY"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create dropdown to select scenario\nscenario_dropdown = widgets.Dropdown(\n    options=[(f\"{entry['type']} - {entry['model']} - {resolution}\", (i, resolution)) \n             for i, entry in enumerate(scenario_simulation_table) for resolution in entry['resolution']],\n    description='Scenario:', layout=widgets.Layout(width='500px')\n)\n\n# Create date picker widgets\nstart_date_picker = widgets.DatePicker(description='Start Date:', disabled=False, layout=widgets.Layout(width='500px'))\n\noutput = widgets.Output()\n\n\n# handle dropdown event\nscenario_dropdown.observe(on_scenario_change, names='value')\n\n# Set initial values directly\nselected_sc_entry = scenario_simulation_table[0]\n\n# Convert dateFrom string to date object\ndate_from = datetime.datetime.strptime(selected_sc_entry['dateFrom'], '%m/%d/%Y').date()\n\n# Set initial values directly\nstart_date_picker.min = date_from\nstart_date_picker.max = datetime.datetime.strptime(selected_sc_entry['dateTo'], '%m/%d/%Y').date()\nstart_date_picker.value = date_from\n\ndisplay(scenario_dropdown, start_date_picker, output)","visibility":"show","key":"x58Y71GSMq"},{"type":"output","id":"Jh1yk2rgvnEEPxPMjTZ7u","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"5129f10721b84f71a3c4db3a7ee3cc62\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Dropdown(description='Scenario:', layout=Layout(width='500px'), options=(('Future projection - IFS-NEMO - highâ€¦","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"e345b10c09bb4082a993d1f7514eb013\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"DatePicker(value=datetime.date(2020, 1, 1), description='Start Date:', layout=Layout(width='500px'), max=datetâ€¦","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"6ac4061ab6084640b52cdb08d8e9ade2\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Output()","content_type":"text/plain"}}}],"visibility":"show","key":"Rr13Ox4VUZ"}],"visibility":"show","key":"P0ssAYStcs"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"selected_scenario_index, selected_scenario, selected_resolution, selected_start_date, selected_end_date, selected_hour = get_selected_values()","visibility":"show","key":"tE3Fka5Pb4"},{"type":"output","id":"vShfUCU-Wu1E6sKYNBX31","data":[],"visibility":"show","key":"vnHQniTST5"}],"visibility":"show","key":"LfiRjnMpbi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Parameter Selection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"AOzsf5Ij2R"}],"label":"ClimateDT-ParameterPlotter.ipynb-Parameter-Selection","identifier":"climatedt-parameterplotter.ipynb-parameter-selection","html_id":"climatedt-parameterplotter-ipynb-parameter-selection","key":"DMnPPoY4dK"}],"key":"b338JzmX7N"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Climate DT variable selection (we limit the plotting to one variable).\nThe variable selection is conditioned by the chosen simulation scenario.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xvv12YKqac"}],"key":"LGKwZjOkj5"}],"key":"brv1i4gX6d"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"text=widgets.Label(value='Start writing the name of the parameter of interest in the search box and/or open the dropdown menu below')\n\n# Create search box\nsearch_box = widgets.Text(placeholder='Search by parameter name', description='Search:', disabled=False)\n\n#clean the parameters to fix some errors in the current dictionary definition\ncleaned_climate_dt_dictionary=[\n    d for d in climate_dt_dictionary.climateDT_params\n    if not (d.get(\"param\") == \"130\" and d.get(\"levtype\") == \"sfc\") \n    and not ((d.get(\"param\") == \"129\" or d.get(\"param\") == \"172\") and d.get(\"levtype\") == \"sfc\" and (\"NextGEMS\" in selected_scenario['type'])) \n]\n\nmodel_filtered_options = [\n    (entry['paramName'], i)\n    for i, entry in enumerate(cleaned_climate_dt_dictionary)\n    if (selected_scenario['model'] in (entry['isFESOM'] ,entry['isIcon'],entry['isNemo']))\n]\n\n\n# Create dropdown to select entry\nentry_dropdown = widgets.Dropdown(\n    options=model_filtered_options,\n    description='Select Entry:'\n)\n\n# handle search box event\nsearch_box.observe(on_search_change, names='value')\n\n# Display widgets\ndisplay(text,search_box, entry_dropdown)\n","visibility":"show","key":"F1HMkz9ChP"},{"type":"output","id":"XrchzMKBw_7i1YLwkH9NQ","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"d341f1c59ae147ea8d0172566b819ca2\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Label(value='Start writing the name of the parameter of interest in the search box and/or open the dropdown meâ€¦","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"0b9a2cf11fad4697b23f4fe2dbe8d79f\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Text(value='', description='Search:', placeholder='Search by parameter name')","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"8feed6f9a21e4ce59d095b96430dcd6c\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Dropdown(description='Select Entry:', options=(('Total column cloud liquid water', 0), ('Total column cloud icâ€¦","content_type":"text/plain"}}}],"visibility":"show","key":"Ic84v0nTBb"}],"visibility":"show","key":"byjKfRVV4R"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Letâ€™s see the  details of the selected parameter (Polytope convention).\nIt is possible to check the its characteristics, time resolution, levels...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VvsON5bGKg"}],"key":"ylCrAGw9u6"}],"key":"vqoZmoQNaC"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"selected_index = get_selected_entry()\nselected_entry = cleaned_climate_dt_dictionary[selected_index]\nprint(json.dumps(selected_entry,indent=4))","visibility":"show","key":"RrgM5dWmRD"},{"type":"output","id":"81XXHsJRxTJM1bYT48_8l","data":[{"name":"stdout","output_type":"stream","text":"{\n    \"param\": \"167\",\n    \"paramName\": \"2 metre temperature\",\n    \"shortName\": \"2t\",\n    \"unit\": \"K\",\n    \"encoding\": \"instantaneous\",\n    \"isNemo\": \"IFS-NEMO\",\n    \"isIcon\": \"ICON\",\n    \"isFESOM\": \"IFS-FESOM\",\n    \"stream\": \"clte\",\n    \"type\": \"fc\",\n    \"time\": \"Hourly\",\n    \"levtype\": \"sfc\",\n    \"levelist\": \"\"\n}\n"}],"visibility":"show","key":"mpigw8GoCD"}],"visibility":"show","key":"ozascmlPCM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create dropdown to select hour\nhourly_slots = generate_hourly_slots()\nhour_dropdown = widgets.Dropdown(options=[(str(slot), slot) for slot in hourly_slots], description='Select Hour:', disabled=False)\n\n\n# Display widgets\nif selected_entry[\"time\"] == \"Hourly\":\n    display( hour_dropdown)","key":"HpRbMrZVNc"},{"type":"output","id":"09EV6jhjgAlUlo27Q2jRP","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"f76b6f2d7aaa45bf950bceee850c6b4b\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Dropdown(description='Select Hour:', options=(('00:00:00', datetime.time(0, 0)), ('01:00:00', datetime.time(1,â€¦","content_type":"text/plain"}}}],"key":"bWq0cHPBHt"}],"key":"xH4dcTjDJb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Levels Selection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ygoxnbShAR"}],"label":"ClimateDT-ParameterPlotter.ipynb-Levels-Selection","identifier":"climatedt-parameterplotter.ipynb-levels-selection","html_id":"climatedt-parameterplotter-ipynb-levels-selection","key":"UAItq00ttv"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Handle different Levels to be selected (if any)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LruKFVaBFS"}],"key":"p3hKcgwisR"}],"key":"ER7endHU2n"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"if selected_entry[\"levelist\"] != \"\":\n    # Convert levelist string to list of integers\n    levelist = list(map(int, selected_entry[\"levelist\"].split('/')))\n    if(selected_scenario['model']=='IFS-NEMO'):\n        levelist = levelist + [73,74,75]\n\n    # Create a dropdown widget to choose selection mode\n    selection_mode_dropdown = widgets.Dropdown(options=['Single', 'Multiple'], description='Selection Mode:')\n\n    # Create an output widget to display the selected option(s)\n    output = widgets.Output()\n\n    # Register the function to handle dropdown changes\n    selection_mode_dropdown.observe(on_dropdown_change, names='value')\n\n    # Display the widgets\n    display(selection_mode_dropdown, output)\n\n    # Display the initial widget based on default selection mode\n    display_widget('Single')","visibility":"show","key":"fJ9d4WGtKi"},{"type":"output","id":"O1KDFG2ulaoMikB_bI6Zi","data":[],"visibility":"show","key":"uU7Thncl6R"}],"visibility":"show","key":"m5Ke6AlTUK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GpEYjOA4yY"}],"identifier":"order-and-download","label":"Order and Download","html_id":"order-and-download","implicit":true,"key":"kXpStVrmEg"}],"key":"wylZUZeFKy"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Obtain Authentication Token","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yH1aafwIhu"}],"identifier":"obtain-authentication-token","label":"Obtain Authentication Token","html_id":"obtain-authentication-token","implicit":true,"key":"KS6nXdBNvu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To perform our request we need to be authenticated.\nBelow to request of an authentication token.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MYFRiXB8HW"}],"key":"vk0yzkZUo0"}],"visibility":"show","key":"LTt6YXL247"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"HzMosRRymX"},{"type":"output","id":"Hwzn7bjiZSoc5-6NrzqGW","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username:  eum-dedl-user\nPlease input your DESP password:  Â·Â·Â·Â·Â·Â·Â·Â·\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"msewaRQtar"}],"visibility":"show","key":"CwNgFAfjye"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check if DT access is granted","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cg2wCwQQWj"}],"identifier":"check-if-dt-access-is-granted","label":"Check if DT access is granted","html_id":"check-if-dt-access-is-granted","implicit":true,"key":"RPMQTDzo1y"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If DT access is not granted, you will not be able to execute the rest of the notebook.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hK5appIygm"}],"key":"L21SKdrJkk"}],"visibility":"show","key":"xixoe4irAF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"installed_version = importlib.metadata.version(\"destinelab\")\nversion_number = installed_version.split('.')[1]\nif((int(version_number) >= 8 and float(installed_version) < 1) or float(installed_version) >= 1):\n    auth.is_DTaccess_allowed(access_token)","visibility":"show","key":"uoKOPVNFQ2"},{"type":"output","id":"qzDDB-uEjB9YaDCTfyqdw","data":[{"name":"stdout","output_type":"stream","text":"DT Output access allowed\n"}],"visibility":"show","key":"J7pqpRAQOm"}],"visibility":"show","key":"vQnRgVQUQZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA Endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JwRdJL3Gco"}],"identifier":"hda-endpoint","label":"HDA Endpoint","html_id":"hda-endpoint","implicit":true,"key":"VEZlkJmTqj"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HDA API is based on the Spatio Temporal Asset Catalog specification (STAC), it is convenient define a costant with its endpoint.\nAnd another one with the ID of the Cliamte DT collection.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qvEcNaXCk7"}],"key":"o5v8uDjBTO"}],"key":"Trn98D8Sne"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"\nCOLLECTION_ID=\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\"","visibility":"show","key":"vO86m0J3xy"},{"type":"output","id":"lFPp_-A2SbR-GlZ233wqa","data":[],"visibility":"show","key":"ax6RiXVm6N"}],"visibility":"show","key":"vlqjmsI0TD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert selected parameters, simulation and levels into HDA request","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HGLHFRrcOb"}],"identifier":"convert-selected-parameters-simulation-and-levels-into-hda-request","label":"Convert selected parameters, simulation and levels into HDA request","html_id":"convert-selected-parameters-simulation-and-levels-into-hda-request","implicit":true,"key":"I4yyyX2Znf"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Convert levels (if any)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RbsipiWD7r"}],"key":"Ilbw1AnRY8"}],"key":"ZyiDV6Uvi2"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"levlInput = \"\"\nif global_widget != None:\n    # Test cases\n    levlInput = convert_to_string(global_widget.value)","visibility":"show","key":"gSXwWTGtiz"},{"type":"output","id":"_p5-VCGJrtTVHtGnq_5WV","data":[],"visibility":"show","key":"O3jeXNFFTp"}],"visibility":"show","key":"XQ8Pgao8yV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert the chosen parameters into an HDA request for Climate DT data and print the created filters.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G79IiKnzJW"}],"key":"ihO6Qg59My"}],"key":"J9pv8n64l7"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"hourchoice4 = '{shour}00'.format(shour = str(get_selected_hours()).split(\":\")[0])\n\nfilter_params = {\n  \"ecmwf:class\" : get_selected_values()[1] .get(\"class\",\"d1\"),\n  \"ecmwf:dataset\": \"climate-dt\",   # fixed climate-dt access\n  \"ecmwf:activity\" : get_selected_values()[1][\"activity\"],\n  \"ecmwf:experiment\" : get_selected_values()[1][\"experiment\"].upper(),\n  \"ecmwf:model\": get_selected_values()[1][\"model\"],\n  \"ecmwf:generation\": \"1\",         # fixed Specifies the generation of the dataset, which can be incremented as required (latest is 1)\n  \"ecmwf:resolution\": get_selected_values()[2],      # standard/ high \n  \"ecmwf:expver\": \"0001\",          # fixed experiment version \n  \"ecmwf:stream\": selected_entry[\"stream\"],\n  \"ecmwf:time\": hourchoice4,            # choose the hourly slot(s)\n  \"ecmwf:type\": \"fc\",              # fixed forecasted fields\n  \"ecmwf:levtype\": selected_entry[\"levtype\"],  \n  \"ecmwf:levelist\": str(levlInput),  \n  \"ecmwf:param\": str(selected_entry[\"param\"]),\n  \"ecmwf:realization\":get_selected_values()[1] .get(\"realization\", \"1\")\n}\n\n# Print the result in JSON format\ndatechoice = \"{fname}T{shour}Z\".format(fname = get_selected_values()[3], shour = get_selected_hours() )\n\n# Check if levelist is empty and remove it\nif filter_params.get(\"ecmwf:levelist\") == \"\":\n    del filter_params[\"ecmwf:levelist\"]\n\nif selected_entry[\"time\"] == \"Daily\":\n    del filter_params[\"ecmwf:time\"]\n\nhdaFilters = {\n    key: {\"eq\": value}\n    for key, value in filter_params.items()\n}\n\n\nprint(\"Polytope API format for the selected values. The json below can be copied and used with the polytope API\\n\")\npolytope_payload = {key.replace(\"ecmwf:\", \"\"): value for key, value in filter_params.items()}\n#add date\ndate4poly =get_selected_values()[3].strftime(\"%Y%m%d\")\npolytope_payload[\"date\"]=date4poly+\"/to/\"+date4poly\nprint(json.dumps(polytope_payload, indent=4))","visibility":"show","key":"ADrf5Dj0JM"},{"type":"output","id":"6wYqVi-oZ1q6-myNbXAiV","data":[{"name":"stdout","output_type":"stream","text":"Polytope API format for the selected values. The json below can be copied and used with the polytope API\n\n{\n    \"class\": \"d1\",\n    \"dataset\": \"climate-dt\",\n    \"activity\": \"ScenarioMIP\",\n    \"experiment\": \"SSP3-7.0\",\n    \"model\": \"IFS-NEMO\",\n    \"generation\": \"1\",\n    \"resolution\": \"high\",\n    \"expver\": \"0001\",\n    \"stream\": \"clte\",\n    \"time\": \"0000\",\n    \"type\": \"fc\",\n    \"levtype\": \"sfc\",\n    \"param\": \"167\",\n    \"realization\": \"1\",\n    \"date\": \"20260606/to/20260606\"\n}\n"}],"visibility":"show","key":"tWY14ivhVL"}],"visibility":"show","key":"V0dszLsYbj"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtering","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"npZlOLewwT"}],"identifier":"filtering","label":"Filtering","html_id":"filtering","implicit":true,"key":"riVdwzciyg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Search into asynchronous datasets, as the DTs are, always return a single item:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eEtz5c1lpc"}],"key":"U8yUDJFsOl"}],"visibility":"show","key":"huVU19eAPT"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#Sometimes requests to polytope get timeouts, it is then convenient define a retry strategy\nretry_strategy = Retry(\n    total=5,  # Total number of retries\n    status_forcelist=[500, 502, 503, 504],  # List of 5xx status codes to retry on\n    allowed_methods=[\"GET\",'POST'],  # Methods to retry\n    backoff_factor=1  # Wait time between retries (exponential backoff)\n)\n\n# Create an adapter with the retry strategy\nadapter = HTTPAdapter(max_retries=retry_strategy)\n\n# Create a session and mount the adapter\nsession = requests.Session()\nsession.mount(\"https://\", adapter)\n\nresponse = session.post(HDA_STAC_ENDPOINT+\"/search\", headers=auth_headers, json={\n \"collections\": [\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\"],\n    \"datetime\": datechoice,\n    \"query\": hdaFilters\n})\n\nif(response.status_code!= 200):\n    (print(response.text))\nresponse.raise_for_status()\n\nproduct = response.json()[\"features\"][0]\nJSON(product)","visibility":"show","key":"CBiRXZqy5m"},{"type":"output","id":"4CoCn5yusjOPPPjiumwch","data":[{"output_type":"execute_result","execution_count":17,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"assets\":{},\"bbox\":[-180,-90,180,90],\"collection\":\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\",\"geometry\":{\"coordinates\":[[[180,-90],[180,90],[-180,90],[-180,-90],[180,-90]]],\"type\":\"Polygon\"},\"id\":\"DT_CLIMATE_ADAPTATION_ORDERABLE_a553612ba7e4801cccf92a1d2634b24aa32cc220\",\"links\":[{\"body\":{\"activity\":\"ScenarioMIP\",\"class\":\"d1\",\"dataset\":\"climate-dt\",\"date\":\"20260606/to/20260606\",\"experiment\":\"SSP3-7.0\",\"expver\":\"0001\",\"generation\":\"1\",\"levtype\":\"sfc\",\"model\":\"IFS-NEMO\",\"param\":\"167\",\"realization\":\"1\",\"resolution\":\"high\",\"stream\":\"clte\",\"time\":\"0000\",\"type\":\"fc\"},\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/order\",\"method\":\"POST\",\"rel\":\"retrieve\",\"title\":\"Retrieve\",\"type\":\"application/geo+json\"},{\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\",\"rel\":\"collection\",\"title\":\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\",\"type\":\"application/json\"},{\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/items/DT_CLIMATE_ADAPTATION_ORDERABLE_a553612ba7e4801cccf92a1d2634b24aa32cc220\",\"rel\":\"self\",\"title\":\"Original item link\",\"type\":\"application/geo+json\"}],\"properties\":{\"alias\":\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\",\"collection\":\"climate-dt\",\"datetime\":\"2026-06-06T00:00:00.000000Z\",\"ecmwf:activity\":\"ScenarioMIP\",\"ecmwf:class\":\"d1\",\"ecmwf:dataset\":\"climate-dt\",\"ecmwf:date\":\"20260606/to/20260606\",\"ecmwf:experiment\":\"SSP3-7.0\",\"ecmwf:expver\":\"0001\",\"ecmwf:generation\":\"1\",\"ecmwf:levtype\":\"sfc\",\"ecmwf:model\":\"IFS-NEMO\",\"ecmwf:param\":\"167\",\"ecmwf:realization\":\"1\",\"ecmwf:resolution\":\"high\",\"ecmwf:stream\":\"clte\",\"ecmwf:time\":\"0000\",\"ecmwf:type\":\"fc\",\"end_datetime\":\"2026-06-06T00:00:00.000000Z\",\"federation:backends\":[\"dedt_lumi\"],\"license\":\"CC-BY-4.0\",\"order:status\":\"orderable\",\"scope\":{\"discover\":null,\"download\":\"DPAD_Direct_Access\",\"search\":\"DPAD_Direct_Access\"},\"stacCollection\":\"/eodag/collections/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION.json\",\"start_datetime\":\"2026-06-06T00:00:00.000000Z\",\"storage:tier\":\"offline\",\"title\":\"DT_CLIMATE_ADAPTATION_ORDERABLE_a553612ba7e4801cccf92a1d2634b24aa32cc220\"},\"stac_extensions\":[\"https://stac-extensions.github.io/storage/v1.0.0/schema.json\",\"https://stac-extensions.github.io/order/v1.1.0/schema.json\"],\"stac_version\":\"1.0.0\",\"type\":\"Feature\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"LQKq2XfcGi"}],"visibility":"show","key":"u0j5WGFqEs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The single item returned (above) contains:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cWQ3l3PFAQ"}],"key":"Xyu5qS4Vbx"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The product id: â€œDT_CLIMATE_ADAPTATION_ORDERABLE_...â€, that is a placeholder, its name contains the term â€œORDERABLEâ€.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"J3FGAVE5GJ"}],"key":"Nh4nKcrvUB"}],"key":"jD32QdyPKX"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The storage:tier that indicates that the product is â€œofflineâ€","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JdxCKQlae3"}],"key":"uAt7Z29FAF"}],"key":"CFk7wClaoN"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The order:status that indicates that the product is â€œorderableâ€","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"UeR03X5tt1"}],"key":"b8VzKwkgnh"}],"key":"w7o3QzSdiV"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request params used for the order extracted from the search result","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RiCcZWwF9d"}],"key":"Yo4RFWMcY6"}],"key":"dW4thNXjZY"}],"key":"eozRoAWq2a"}],"key":"JUNxsHMiti"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ecmwf_properties = {\n    key: value for key, value in product.get('properties', {}).items()\n    if key.startswith('ecmwf:')\n}\n\nprint(\"HDA API format for the selected values. The json below can be copied and used with the HDA order API\\n\")\nprint(json.dumps(ecmwf_properties, indent=4))","visibility":"show","key":"maJqVmQBO5"},{"type":"output","id":"WEU4j4_lg_jFUhGjzabgj","data":[{"name":"stdout","output_type":"stream","text":"HDA API format for the selected values. The json below can be copied and used with the HDA order API\n\n{\n    \"ecmwf:resolution\": \"high\",\n    \"ecmwf:model\": \"IFS-NEMO\",\n    \"ecmwf:type\": \"fc\",\n    \"ecmwf:dataset\": \"climate-dt\",\n    \"ecmwf:param\": \"167\",\n    \"ecmwf:levtype\": \"sfc\",\n    \"ecmwf:expver\": \"0001\",\n    \"ecmwf:date\": \"20260606/to/20260606\",\n    \"ecmwf:realization\": \"1\",\n    \"ecmwf:activity\": \"ScenarioMIP\",\n    \"ecmwf:class\": \"d1\",\n    \"ecmwf:stream\": \"clte\",\n    \"ecmwf:time\": \"0000\",\n    \"ecmwf:experiment\": \"SSP3-7.0\",\n    \"ecmwf:generation\": \"1\"\n}\n"}],"visibility":"show","key":"d68CsS1Ma8"}],"visibility":"show","key":"ntxo9EP90l"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Order data","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Zi6Fm1EQp2"}],"label":"ClimateDT-ParameterPlotter.ipynb-Order-and-Download","identifier":"climatedt-parameterplotter.ipynb-order-and-download","html_id":"climatedt-parameterplotter-ipynb-order-and-download","key":"iLQsJNhSww"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We have now all the information to order the data.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"nI2GOHkQ9n"}],"key":"NhWcLvVV2e"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"From the search results we know that the product is orderable and offline, we then need to order the product we searched for.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Ozmxg4pzhF"}],"key":"ZDIs4XORvX"}],"key":"CREh8dNOQS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json=ecmwf_properties, headers=auth_headers)\n\nif response.status_code != 200:\n    print(response.content)\nresponse.raise_for_status()\n\nordered_item = response.json()\n\nproduct_id = ordered_item[\"id\"]\nstorage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\norder_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\nfederation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\nprint(f\"Product ordered: {product_id}\")\nprint(f\"Provider: {federation_backend}\")\nprint(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\nprint(f\"Order status: {order_status}\")    ","visibility":"show","key":"bA6AjLPQlS"},{"type":"output","id":"aZcXvvplO496RaYV2kvtP","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: f316766b-06ce-45d7-a58e-87c154d1b26a\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\n"}],"visibility":"show","key":"kdQ6xhLzbK"}],"visibility":"show","key":"ByvlVzlCWv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Poll the API until product is ready","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pgkk8vW2zY"}],"identifier":"poll-the-api-until-product-is-ready","label":"Poll the API until product is ready","html_id":"poll-the-api-until-product-is-ready","implicit":true,"key":"figMjhZtxC"}],"key":"oLxPBAVLNb"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We request the product itself to get an update of its status.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e3SLS187Qs"}],"key":"MTucB63WXF"}],"visibility":"show","key":"VcQJZFtKpl"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\nself_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\nitem = {}\n\nfor i in range(0, TIMEOUT, STEP):\n    print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n    response = requests.get(self_url, headers=auth_headers)\n    if response.status_code != 200:\n        print(response.content)\n    response.raise_for_status()\n    item = response.json()\n\n    storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n    if storage_tier == ONLINE_STATUS:\n        download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n        print(\"Product is ready to be downloaded.\")\n        print(f\"Asset URL: {download_url}\")\n        break\n\n    sleep(STEP)\nelse:\n    order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n    print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")\n    \n","visibility":"show","key":"egYEdwTaR4"},{"type":"output","id":"djJ5k0bMSGh26PK7u2a1J","data":[{"name":"stdout","output_type":"stream","text":"Polling 1/300\nPolling 2/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.lumi.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/f316766b-06ce-45d7-a58e-87c154d1b26a/downloadLink\n"}],"visibility":"show","key":"PhiWeFRMXG"}],"visibility":"show","key":"iKU4SQj63u"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r39LcRJ1Nf"}],"identifier":"download","label":"Download","html_id":"download","implicit":true,"key":"o02s7JzO6H"}],"key":"a2PlPkyCv3"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.get(download_url, stream=True, headers=auth_headers)\nresponse.raise_for_status()\n\ncontent_disposition = response.headers.get('Content-Disposition')\ntotal_size = int(response.headers.get(\"content-length\", 0))\nif content_disposition:\n    filename = content_disposition.split('filename=')[1].strip('\"')\n    filename = unquote(filename)\nelse:\n    filename = os.path.basename(url)\n\n# Open a local file in binary write mode and write the content\nprint(f\"downloading {filename}\")\n\nwith tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n    with open(filename, 'wb') as f:\n        for data in response.iter_content(1024):\n            progress_bar.update(len(data))\n            f.write(data)","visibility":"show","key":"qJn4hkVmBS"},{"type":"output","id":"vuUoldbZGpWeMqQLLOULq","data":[{"name":"stdout","output_type":"stream","text":"downloading f316766b-06ce-45d7-a58e-87c154d1b26a.grib\n"},{"name":"stderr","output_type":"stream","text":"26.2MB [00:00, 31.5MB/s]\n"}],"visibility":"show","key":"iQdOSPphlA"}],"visibility":"show","key":"g5CsbXXPTR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"liClXiLBjz"}],"label":"ClimateDT-ParameterPlotter.ipynb-EarthKit","identifier":"climatedt-parameterplotter.ipynb-earthkit","html_id":"climatedt-parameterplotter-ipynb-earthkit","key":"qTX4uDGM4W"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Lets plot the result file with ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"a6Rq4aA00j"},{"type":"link","url":"https://earthkit.readthedocs.io/en/latest/index.html","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"S0uamNYb8t"}],"urlSource":"https://earthkit.readthedocs.io/en/latest/index.html","key":"VgTSFMzgY8"},{"type":"text","value":" selecting only the Europe area in the plot.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AKiHqks0Hy"}],"key":"VmDNzpIYsp"}],"key":"EOLCgsNSyG"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data\nimport earthkit.plots\nimport earthkit.regrid\n\ndata = earthkit.data.from_source(\"file\", filename)\nearthkit.plots.quickplot(data,domain=\"Europe\")","visibility":"show","key":"c4qIdHXAKe"},{"type":"output","id":"MTDSpDyp2vUThoJ4U39OP","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"<earthkit.plots.components.figures.Figure at 0x7f1b75179110>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"85060b090cd5edb6fe5f3fa860e4ff9d","path":"/build/85060b090cd5edb6fe5f3fa860e4ff9d.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"Fr24FN3aUr"}],"visibility":"show","key":"OTyguXwOWf"}],"key":"JPzpkFKgYV"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}