{"version":2,"kind":"Notebook","sha256":"5599f5b8dbb099fc1e2bdc180483a6da6e8f42a60586c2241e5ae62ebf0bf2bc","slug":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-level","location":"/production/HDA/CDS_data/DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb","dependencies":[],"frontmatter":{"title":"ERA5 hourly data on single levels from 1940 to present","subtitle":"This notebook shows how to authenticate with the DestinE API, queries and downloads ERA5 single-level reanalysis data using the DEDL HDA service, and visualizes the result with EarthKit.","tags":["HDA","STAC","ECMWF"],"copyright":"¬© 2025 EUMETSAT","authors":[{"id":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)","name":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb","url":"/build/DEDL-HDA-EO.ECMWF.DA-195d3115e217b91436cf42f15b7c4700.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/CDS_data/DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"üöÄ Launch in JupyterHub","key":"wt6iC6huau"}],"key":"S4sySLVHtE"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/CDS_data/DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb","key":"wTdpOpTVXT"}],"key":"vBEJ09aseP"}],"key":"cDlfHD1t5j"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"Prerequisites:","key":"gt3X6w5rMZ"}],"key":"Id0IKPIaNI"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DEDL data a ","key":"NJQnnb5lxd"},{"type":"link","url":"https://platform.destine.eu/","children":[{"type":"text","value":"DestinE user account","key":"uuMhgrakXV"}],"urlSource":"https://platform.destine.eu/","key":"JcNtOCsFIK"},{"type":"text","value":" is needed","key":"KDPh5jnpyP"}],"key":"U45CBKwTrq"}],"key":"nK321QU3ty"}],"key":"XnmOlVVnwj"},{"type":"strong","children":[{"type":"text","value":"References:","key":"fNw4YvCrwM"}],"key":"gwInCMcFgj"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","children":[{"type":"text","value":"DestinE Data Lake (DEDL) Harmonized Data Access (HDA) documentation","key":"fyj6SO3APA"}],"urlSource":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","key":"FwmZ74c8NH"}],"key":"BkINFQvgCb"}],"key":"bfvjSNWKEh"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=overview","children":[{"type":"text","value":"ERA5 data documentation","key":"MkRHqpm3Sv"}],"urlSource":"https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=overview","key":"AL103fV64e"}],"key":"C4e121cuBn"}],"key":"UTIqwTtyI2"}],"key":"YyaZS3YnqZ"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"DK0ZJFYBYA"}],"key":"oAYcIWI83G"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Earthkit and HDA Polytope used in this context are both packages provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"m2pCLUSpMv"}],"key":"iZhlfMxwx5"}],"key":"k4dfw360YA"}],"key":"JUYONyPuvY"}],"key":"CKPe6NE5Ht"}],"visibility":"show","key":"xUKjBQ54sR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to use the HDA (Harmonized Data Access) API to access ERA5 hourly data on single levels, and how to visualize the data using the Earthkit package provided by ECMWF.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Rk5aiPq2sk"}],"key":"mpkNV47QVm"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The method used to access this dataset can be applied to all the datasets hosted by the climate data store provided through HDA.\nThe complete list of the climate data store federated datasets provided by HDA:  ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"F6DSrP4tiC"},{"type":"link","url":"https://hda.data.destination-earth.eu/stac/collections?provider=cop_cds","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"https://‚Äãhda‚Äã.data‚Äã.destination‚Äã-earth‚Äã.eu‚Äã/stac‚Äã/collections‚Äã?provider‚Äã=‚Äãcop‚Äã_cds","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T0WLCn4Iey"}],"urlSource":"https://hda.data.destination-earth.eu/stac/collections?provider=cop_cds","key":"LVNywonS4F"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aftUbIcI7E"}],"key":"sbeYU5RNja"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Below the main steps covered by this tutorial.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Iy84GHkOgB"}],"key":"NBzGMaT6xY"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Authenticate","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"n1igc5ifAp"}],"identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-authenticate","label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-Authenticate","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-authenticate","key":"O8sPUMjlyp"},{"type":"text","value":": How to authenticate for searching and access ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pB62Ur1TgL"},{"type":"emphasis","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"DEDL","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ZHzz5zEmP1"}],"key":"Vy4a4AZ9kc"},{"type":"text","value":" collections.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"CpXGyoc4KT"}],"key":"iHFYIzmZIS"}],"key":"zKKwqIqahE"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Order data","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"DY1WCwbPBi"}],"identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-order","label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-Order","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-order","key":"NU3qLJMVuk"},{"type":"text","value":":  How to order ERA5 hourly data on single levels data through HDA.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"elfXOTD98O"}],"key":"jCG9SipULp"}],"key":"KBS5uLsDAP"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Download data","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"CanLIwDMbB"}],"identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-download","label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-Download","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-download","key":"a0uxO2mAC7"},{"type":"text","value":": How to download hourly data on single levels data through HDA.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"r9AiAM28fA"}],"key":"P7EGEGyhZw"}],"key":"XJOxbN2VXG"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Visualize","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"B2dFB7vlUU"}],"identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-earthkit","label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-EarthKit","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-earthkit","key":"pauUCFL26m"},{"type":"text","value":": How to visualize hourly data on single levels data through Earthkit.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"JiGlQbsgOn"}],"key":"HQe2iz39to"}],"key":"Dzc6Y4ZNeF"}],"key":"BlxdkfJ6zk"}],"key":"FrTw6G4wkm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Authenticate","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gNku8I8ZgX"}],"label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-Authenticate","identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-authenticate","html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-authenticate","key":"CUdngTwuU0"}],"key":"e6bNK7A71U"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First we import the required packages","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xt9QQXBQgF"}],"key":"SmAgfOXGQN"}],"key":"hO0sOApb23"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import requests\nimport json\nimport os\nimport json\nfrom getpass import getpass\nfrom IPython.display import JSON\nimport destinelab as deauth\nfrom tqdm import tqdm\nimport time\nfrom urllib.parse import unquote\nfrom time import sleep","visibility":"show","key":"UTIhe7nNVj"},{"type":"output","id":"dA6gcUEVyBiU0-8PuZy8l","data":[],"visibility":"show","key":"rI1zDGBXrm"}],"visibility":"show","key":"AEVo0agNRm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We get an access token for the API","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aJ6FgS7fIk"}],"key":"WnSjb9Lp3V"}],"key":"EfHwqrLh6s"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username or email: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"uflcYscpc1"},{"type":"output","id":"T-r_Znqi38wNguZGeybhn","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username or email:  eum-dedl-user\nPlease input your DESP password:  ¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"SiVFa6QeCg"}],"visibility":"show","key":"dIEk9RFxdL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Order","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vcu5ij9mFU"}],"label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-Order","identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-order","html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-order","key":"XBxCNd6N6M"}],"key":"qulhXp4491"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Climate data store datasets need to be ordered.\nBelow the steps to order the data of our interest.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QSFg2rl505"}],"key":"CtUFnkcwSw"}],"key":"eKOzRgkqSH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JC4shK84A5"}],"identifier":"hda-endpoint","label":"HDA endpoint","html_id":"hda-endpoint","implicit":true,"key":"G8jNv2UdxG"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"HDA API is based on the Spatio Temporal Asset Catalog specification (STAC), it is convenient define a costant with its endpoint.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"t0Fzlx8uCT"}],"key":"WpMMB8loem"}],"key":"HN8Ya5jMBO"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"","visibility":"show","key":"jPYWydiQJz"},{"type":"output","id":"BeZGsUtmPEftiPw9DFRdC","data":[],"visibility":"show","key":"N2NSt94QxJ"}],"visibility":"show","key":"NlmrVkJdy6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Collection discovery","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bzJ2YeqYK9"}],"identifier":"collection-discovery","label":"Collection discovery","html_id":"collection-discovery","implicit":true,"key":"s69hUfZC0D"}],"key":"At3Cy75uc4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Each HDA collection has its own ID to be used to query the collection.\nLet‚Äôs discover the ID of our collection of interest using the HDA discovery API with some filter, e.g. the federated provider along with the ‚ÄúERA5‚Äù text parameter.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ksK37cvazp"}],"key":"SlP925LVW3"}],"key":"AZEeb3Om7L"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.get(f\"{HDA_STAC_ENDPOINT}/collections\",params = {\"query\": '{\"federation:backends\": {\"eq\": \"cop_cds\"}}',\"q\": \"ERA5\"})\nJSON(response.json()) ","visibility":"show","key":"ZMXFkeQFG1"},{"type":"output","id":"5mhH_RNATJn67yCB7lKBS","data":[{"output_type":"execute_result","execution_count":4,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content_type":"application/json","hash":"88d1dc3f8515fe4f6c63cef35d7f32ae","path":"/build/88d1dc3f8515fe4f6c63cef35d7f32ae.json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"DDq6MPE28F"}],"visibility":"show","key":"cnLjiTkoCA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The collection ‚ÄúERA5 hourly data on single levels from 1940 to present‚Äù has the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UPGC53N0lr"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"id ‚ÄúEO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS‚Äù","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nrWrAxPcfj"}],"key":"NysfOLYCDb"},{"type":"text","value":" in HDA.\nWe will use this ID for all the following operations.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QVBaQTSIAI"}],"key":"vtpZpVSnkb"}],"key":"M1plXLiTbC"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"COLLECTION_ID = \"EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS\"","visibility":"show","key":"mE6VKqFKNM"},{"type":"output","id":"27SbAcMhvc251ItatqAh4","data":[],"visibility":"show","key":"gGO8nE4aDy"}],"visibility":"show","key":"jxZZWF0XG8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtering","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WpI6eeljYJ"}],"identifier":"filtering","label":"Filtering","html_id":"filtering","implicit":true,"key":"VI3gKh8ziL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The ‚ÄúERA5 hourly data on single levels from 1940 to present‚Äù dataset, as well as the others datasets provided by the CDS (Climate Data Store),\ncan be subset requesting only the data of interest.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DvYTcXUmOj"}],"key":"MZ231wItnV"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The set of parameters to subset the data are available through the HDA queryables endpoint. For this specific collection: ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"G4EbyWTHQh"},{"type":"link","url":"https://hda.data.destination-earth.eu/stac/collections/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS/queryables","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Filter Options","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Vnq9MkDW21"}],"urlSource":"https://hda.data.destination-earth.eu/stac/collections/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS/queryables","key":"azP1njJciQ"},{"type":"text","value":"\nTo understand how the HDA queryables API works you can also have a look at the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"bCtMVclz43"},{"type":"link","url":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/REST/HDA-REST-Queryables.ipynb","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"queryables notebook","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"PZnCDOD7hO"}],"urlSource":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/REST/HDA-REST-Queryables.ipynb","data":{"kind":"file","org":"destination-earth","repo":"DestinE-DataLake-Lab","reference":"main","file":"HDA/REST/HDA-REST-Queryables.ipynb","raw":"https://raw.githubusercontent.com/destination-earth/DestinE-DataLake-Lab/main/HDA/REST/HDA-REST-Queryables.ipynb"},"internal":false,"protocol":"github","key":"VlYcpIo5VP"}],"key":"TzTPc2Yqz4"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Using the information provided by the queryables endpoint, we can download the data we are interested in. In this example we will download the 2m temperature and sea surface temperature data for the hottest day in 2024, July 22nd.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"b38XLVVWyr"}],"key":"haKd5xrhdS"}],"key":"n3d1xJtz3m"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Search into asynchronous datasets, as the CDS datasets are, always return a single item:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vOcWP6jZef"}],"key":"fLM0qBZYgX"}],"key":"Cgx59GiuGw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"filters = {\n    key: {\"eq\": value}\n    for key, value in {\n        \"ecmwf:data_format\": \"grib\",\n        \"ecmwf:variable\": [\"2m_temperature\",\"sea_surface_temperature\"],\n        \"ecmwf:time\": \"12:00\",\n        \"ecmwf:day\": \"22\",\n        \"ecmwf:month\": \"7\",\n        \"ecmwf:year\": \"2024\"\n    }.items()\n}\n\n\nresponse = requests.post(f\"{HDA_STAC_ENDPOINT}/search\", headers=auth_headers, json={\n \"collections\": [\"EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS\"],\n    \"query\": filters\n})\n\nif(response.status_code!= 200):\n    (print(response.text))\nresponse.raise_for_status()\n\nproduct = response.json()[\"features\"][0]\nJSON(product)","visibility":"show","key":"ZSRRMSkCtM"},{"type":"output","id":"zln8dMeeEkHCzLkyLdCb0","data":[{"output_type":"execute_result","execution_count":6,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"assets\":{},\"bbox\":[-180,-90,180,90],\"collection\":\"EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS\",\"geometry\":{\"coordinates\":[[[180,-90],[180,90],[-180,90],[-180,-90],[180,-90]]],\"type\":\"Polygon\"},\"id\":\"ERA5_SL_ORDERABLE_c98c2519a657f0ee50dc308b0476059d524ab282\",\"links\":[{\"body\":{\"data_format\":\"grib\",\"day\":\"22\",\"download_format\":\"zip\",\"month\":\"7\",\"product_type\":\"reanalysis\",\"time\":\"12:00\",\"variable\":[\"2m_temperature\",\"sea_surface_temperature\"],\"year\":\"2024\"},\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS/order\",\"method\":\"POST\",\"rel\":\"retrieve\",\"title\":\"Retrieve\",\"type\":\"application/geo+json\"},{\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS\",\"rel\":\"collection\",\"title\":\"EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS\",\"type\":\"application/json\"},{\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS/items/ERA5_SL_ORDERABLE_c98c2519a657f0ee50dc308b0476059d524ab282\",\"rel\":\"self\",\"title\":\"Original item link\",\"type\":\"application/geo+json\"}],\"properties\":{\"alias\":\"EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS\",\"collection\":\"ERA5_SL\",\"datetime\":\"2024-07-22T12:00:00.000000Z\",\"ecmwf:data_format\":\"grib\",\"ecmwf:dataset\":\"reanalysis-era5-single-levels\",\"ecmwf:day\":\"22\",\"ecmwf:download_format\":\"zip\",\"ecmwf:month\":\"7\",\"ecmwf:product_type\":\"reanalysis\",\"ecmwf:time\":\"12:00\",\"ecmwf:variable\":[\"2m_temperature\",\"sea_surface_temperature\"],\"ecmwf:year\":\"2024\",\"end_datetime\":\"2024-07-22T12:00:00.000000Z\",\"federation:backends\":[\"cop_cds\"],\"license\":\"proprietary\",\"order:status\":\"orderable\",\"scope\":{\"discover\":null,\"download\":\"hda-public-data-access\",\"search\":\"hda-public-data-access\"},\"stacCollection\":\"/eodag/collections/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.json\",\"start_datetime\":\"2024-07-22T12:00:00.000000Z\",\"storage:tier\":\"offline\",\"title\":\"ERA5_SL_ORDERABLE_c98c2519a657f0ee50dc308b0476059d524ab282\"},\"stac_extensions\":[\"https://stac-extensions.github.io/storage/v1.0.0/schema.json\",\"https://stac-extensions.github.io/order/v1.1.0/schema.json\"],\"stac_version\":\"1.0.0\",\"type\":\"Feature\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"Lmx8BTnZFH"}],"visibility":"show","key":"yWB9bYZVQw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The single item returned (above) contains:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CH9YMX93gU"}],"key":"AndY9KUOvw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The product id: ‚ÄúERA5_SL_ORDERABLE_...‚Äù, that is a placeholder, its name contains the term ‚ÄúORDERABLE‚Äù.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DIO0kLB3LG"}],"key":"lPOgnuOaXI"}],"key":"y8hVr3rCXy"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The storage:tier that indicates that the product is ‚Äúoffline‚Äù","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TCqrrPuDkt"}],"key":"hLIY8Zy8uO"}],"key":"Fx0jwrK41S"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The order:status that indicates that the product is ‚Äúorderable‚Äù","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"cMtKoRZviq"}],"key":"y249my9Ypa"}],"key":"qLK4Bnt08z"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Request params used for the order extracted from the search result:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UKoqT7E1pi"}],"key":"RdWjeCMnJ9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:variables: ‚Äú2m_temperature‚Äù, ‚Äúsea_surface_temperature‚Äù","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eCRcGeXPqL"}],"key":"WbZgryTvpz"}],"key":"qySjfWIF64"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:day:‚Äú22‚Äù","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ohWMrzNeAi"}],"key":"TBZrwCDG12"}],"key":"vv36YpTW4H"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:dataset:‚Äúreanalysis-era5-single-levels‚Äù","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fJjGMrcD7l"}],"key":"JlAIwSuE9T"}],"key":"DsBCDTvs7g"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:month:‚Äú7‚Äù","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"quTty9X0iz"}],"key":"VbYEu3T5Gy"}],"key":"xFPhgWZgUC"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:data_format:‚Äúgrib‚Äù","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"BBa5p3ukgg"}],"key":"hqkivvclEV"}],"key":"r8fypGcZ38"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:time:‚Äú12:00‚Äù","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"wnaLkviA3Y"}],"key":"HgmIQfITOi"}],"key":"E2rZPYdOJV"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:year:‚Äú2024‚Äù","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LJ3aGbbWAf"}],"key":"nwJn0AOODN"}],"key":"woOcWwEES3"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ecmwf:product_type:‚Äúreanalysis‚Äù","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"k4LIjOHa30"}],"key":"n6s9ASMQZK"}],"key":"LcAZtpURgp"}],"key":"CyXidjb2K2"}],"key":"RPOJR5MlSw"}],"key":"GwtUwo3A0M"}],"key":"w7cqXcEuQn"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Order data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eDINe9unTi"}],"identifier":"order-data","label":"Order data","html_id":"order-data","implicit":true,"key":"Czofk0fxae"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We have now all the information to order the data.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"O9eCRtWat2"}],"key":"ZiIupg6m5Y"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"From the search results we know that the product is orderable and offline, we then need to order the product we searched for.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zxW6yisbrV"}],"key":"TVdWV1fgIp"}],"visibility":"show","key":"Tw9j1SYm3l"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json={\n        \"ecmwf:data_format\": \"grib\",\n        \"ecmwf:variable\": [\"2m_temperature\",\"sea_surface_temperature\"],\n        \"ecmwf:time\": \"12:00\",\n        \"ecmwf:day\": \"22\",\n        \"ecmwf:month\": \"7\",\n        \"ecmwf:year\": \"2024\"\n    }, headers=auth_headers)\n\nif response.status_code != 200:\n    print(response.content)\nresponse.raise_for_status()\n\nordered_item = response.json()\n\nproduct_id = ordered_item[\"id\"]\nstorage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\norder_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\nfederation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\nprint(f\"Product ordered: {product_id}\")\nprint(f\"Provider: {federation_backend}\")\nprint(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\nprint(f\"Order status: {order_status}\")","visibility":"show","key":"TBD00Fyxf8"},{"type":"output","id":"vwcPx_iiOKBRPdrTimc_Q","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: 56226997-81de-46e3-987e-16d2b6bd9fdc\nProvider: cop_cds\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\n"}],"visibility":"show","key":"y29U2jUrB2"}],"visibility":"show","key":"EuYpY9M7TZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Poll the API until product is ready","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ypvib7nAeL"}],"identifier":"poll-the-api-until-product-is-ready","label":"Poll the API until product is ready","html_id":"poll-the-api-until-product-is-ready","implicit":true,"key":"NXejqJRMuq"}],"key":"wnqUsnC1a0"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We request the product itself to get an update of its status.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WyyoLOceEM"}],"key":"nvO5W6IlNH"}],"visibility":"show","key":"E9TOroDkg6"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\nself_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\nitem = {}\n\nfor i in range(0, TIMEOUT, STEP):\n    print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n    response = requests.get(self_url, headers=auth_headers)\n    response.raise_for_status()\n    item = response.json()\n\n    storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n    if storage_tier == ONLINE_STATUS:\n        download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n        print(\"Product is ready to be downloaded.\")\n        print(f\"Asset URL: {download_url}\")\n        break\n\n    sleep(STEP)\nelse:\n    order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n    print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")\n    \n","visibility":"show","key":"V4Q55FcZtl"},{"type":"output","id":"p6rO-d_pyZW0B-v7EAuAa","data":[{"name":"stdout","output_type":"stream","text":"Polling 1/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/cop_cds/EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS/56226997-81de-46e3-987e-16d2b6bd9fdc/downloadLink\n"}],"visibility":"show","key":"CDfGLMTXob"}],"visibility":"show","key":"QAWzQuAWB7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Download","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"I6gVh5KmKe"}],"label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-Download","identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-download","html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-download","key":"zi8SMZCJwj"}],"key":"S1JVptOfRm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.get(download_url, stream=True, headers=auth_headers)\nresponse.raise_for_status()\n\ncontent_disposition = response.headers.get('Content-Disposition')\ntotal_size = int(response.headers.get(\"content-length\", 0))\nif content_disposition:\n    filename = content_disposition.split('filename=')[1].strip('\"')\n    filename = unquote(filename)\nelse:\n    filename = os.path.basename(url)\n\n# Open a local file in binary write mode and write the content\nprint(f\"downloading {filename}\")\n\nwith tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n    with open(filename, 'wb') as f:\n        for data in response.iter_content(1024):\n            progress_bar.update(len(data))\n            f.write(data)","visibility":"show","key":"RIoohm40VG"},{"type":"output","id":"a7zXKebuDNVy-ckd8ie5i","data":[{"name":"stdout","output_type":"stream","text":"downloading 33234ee8bd470d40bf20fa952f2e428f.zip\n"},{"name":"stderr","output_type":"stream","text":"2.77MB [00:00, 4.43MB/s]\n"}],"visibility":"show","key":"M0HOlbhVgY"}],"visibility":"show","key":"ZPz2YVFU8X"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HUbg0pG0RB"}],"label":"DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.ipynb-EarthKit","identifier":"dedl-hda-eo.ecmwf.dat.reanalysis_era5_single_levels.ipynb-earthkit","html_id":"dedl-hda-eo-ecmwf-dat-reanalysis-era5-single-levels-ipynb-earthkit","key":"KIifpwiqc3"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Lets plot the result file with ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"nY7JUFZoZp"},{"type":"link","url":"https://earthkit.readthedocs.io/en/latest/index.html","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VJv3vTHigi"}],"urlSource":"https://earthkit.readthedocs.io/en/latest/index.html","key":"BOI8YQ5a1S"}],"key":"QxFMQ1Kdfy"}],"key":"poaJ2X1ptl"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data\nimport earthkit.plots\nimport earthkit.regrid\n\ndata = earthkit.data.from_source(\"file\", filename)\nearthkit.plots.quickplot(data)","visibility":"show","key":"ioM7BrI9Th"},{"type":"output","id":"BQ9wW_kB0Jl84_NKXxsid","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"bc7326e05f44403bbc295839ac045e91\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"  0%|          | 0/1 [00:00<?, ?it/s]","content_type":"text/plain"}}},{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"<earthkit.plots.components.figures.Figure at 0x7f6b9bdaa610>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"afb861f9a8308d9f2dd060310721407b","path":"/build/afb861f9a8308d9f2dd060310721407b.png"},"text/plain":{"content":"<Figure size 800x700 with 4 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"intAVDhKEn"}],"visibility":"show","key":"AkmpcuBrkx"}],"key":"grwaVCTtJu"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}