{"version":2,"kind":"Notebook","sha256":"62ad958106b9506050c61e2a7e978bcde1cf2858281f8ed73cde2380a6e0d4cc","slug":"extremedt-dataavailability","location":"/production/HDA/DestinE_Digital_Twins/ExtremeDT-dataAvailability.ipynb","dependencies":[],"frontmatter":{"title":"Aviso notification for DT data availability","subtitle":"This notebook shows how to check the data availablility for the Weather-Induced Extremes Digital Twin (Extremes DT) using the ECMWF Aviso package.","tags":["HDA","ECMWF","pyaviso","Digital Twin"],"copyright":"Â© 2025 EUMETSAT","authors":[{"id":"Serena Avolio (EUMETSAT/Starion)","name":"Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"ExtremeDT-dataAvailability.ipynb","url":"/build/ExtremeDT-dataAvaila-593fae23ca29fa5863bccda51df51305.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"ðŸš€ Launch in JupyterHub","key":"INAWFxcuo0"}],"key":"BvrHjrIJUP"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","key":"b7nMeGtMEu"}],"key":"AAQyxQn4ER"}],"key":"ING9KAc0Qp"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"References:","key":"BiSBHTo0vK"}],"key":"N3ioWXzvqw"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://pyaviso.readthedocs.io/en/latest/","children":[{"type":"text","value":"Pyaviso","key":"nw0KJk7bom"}],"urlSource":"https://pyaviso.readthedocs.io/en/latest/","key":"ScEcHf0fOe"}],"key":"v9JkyNcl33"}],"key":"UjCzoRQzqx"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://github.com/destination-earth-digital-twins/aviso-examples/tree/main","children":[{"type":"text","value":"Aviso examples","key":"tUyjns0f74"}],"urlSource":"https://github.com/destination-earth-digital-twins/aviso-examples/tree/main","error":true,"key":"nDImUxCfTG"}],"key":"ktQXMNvBiH"}],"key":"hXA7a5HxKf"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine.ecmwf.int/weather-induced-extremes-digital-twin-1/","children":[{"type":"text","value":"Weather-Induced Extremes Digital Twin (Extremes DT)","key":"lHEHozQcc2"}],"urlSource":"https://destine.ecmwf.int/weather-induced-extremes-digital-twin-1/","key":"CqJ8mTpKip"}],"key":"BE6g347Wox"}],"key":"cs3kN9X6yb"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://confluence.ecmwf.int/display/DDCZ/Extremes+DT+data+catalogue","children":[{"type":"text","value":"Extreme DT data catalogue","key":"MZpoD16UZn"}],"urlSource":"https://confluence.ecmwf.int/display/DDCZ/Extremes+DT+data+catalogue","key":"yuJsLbbibJ"}],"key":"yqhgvX0Bu2"}],"key":"E1F2VBSarz"}],"key":"AzwpsVGalx"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"g0tzvE9ej2"}],"key":"HRz8rQ1Sgi"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The pyaviso package is provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"iiOvNmBazT"}],"key":"sP5O18EHG5"}],"key":"tCxdzL880L"}],"key":"skYCfJK8F1"}],"key":"KH1uL8P0nd"}],"key":"NulVRF7jrX"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook shows how to check the data availablility for the Weather-Induced Extremes Digital Twin (Extremes DT) using the ECMWF Aviso package.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wrZ9XYm5MD"}],"key":"cV3FETASed"}],"key":"whLopPmmGZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Install the pyaviso package","key":"BEkSd1H3RV"}],"identifier":"install-the-pyaviso-package","label":"Install the pyaviso package","html_id":"install-the-pyaviso-package","implicit":true,"key":"WAGG1wv9y2"}],"key":"yQPeQF0bgn"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"pip  install  pyaviso --upgrade --quiet","visibility":"show","key":"ZSXdXaNl0a"},{"type":"output","id":"s2o-SeUI9hOYlf_9y_iQ9","data":[{"name":"stdout","output_type":"stream","text":"Note: you may need to restart the kernel to use updated packages.\n"}],"visibility":"show","key":"ZVJy8FOYcC"}],"visibility":"show","key":"PSoRWLnxf6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Import pyaviso","key":"vcTQK0076c"}],"identifier":"import-pyaviso","label":"Import pyaviso","html_id":"import-pyaviso","implicit":true,"key":"souFI93Gp2"},{"type":"paragraph","children":[{"type":"text","value":"Import pyaviso and other useful libraries. Defining constants and functions.","key":"iQpTp2sTdj"}],"key":"mzAmPOmP45"}],"key":"PJtUzOaoQc"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime\nfrom pprint import pprint as pp\n\nfrom pyaviso import NotificationManager, user_config","visibility":"show","key":"FMlA1czWEl"},{"type":"output","id":"tIX2IHlfWkZi8taxl7Feb","data":[],"visibility":"show","key":"XnOSXj2apL"}],"visibility":"show","key":"WnR54H8la0"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"LISTENER_EVENT = \"data\"  # Event for the listener, options are mars and dissemination\nTRIGGER_TYPE = \"function\"  # Type of trigger for the listener","visibility":"show","key":"OzVWVA6Jo0"},{"type":"output","id":"gm5dk1NK-jJSF8NyTB6ZH","data":[],"visibility":"show","key":"Ho69HLFGov"}],"visibility":"show","key":"Oho6mJRLxH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Defining the data to be notified","key":"kEbOPZ1iSF"}],"identifier":"defining-the-data-to-be-notified","label":"Defining the data to be notified","html_id":"defining-the-data-to-be-notified","implicit":true,"key":"GR6jKZpfIt"},{"type":"paragraph","children":[{"type":"text","value":"The following request describes the data whose availability we want to be notified","key":"LR7wJr4eUl"}],"key":"z1p7vYOCll"}],"key":"Ezjmdyko9O"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"REQUEST = {\n    \"class\": \"d1\",\n    \"expver\": \"0001\",\n    \"stream\": \"wave\",\n    \"type\": \"fc\",\n    \"time\": \"00\",\n    \"step\": \"0\",\n    \"levtype\": \"sfc\",\n#    \"levelist\": \"\",\n#    \"param\": \"168\"   \n}  # Request configuration for the listener\n","visibility":"show","key":"KV6jy6WBIV"},{"type":"output","id":"AaF6m7Xs_4vo2aAybTwPg","data":[],"visibility":"show","key":"C9r7GK2G7q"}],"visibility":"show","key":"Ik7nXf7ff7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Aviso configuration","key":"KlruxTTkAd"}],"identifier":"aviso-configuration","label":"Aviso configuration","html_id":"aviso-configuration","implicit":true,"key":"iyqlR3zyh8"}],"key":"cHxV6gLOsn"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"CONFIG = {\n    \"notification_engine\": {\n        \"host\": \"aviso.lumi.apps.dte.destination-earth.eu\",\n        \"port\": 443,\n        \"https\": True,\n    },\n    \"configuration_engine\": {\n        \"host\": \"aviso.lumi.apps.dte.destination-earth.eu\",\n        \"port\": 443,\n        \"https\": True,\n    },\n    \"schema_parser\": \"generic\",\n    \"remote_schema\": True,\n    \"auth_type\": \"none\",\n    \"quiet\" : True\n}  # manually defined configuration\n","visibility":"show","key":"S6BjTwtDJn"},{"type":"output","id":"KAOu42dTcwjsIT7rI0ZeG","data":[],"visibility":"show","key":"XxEFclL6A6"}],"visibility":"show","key":"Wi3r3CZfnD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Searching for old notifications","key":"fKUgzoKYZm"}],"identifier":"searching-for-old-notifications","label":"Searching for old notifications","html_id":"searching-for-old-notifications","implicit":true,"key":"GkBXLsru4n"},{"type":"paragraph","children":[{"type":"text","value":"Ssearching for old notifications where available. This way users can explicitly replay past notifications and executes triggers.","key":"ATXpXgdcfM"}],"key":"i6OQFTnSxN"}],"key":"xw9WBclxky"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import sys\nSTART_DATE = datetime(2020, 12, 12)  # Start date for the notification listener","visibility":"show","key":"X5xNeUMd4T"},{"type":"output","id":"yLaPZ9n5uY7tHDJPKAJV9","data":[],"visibility":"show","key":"Eu8pKAYsS2"}],"visibility":"show","key":"ClM8CSYu1T"},{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def triggered_function(notification):\n    \"\"\"\n    Function for the listener to trigger.\n    \"\"\"\n    \n    #pp(notification)\n    # Access the date field\n    date_str = notification['request']['date']    \n\n    # Convert the date string to a datetime object\n    date_obj = datetime.strptime(date_str, '%Y%m%d')\n    formatted_date = date_obj.strftime('%Y-%m-%d')\n    pp(\"ExtremeDT data available=>\" + formatted_date)\n    \n    ","visibility":"show","key":"fiFf3jh6op"},{"type":"output","id":"93HKkHLMI_-fgVgcfTkUz","data":[],"visibility":"show","key":"cg4phcHblh"}],"visibility":"show","key":"l7Yph3zMTt"},{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def create_hist_listener():\n    \"\"\"\n    Creates and returns a listener configuration.\n    \"\"\"\n\n    trigger = {\n        \"type\": TRIGGER_TYPE,\n        \"function\": triggered_function,\n    }  # Define the trigger for the listener\n    \n    # Return the complete listener configuration\n    return {\"event\": LISTENER_EVENT, \"request\": REQUEST, \"triggers\": [trigger]}\n","visibility":"show","key":"JSM7mouMhA"},{"type":"output","id":"5KrQQkX7oczjfFc9rY8wh","data":[],"visibility":"show","key":"mxC55TWJQk"}],"visibility":"show","key":"gAjY5yxeLy"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"try:\n    listener = create_hist_listener()  # Create listener configuration\n    listeners_config = {\"listeners\": [listener]}  # Define listeners configuration\n    config = user_config.UserConfig(**CONFIG)\n    print(\"loaded config:\")\n    pp(CONFIG)\n    nmh = NotificationManager()  # Initialize the NotificationManager\n\n    nmh.listen(\n        listeners=listeners_config, from_date=START_DATE, config=config\n    )  # Start listening\nexcept Exception as e:\n    print(f\"Failed to initialize the Notification Manager: {e}\")","visibility":"show","key":"ryNi1VPAHH"},{"type":"output","id":"ZeSzFZ6qoebVPAkQ73ZJk","data":[{"name":"stdout","output_type":"stream","text":"loaded config:\n{'auth_type': 'none',\n 'configuration_engine': {'host': 'aviso.lumi.apps.dte.destination-earth.eu',\n                          'https': True,\n                          'port': 443},\n 'notification_engine': {'host': 'aviso.lumi.apps.dte.destination-earth.eu',\n                         'https': True,\n                         'port': 443},\n 'quiet': True,\n 'remote_schema': True,\n 'schema_parser': 'generic'}\n"}],"visibility":"show","key":"GanqrZZ8SA"}],"visibility":"show","key":"DcqGT34BCH"}],"key":"eskGPf3Huf"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}