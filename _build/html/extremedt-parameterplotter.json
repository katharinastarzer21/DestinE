{"version":2,"kind":"Notebook","sha256":"7fb9a0a2d0e32bc1dac389b045549e6cab832becfd8064d1ce54e51218596e6a","slug":"extremedt-parameterplotter","location":"/production/HDA/DestinE_Digital_Twins/ExtremeDT-ParameterPlotter.ipynb","dependencies":[],"frontmatter":{"title":"Weather-Induced Extremes DT Parameter Plotter Tutorial","subtitle":"This notebook shows how to select, request, and download Climate Digital Twin Extremes data from the DestinE Data Lake (DEDL HDA), including user-defined parameter, scenario, date, and level selection, followed by secure authentication, API querying, and visualization using EarthKit.","tags":["HDA","ECMWF","earthkit","Digital Twin"],"copyright":"¬© 2025 EUMETSAT","authors":[{"id":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)","name":"Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/myst_assets_folder../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"ExtremeDT-ParameterPlotter.ipynb","url":"/build/ExtremeDT-ParameterP-9622c2ba064c342ac9eb59325eb55281.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ExtremeDT-ParameterPlotter.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"üöÄ Launch in JupyterHub","key":"riTuYgOTbn"}],"key":"RpXaEPClOZ"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/ExtremeDT-ParameterPlotter.ipynb","key":"jEAUl1iqGj"}],"key":"krb2DD79hO"}],"key":"MqIvr8Bcsr"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"Prerequisites:","key":"nXE4KjZzAo"}],"key":"jx3rBDqYPD"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DEDL data a ","key":"GTJely6vEl"},{"type":"link","url":"https://platform.destine.eu/","children":[{"type":"text","value":"DestinE user account","key":"sbMeiTUhxB"}],"urlSource":"https://platform.destine.eu/","key":"MsXAQKAiNt"},{"type":"text","value":" is needed","key":"tHfGEFuvxg"}],"key":"PVhB4N2fLU"}],"key":"uzbLcPa25K"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DT data an ","key":"OJ45xFbcei"},{"type":"link","url":"https://platform.destine.eu/support-pages/access-policy/","children":[{"type":"text","value":"upgraded access","key":"vpGOk3j63D"}],"urlSource":"https://platform.destine.eu/support-pages/access-policy/","key":"dkE9zBb8BO"},{"type":"text","value":" is needed.","key":"IJb0l4SHfi"}],"key":"Lkx02uc0AK"}],"key":"HtP5kGMczq"}],"key":"BP42rSaWSf"},{"type":"strong","children":[{"type":"text","value":"References:","key":"jwvOYqgv9M"}],"key":"TfaW1DRp2A"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","children":[{"type":"text","value":"DestinE Data Lake (DEDL) Harmonized Data Access (HDA) documentation","key":"wd9BKAtmhq"}],"urlSource":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","key":"jHUE1sbdr8"}],"key":"hrHrkXdNuG"}],"key":"RBidDKcJHf"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine.ecmwf.int/weather-induced-extremes-digital-twin-1/","children":[{"type":"text","value":"Weather-Induced Extremes Digital Twin (Extremes DT)","key":"kh4d9IxZlQ"}],"urlSource":"https://destine.ecmwf.int/weather-induced-extremes-digital-twin-1/","key":"rnGgyBpsAr"}],"key":"NIqX9B1zzv"}],"key":"EGni2i2kbC"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://confluence.ecmwf.int/display/DDCZ/Extremes+DT+data+catalogue","children":[{"type":"text","value":"Extreme DT data catalogue","key":"F75pEJtz42"}],"urlSource":"https://confluence.ecmwf.int/display/DDCZ/Extremes+DT+data+catalogue","key":"kcKD7zCNlu"}],"key":"kfPNV5B3rE"}],"key":"fa4d7bkzrI"}],"key":"oSmDzfpzd1"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"Pri2qrgVB2"}],"key":"sVyTczpZ5e"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Earthkit and HDA Polytope used in this context are both packages provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"zO5l5Xs9JT"}],"key":"wLUgYphXx4"}],"key":"SpNNXYqCDo"}],"key":"jYcExGeqOC"}],"key":"TGDVdzDYAF"}],"key":"QneKbdLDXy"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nac5qzHrQD"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA (Harmonized Data Access)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vg5joRBEty"}],"key":"sLyoJ3gAnw"},{"type":"text","value":" API to query and access Extremes DT data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"erhrHRB2Uh"}],"key":"tCq46ymgDs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"A correct combination of parameters is necessary to access DT data.\nThe aim of this notebook is to help you create the correct request to access the desired Extremes DT data, through HDA, and visualize it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e48UhdkJZx"}],"key":"WFvpLhmNyd"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Below the main steps covered by this tutorial.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"L5rWSB8nYu"}],"key":"Mu4n0QTINH"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Asb0jVKia7"}],"identifier":"extremedt-parameterplotter.ipynb-setup","label":"ExtremeDT-ParameterPlotter.ipynb-Setup","kind":"heading","template":"{name}","resolved":true,"html_id":"extremedt-parameterplotter-ipynb-setup","key":"SOlHxQRFyE"},{"type":"text","value":": Import the required libraries and define some function.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fvuL5KvL76"}],"key":"WepQqLDteH"}],"key":"jxWqN1oNQ9"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Parameter Selection","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"dF13Zygctf"}],"identifier":"extremedt-parameterplotter.ipynb-parameter-selection","label":"ExtremeDT-ParameterPlotter.ipynb-Parameter-Selection","kind":"heading","template":"{name}","resolved":true,"html_id":"extremedt-parameterplotter-ipynb-parameter-selection","key":"TI7oZtrNOt"},{"type":"text","value":": How to select the desired Extreme DT variable and check its characteristics.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ch5twuFNFO"}],"key":"stWGjYf8lg"}],"key":"AnZpM3CROP"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Datetime Selection","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"HR0sHC6awV"}],"identifier":"extremedt-parameterplotter.ipynb-date-selection","label":"ExtremeDT-ParameterPlotter.ipynb-Date-Selection","kind":"heading","template":"{name}","resolved":true,"html_id":"extremedt-parameterplotter-ipynb-date-selection","key":"MoCiLKV0pw"},{"type":"text","value":":  How to select the desired date and time.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lDC0oMUfXD"}],"key":"ZqxnqqFzs1"}],"key":"n7g3CTYXMc"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Levels Selection","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"bl2h8FdNgN"}],"identifier":"extremedt-parameterplotter.ipynb-levels-selection","label":"ExtremeDT-ParameterPlotter.ipynb-Levels-Selection","kind":"heading","template":"{name}","resolved":true,"html_id":"extremedt-parameterplotter-ipynb-levels-selection","key":"EskZFZrNQd"},{"type":"text","value":": How to Handle different Levels to be selected (if any).","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"oLHljuaMA7"}],"key":"mOGLsUYtK1"}],"key":"GzkGOiUj81"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"r2PBJRu64r"}],"identifier":"extremedt-parameterplotter.ipynb-order-and-download","label":"ExtremeDT-ParameterPlotter.ipynb-Order-and-Download","kind":"heading","template":"{name}","resolved":true,"html_id":"extremedt-parameterplotter-ipynb-order-and-download","key":"AiARfC0rRb"},{"type":"text","value":": How to order and download Climate DT data.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"BdozBjvHMC"}],"key":"pECKOalfLi"}],"key":"T6f2CZnkhx"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Plot","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"QN8j60Wgwr"}],"identifier":"extremedt-parameterplotter.ipynb-earthkit","label":"ExtremeDT-ParameterPlotter.ipynb-EarthKit","kind":"heading","template":"{name}","resolved":true,"html_id":"extremedt-parameterplotter-ipynb-earthkit","key":"aYizDR7xKX"},{"type":"text","value":": How to visualize hourly data on single levels data through Earthkit.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"JHS22WDLTv"}],"key":"DOf0XS2BjV"}],"key":"C80xuX02hD"}],"key":"K6SobTlvbZ"}],"visibility":"show","key":"EMCPXYixmc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eP6yTkDtoh"}],"label":"ExtremeDT-ParameterPlotter.ipynb-Setup","identifier":"extremedt-parameterplotter.ipynb-setup","html_id":"extremedt-parameterplotter-ipynb-setup","key":"hNlzXAKh0P"}],"key":"BgF7ypGr2l"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import the Climate DT parameters & scenarios dictionary and all the required packages.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aOBiaOwn8y"}],"key":"i5TgGRGS7E"}],"visibility":"show","key":"WRYKtDfQez"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import destinelab as deauth\nfrom destinelab import extreme_dt_dictionary\nimport ipywidgets as widgets\nimport json\nimport datetime\nimport importlib.metadata\n\nimport requests\nfrom requests.adapters import HTTPAdapter\nfrom urllib3.util.retry import Retry\nimport os\nfrom getpass import getpass\nfrom tqdm import tqdm\nimport time\nfrom urllib.parse import unquote\nfrom time import sleep\nfrom IPython.display import JSON\nfrom datetime import datetime, timedelta","visibility":"show","key":"PKIYPIOMAE"},{"type":"output","id":"TXPArQBz7z47ycNbC_Lmh","data":[],"visibility":"show","key":"Y3cF3rJhk5"}],"visibility":"show","key":"JvFmaWhhX6"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define some useful funtions to simplify the parameters selection.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A0kRJJdsJw"}],"key":"HWcDUpaVhM"}],"visibility":"show","key":"NjpuvcY78Y"},{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def filter_entries(search_string):\n    return [(entry['paramName'], i) for i, entry in enumerate(extreme_dt_dictionary.extremeDT_params) if search_string.lower() in entry['paramName'].lower()]\n\ndef on_search_change(change):\n    search_string = change.new\n    if search_string:\n        filtered_options = filter_entries(search_string)\n        entry_dropdown.options = filtered_options\n    else:\n        entry_dropdown.options = [(entry['paramName'], i) for i, entry in enumerate(extreme_dt_dictionary.extremeDT_params)]\n        \ndef get_selected_entry():\n    return entry_dropdown.value\n\ndef on_scenario_change(change):\n    print(\"scenario_change\")\n    selected_index = change.new\n    selected_entry = extreme_dt_dictionary.extremeDT_scenario[selected_index]\n    start_date_picker.min = date_from\n    start_date_picker.max = date_to\n    # Set the initial date of the start_date_picker to the scenario's start date\n    start_date_picker.value = date_to\n    selected_start_date = start_date_picker.value\n    \ndef get_selected_values():\n    selected_scenario_index = scenario_dropdown.value\n    selected_scenario = extreme_dt_dictionary.extremeDT_scenario[selected_scenario_index]\n    selected_start_date = start_date_picker.value\n    return selected_scenario_index, selected_scenario, selected_start_date\n\ndef parse_input_string(input_string):\n    ranges = input_string.split('/')\n    step_start = \"\"\n    step_end = \"\"\n    step_width = 1\n    hypen = \"\"\n    options = []\n    for rng in ranges:\n        if rng:\n            if '-' in rng:\n                hypen = \"-\"\n                start, end = rng.split('-')\n                step_width = int(end) - int(start)\n                if step_start == \"\":\n                    step_start = int(start.strip())\n                step_end = int(end.strip())\n            elif 'to' not in rng:\n                if step_start == \"\":\n                    step_start = int(rng.strip())\n                step_end = int(rng.strip())\n                #options.append(option)\n    #print(str(step_start) + \":\" + str(step_end))\n    if hypen != \"\":\n        options.extend([f\"{i}-{i+step_width}\" for i in range(step_start, step_end, step_width)])\n    else:\n        options.extend([f\"{i}\" for i in range(step_start, step_end+1, step_width)])\n    return options\n\ndef get_selected_step_values():\n    selected_values = multi_select.value\n    selected_values_string = \"/\".join(selected_values)\n    return selected_values_string\n\n# Function to convert tuple or single integer to string separated by \"/\"\ndef convert_to_string(input):\n    if isinstance(input, tuple):\n        return '/'.join(map(str, input))\n    elif isinstance(input, int):\n        return str(input)\n    else:\n        return None  # Handle other types if needed\n","visibility":"show","key":"Tdf6eujVhC"},{"type":"output","id":"gJd2mX2VdtD3DbllxZ_EJ","data":[],"visibility":"show","key":"Cbe0BtAeho"}],"visibility":"show","key":"XzBbbwfjIN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Parameter Selection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MVAJhYT18c"}],"label":"ExtremeDT-ParameterPlotter.ipynb-Parameter-Selection","identifier":"extremedt-parameterplotter.ipynb-parameter-selection","html_id":"extremedt-parameterplotter-ipynb-parameter-selection","key":"umNnAUulDy"}],"key":"db64Bol9OV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Extreme DT variable selection (we limit the plotting to one variable)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OqQwOOPr1C"}],"key":"xc0pji7P2j"}],"key":"nC53aJfbcT"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create search box\nsearch_box = widgets.Text(placeholder='Search by parameter name', description='Search:', disabled=False)\n\n# Create dropdown to select entry\nentry_dropdown = widgets.Dropdown(\n    options=[(entry['paramName'], i) for i, entry in enumerate(extreme_dt_dictionary.extremeDT_params)],\n    description='Select Entry:'\n)\n\nsearch_box.observe(on_search_change, names='value')\n\n# Display widgets\ndisplay(search_box, entry_dropdown)\n\n","visibility":"show","key":"dIIaJVQOTy"},{"type":"output","id":"mijJd5a-BdZQJQxCIiV9C","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"f3a12374404040ddab13357b8a0ade30\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Text(value='', description='Search:', placeholder='Search by parameter name')","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"157c08d31edd4baabc7efdce9b16901e\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Dropdown(description='Select Entry:', options=(('Sea ice area fraction', 0), ('Sea surface temperature', 1), (‚Ä¶","content_type":"text/plain"}}}],"visibility":"show","key":"m70eM0prgj"}],"visibility":"show","key":"Dwitimkvfr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let‚Äôs see the  details of the selected parameter (Polytope convention).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R8l83Jy2KH"}],"key":"MLqEpUap0f"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"From the details it is possible to see the parameter characteristic as the time resolution and the models with which the parameter can be obtained.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AorFRDUgtX"}],"key":"GiwSxOpche"}],"key":"FTl6LvY7yh"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"\nselected_index = get_selected_entry()\nselected_entry = extreme_dt_dictionary.extremeDT_params[selected_index]\nprint(json.dumps(selected_entry,indent=4))","visibility":"show","key":"iHuYBUpW36"},{"type":"output","id":"GTgcS0JSDDAB-E8mw1DHW","data":[{"name":"stdout","output_type":"stream","text":"{\n    \"param\": \"228029\",\n    \"paramName\": \"Instantaneous 10 metre wind gust\",\n    \"shortName\": \"i10fg\",\n    \"unit\": \"m s**-1\",\n    \"encoding\": \"instantaneous\",\n    \"stream\": \"oper\",\n    \"type\": \"fc\",\n    \"levtype\": \"sfc\",\n    \"step\": \"0/1/to/96\",\n    \"levelist\": \"\"\n}\n"}],"visibility":"show","key":"ocRXCVIK0W"}],"visibility":"show","key":"jMyCC6W27I"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Datetime Selection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sbhkHKpIQb"}],"label":"ExtremeDT-ParameterPlotter.ipynb-Date-Selection","identifier":"extremedt-parameterplotter.ipynb-date-selection","html_id":"extremedt-parameterplotter-ipynb-date-selection","key":"bkWMCW9Qc3"}],"key":"SmvBiUkqAr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Extreme DT data is available for specific time ranges (last 14 days) around the current date.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uR5dVDqLl9"}],"key":"ypxAGv4UgY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"It is possible to use the ECMWF Aviso package to check data availability in the last 14 days (see ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"usVvNnaXsq"},{"type":"link","url":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/DestinE Digital Twins/ExtremeDT-dataAvailability.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EbrQbJIECK"}],"urlSource":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","data":{"kind":"file","org":"destination-earth","repo":"DestinE-DataLake-Lab","reference":"main","file":"HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb","raw":"https://raw.githubusercontent.com/destination-earth/DestinE-DataLake-Lab/main/HDA/DestinE%20Digital%20Twins/ExtremeDT-dataAvailability.ipynb"},"internal":false,"protocol":"github","key":"lsNQrIME0q"},{"type":"text","value":" or ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"si516CbLtJ"},{"type":"link","url":"https://github.com/destination-earth-digital-twins/aviso-examples/blob/main/aviso-extremes-dt.py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"aviso‚Äã-extremes‚Äã-dt‚Äã.py","key":"QHhoKJpjTx"}],"urlSource":"https://github.com/destination-earth-digital-twins/aviso-examples/blob/main/aviso-extremes-dt.py","data":{"kind":"file","org":"destination-earth-digital-twins","repo":"aviso-examples","reference":"main","file":"aviso-extremes-dt.py","raw":"https://raw.githubusercontent.com/destination-earth-digital-twins/aviso-examples/main/aviso-extremes-dt.py"},"internal":false,"protocol":"github","key":"zk15C3VBBB"},{"type":"text","value":") and request data accordingly.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ksJBAHNovS"}],"key":"xQlQgpywQ9"}],"key":"Y4HLk2DHsD"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime, timedelta\n\n# Get the current date and time in UTC\ncurrent_date = datetime.utcnow()\n\n# Calculate the date 15 days before the current date\ndate_14_days_ago = current_date - timedelta(days=14)\n\n# Format the date as YYYYMMDD and set the time to 0000 UTC\nformatted_date = date_14_days_ago.strftime('%Y%m%d') + '0000'\n# Convert the formatted date back to a datetime object\ndate_from = datetime.strptime(formatted_date, '%Y%m%d%H%M%S').date()\n\n# Format the date as YYYYMMDD and set the time to 0000 UTC\nformatted_date = current_date.strftime('%Y%m%d') + '0000'\n# Convert the formatted date back to a datetime object\ndate_to = datetime.strptime(formatted_date, '%Y%m%d%H%M%S').date()","visibility":"show","key":"H1cSffV9bM"},{"type":"output","id":"Pz3Xy1uxgKeyAKk_J2jQl","data":[],"visibility":"show","key":"eIUIgKF9j9"}],"visibility":"show","key":"lChdbpdk7D"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from ipywidgets import Label\n# Create dropdown to select scenario\nscenario_dropdown = widgets.Dropdown(\n    options=[(f\"{entry['model']}\", (i)) for i, entry in enumerate(extreme_dt_dictionary.extremeDT_scenario)],\n    description='Scenario:'\n)\n\n# Create date picker widgets\nstart_date_picker = widgets.DatePicker(description='Start Date:', disabled=False) \nscenario_dropdown.observe(on_scenario_change, names='value')\n\n# Set initial values directly\nselected_entry = extreme_dt_dictionary.extremeDT_scenario[0]\n\n# Set initial values directly\nstart_date_picker.min = date_from\nstart_date_picker.max = date_to\nstart_date_picker.value = date_to\n\n# Display widgets\ndisplay(Label(\"To choose your date, please consider the current Extremes DT data availability (ExtremeDT-dataAvailability.ipynb in this folder).\"),scenario_dropdown,  start_date_picker)\n\n# Example usage:\nselected_scenario_index, selected_scenario, selected_start_date = get_selected_values()\n","visibility":"show","key":"AoMlJZyauh"},{"type":"output","id":"3c4YdtAJ6mZzIoyfMDPwJ","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"48d68767a823461c9d5b5646166a11a1\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Label(value='To choose your date, please consider the current Extremes DT data availability (ExtremeDT-dataAva‚Ä¶","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"79fbac9ebfad43a68807aa7599d17934\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Dropdown(description='Scenario:', options=(('IFS-NEMO', 0),), value=0)","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"5acf483c77c64067ac9edc48a4414fbf\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"DatePicker(value=datetime.date(2025, 10, 21), description='Start Date:', max=datetime.date(2025, 10, 21), min=‚Ä¶","content_type":"text/plain"}}}],"visibility":"show","key":"kM9HMntuhb"}],"visibility":"show","key":"af8lKqoRpO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Steps (hours) selection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hPgU3rqxJH"}],"identifier":"steps-hours-selection","label":"Steps (hours) selection","html_id":"steps-hours-selection","implicit":true,"key":"C8bn1gwov3"}],"key":"AmhnrypSWv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step selection within the observation to be retrieved (one step usually one hour)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ej7Mr1tNib"}],"key":"xIZtrn5rHN"}],"key":"ww7fV7uKpn"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"selected_entry = extreme_dt_dictionary.extremeDT_params[selected_index]\ninput_string = selected_entry[\"step\"]\n\noptions = parse_input_string(input_string)\n\nmulti_select = widgets.SelectMultiple(\n    options=options,\n    description='Select (Steps):',\n    disabled=False\n)\n\ndisplay(multi_select)","visibility":"show","key":"tBISEhps42"},{"type":"output","id":"1-v5uMpaT77K2RBKYnnZN","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"33e63446483749e2aa076ce7f14111f0\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"SelectMultiple(description='Select (Steps):', options=('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10',‚Ä¶","content_type":"text/plain"}}}],"visibility":"show","key":"t5FvHWwhvb"}],"visibility":"show","key":"SRPaV2xA8w"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Levels Selection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"G3uGlNMOcp"}],"label":"ExtremeDT-ParameterPlotter.ipynb-Levels-Selection","identifier":"extremedt-parameterplotter.ipynb-levels-selection","html_id":"extremedt-parameterplotter-ipynb-levels-selection","key":"MS2vfkfmUz"}],"key":"kr4Mo6zB06"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Handle different Levels to be selected (if any)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w6NMX63APc"}],"key":"fBON4JspZb"}],"key":"dY2ebSgsz0"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define a global variable\nglobal global_widget\nglobal_widget = None\n\nif selected_entry[\"levelist\"] != \"\":\n    # Convert levelist string to list of integers\n    levelist = list(map(int, selected_entry[\"levelist\"].split('/')))\n      \n    # Create a function to generate the widget based on the selection mode\n    def generate_widget(selection_mode):\n        global global_widget\n        if selection_mode == 'Single':\n            global_widget = widgets.Dropdown(options=levelist, description='Select level:')\n            return global_widget\n        elif selection_mode == 'Multiple':\n            global_widget = widgets.SelectMultiple(options=levelist, description='Select levels:')\n            return global_widget\n\n    # Create a dropdown widget to choose selection mode\n    selection_mode_dropdown = widgets.Dropdown(options=['Single', 'Multiple'], description='Selection Mode:')\n\n    # Create an output widget to display the selected option(s)\n    output = widgets.Output()\n\n    # Function to display the widget based on the selection mode\n    def display_widget(selection_mode):\n        output.clear_output()\n        with output:\n            display(generate_widget(selection_mode))\n\n    # Define a function to handle the change in selection mode\n    def on_dropdown_change(change):\n        display_widget(change.new)\n\n    # Register the function to handle dropdown changes\n    selection_mode_dropdown.observe(on_dropdown_change, names='value')\n\n    # Display the widgets\n    display(selection_mode_dropdown, output)\n\n    # Display the initial widget based on default selection mode\n    display_widget('Single')","visibility":"show","key":"KieLjRQkCe"},{"type":"output","id":"RopeJMQnP54veMTyY2RV5","data":[],"visibility":"show","key":"XNowBHGC0R"}],"visibility":"show","key":"enw3JZzCAp"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert selected parameters and levels into HDA request","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NHd5dsmF7Z"}],"identifier":"convert-selected-parameters-and-levels-into-hda-request","label":"Convert selected parameters and levels into HDA request","html_id":"convert-selected-parameters-and-levels-into-hda-request","implicit":true,"key":"Pl6vSMtoJm"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Convert levels (if any)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wmUIXvsCUI"}],"key":"SFYRE15GAc"}],"key":"dE5B5dH55Z"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"levlInput = \"\"\nif global_widget != None:\n    # Test cases\n    levlInput = convert_to_string(global_widget.value)","visibility":"show","key":"yiIXVH2WZz"},{"type":"output","id":"_aM1GepXVd7DbtN7srQ6R","data":[],"visibility":"show","key":"f8vlfFp31t"}],"visibility":"show","key":"XXGzClmjXC"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Call get_selected_values after the display is finished\nselected_step_values = get_selected_step_values()\n\n# Print the result in JSON format\n#datechoice = get_selected_values()[2].strftime('%Y%m%d')\ndatechoice = \"{fname}T00:00:00Z\".format(fname = get_selected_values()[2])\n\nfilter_params = {\n  \"class\": \"d1\",                       # fixed \n  \"dataset\": \"extremes-dt\",             # fixed extreme-dt access\n  \"expver\": \"0001\",                    # fixed experiment version \n  \"stream\": selected_entry[\"stream\"],\n  \"type\": \"fc\",                        # fixed forecasted fields\n#  \"date\": datechoice,                  # choose the date\n  \"time\": \"0000\",                      # fixed \n  \"step\": selected_step_values,        # step choice \n  \"levtype\": selected_entry[\"levtype\"],  \n  \"levelist\": str(levlInput),  \n  \"param\": str(selected_entry[\"param\"]),  \n}\n\n# Print the result in JSON format\nprint(datechoice)\nprint(json.dumps(filter_params, indent=4))\nhdaFilters = {\n    key: {\"eq\": value}\n    for key, value in filter_params.items()\n}\n\n#print(json.dumps(hdaFilters, indent=4))","visibility":"show","key":"aP565i4WVh"},{"type":"output","id":"gg5Ns1zOXdXITbFXDSrjw","data":[{"name":"stdout","output_type":"stream","text":"2025-10-21T00:00:00Z\n{\n    \"class\": \"d1\",\n    \"dataset\": \"extremes-dt\",\n    \"expver\": \"0001\",\n    \"stream\": \"oper\",\n    \"type\": \"fc\",\n    \"time\": \"0000\",\n    \"step\": \"9/81\",\n    \"levtype\": \"sfc\",\n    \"levelist\": \"\",\n    \"param\": \"228029\"\n}\n"}],"visibility":"show","key":"ptLpwShv0g"}],"visibility":"show","key":"SrjuwRQfRR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BCgLwczn3f"}],"label":"ExtremeDT-ParameterPlotter.ipynb-Order-and-Download","identifier":"extremedt-parameterplotter.ipynb-order-and-download","html_id":"extremedt-parameterplotter-ipynb-order-and-download","key":"dGuIcmgrnv"}],"key":"tZbb73RQPa"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Obtain Authentication Token","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UG9dYAA3df"}],"identifier":"obtain-authentication-token","label":"Obtain Authentication Token","html_id":"obtain-authentication-token","implicit":true,"key":"uQRYKZ9hkE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To perform our request we need to be authenticated.\nBelow to request of an authentication token.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RQ9ozG51xM"}],"key":"oN9jJlkeJh"}],"visibility":"show","key":"zWBRavwqJy"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"zwP1R41dgz"},{"type":"output","id":"T-KfU3oaI9O1zO-p_vHaK","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username:  eum-dedl-user\nPlease input your DESP password:  ¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"sL7kTpte5K"}],"visibility":"show","key":"rfDLl3cjhG"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check if DT access is granted","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zcJ0Ho2O7S"}],"identifier":"check-if-dt-access-is-granted","label":"Check if DT access is granted","html_id":"check-if-dt-access-is-granted","implicit":true,"key":"qSWM7S7pZl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If DT access is not granted, you will not be able to execute the rest of the notebook.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xQ0dRv2VxH"}],"key":"xQWJcUSUHk"}],"visibility":"show","key":"KWOxkxwDCK"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import importlib\ninstalled_version = importlib.metadata.version(\"destinelab\")\nversion_number = installed_version.split('.')[1]\nif((int(version_number) >= 8 and float(installed_version) < 1) or float(installed_version) >= 1):\n    auth.is_DTaccess_allowed(access_token)","visibility":"show","key":"B7VhqJh1VU"},{"type":"output","id":"vfGSUch1lQtI-kQIv9FaN","data":[{"name":"stdout","output_type":"stream","text":"DT Output access allowed\n"}],"visibility":"show","key":"S3aKVVF5r6"}],"visibility":"show","key":"CoHoWA8CeQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA Endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MFtd2f73S1"}],"identifier":"hda-endpoint","label":"HDA Endpoint","html_id":"hda-endpoint","implicit":true,"key":"TXmzSu14Rp"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HDA API is based on the Spatio Temporal Asset Catalog specification (STAC), it is convenient define a costant with its endpoint.\nAnd another one with the ID of the Cliamte DT collection.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YQhmYtkBxe"}],"key":"HslD2RC1KY"}],"key":"axaftMW65y"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"\nCOLLECTION_ID=\"EO.ECMWF.DAT.DT_EXTREMES\"","visibility":"show","key":"SWQmT9qPUO"},{"type":"output","id":"FVYCW9xAEgePtXsd3sSYB","data":[],"visibility":"show","key":"jvJE5qHZYW"}],"visibility":"show","key":"ah7XqHK7R2"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtering","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zZFGX7j8Bz"}],"identifier":"filtering","label":"Filtering","html_id":"filtering","implicit":true,"key":"C45Kdpz4dM"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Search into asynchronous datasets, as the DTs are, always return a single item:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zV8wjQIFBr"}],"key":"vdzLXtSv3F"}],"visibility":"show","key":"rup6EZHAII"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#Sometimes requests to polytope get timeouts, it is then convenient define a retry strategy\nretry_strategy = Retry(\n    total=5,  # Total number of retries\n    status_forcelist=[500, 502, 503, 504],  # List of 5xx status codes to retry on\n    allowed_methods=[\"GET\",'POST'],  # Methods to retry\n    backoff_factor=1  # Wait time between retries (exponential backoff)\n)\n\n# Create an adapter with the retry strategy\nadapter = HTTPAdapter(max_retries=retry_strategy)\n\n# Create a session and mount the adapter\nsession = requests.Session()\nsession.mount(\"https://\", adapter)\n\nresponse = session.post(HDA_STAC_ENDPOINT+\"/search\", headers=auth_headers, json={\n \"collections\": [COLLECTION_ID],\n    \"datetime\": datechoice,\n    \"query\": hdaFilters\n})\n\nif(response.status_code!= 200):\n    (print(response.text))\nresponse.raise_for_status()\n\nproduct = response.json()[\"features\"][0]\nJSON(product)","visibility":"show","key":"LtvSG3qjz8"},{"type":"output","id":"nn4Leai_GqDFeBBFy35_n","data":[{"output_type":"execute_result","execution_count":104,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"assets\":{},\"bbox\":[-180,-90,180,90],\"collection\":\"EO.ECMWF.DAT.DT_EXTREMES\",\"geometry\":{\"coordinates\":[[[180,-90],[180,90],[-180,90],[-180,-90],[180,-90]]],\"type\":\"Polygon\"},\"id\":\"DT_EXTREMES_ORDERABLE_5c948863e59368d940122522204f68e4fa3dcb16\",\"links\":[{\"body\":{\"class\":\"d1\",\"dataset\":\"extremes-dt\",\"date\":\"20251021/to/20251021\",\"expver\":\"0001\",\"levelist\":\"\",\"levtype\":\"sfc\",\"param\":\"228029\",\"step\":\"9/81\",\"stream\":\"oper\",\"time\":\"0000\",\"type\":\"fc\"},\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.DT_EXTREMES/order\",\"method\":\"POST\",\"rel\":\"retrieve\",\"title\":\"Retrieve\",\"type\":\"application/geo+json\"},{\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.DT_EXTREMES\",\"rel\":\"collection\",\"title\":\"EO.ECMWF.DAT.DT_EXTREMES\",\"type\":\"application/json\"},{\"href\":\"https://hda.data.destination-earth.eu/stac/v2/collections/EO.ECMWF.DAT.DT_EXTREMES/items/DT_EXTREMES_ORDERABLE_5c948863e59368d940122522204f68e4fa3dcb16\",\"rel\":\"self\",\"title\":\"Original item link\",\"type\":\"application/geo+json\"}],\"properties\":{\"alias\":\"EO.ECMWF.DAT.DT_EXTREMES\",\"collection\":\"extremes-dt\",\"datetime\":\"2025-10-21T00:00:00.000000Z\",\"ecmwf:class\":\"d1\",\"ecmwf:dataset\":\"extremes-dt\",\"ecmwf:date\":\"20251021/to/20251021\",\"ecmwf:expver\":\"0001\",\"ecmwf:levelist\":\"\",\"ecmwf:levtype\":\"sfc\",\"ecmwf:param\":\"228029\",\"ecmwf:step\":\"9/81\",\"ecmwf:stream\":\"oper\",\"ecmwf:time\":\"0000\",\"ecmwf:type\":\"fc\",\"end_datetime\":\"2025-10-21T00:00:00.000000Z\",\"federation:backends\":[\"dedt_lumi\"],\"license\":\"CC-BY-4.0\",\"order:status\":\"orderable\",\"scope\":{\"discover\":null,\"download\":\"DPAD_Direct_Access\",\"search\":\"DPAD_Direct_Access\"},\"stacCollection\":\"/eodag/collections/EO.ECMWF.DAT.DT_EXTREMES.json\",\"start_datetime\":\"2025-10-21T00:00:00.000000Z\",\"storage:tier\":\"offline\",\"title\":\"DT_EXTREMES_ORDERABLE_5c948863e59368d940122522204f68e4fa3dcb16\"},\"stac_extensions\":[\"https://stac-extensions.github.io/storage/v1.0.0/schema.json\",\"https://stac-extensions.github.io/order/v1.1.0/schema.json\"],\"stac_version\":\"1.0.0\",\"type\":\"Feature\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"abQZ2g5pHt"}],"visibility":"show","key":"BtCx2Vwbiw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The single item returned (above) contains:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"goteq53FRK"}],"key":"VSpRyKLfwV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The product id: ‚ÄúDT_EXTREMES_ORDERABLE_...‚Äù, that is a placeholder, its name contains the term ‚ÄúORDERABLE‚Äù.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RzG1n7Qy6g"}],"key":"VcLlRDjWIc"}],"key":"P7hNfMG3T9"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The storage:tier that indicates that the product is ‚Äúoffline‚Äù","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Q0Lz2ig3Mw"}],"key":"yFLEwt72oG"}],"key":"VO3ei6c9a9"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The order:status that indicates that the product is ‚Äúorderable‚Äù","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IVlviJ66sf"}],"key":"V5y7ASlQsO"}],"key":"GZ3YOaLqL9"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request params used for the order extracted from the search result","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rG8m3Rx9U7"}],"key":"ghiaBiurqQ"}],"key":"wMe5ZLTe32"}],"key":"JPVqiM3lyM"}],"key":"CZkr3wn6zd"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ecmwf_properties = {\n    key: value for key, value in product.get('properties', {}).items()\n    if key.startswith('ecmwf:')\n}","visibility":"show","key":"bAJKOAvCtR"},{"type":"output","id":"_yl84RyKypBcPPtaqvyXm","data":[],"visibility":"show","key":"x9htz5hsPa"}],"visibility":"show","key":"PSDnC7BiAz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Order data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OktKfnXggj"}],"identifier":"order-data","label":"Order data","html_id":"order-data","implicit":true,"key":"j9fOeVYKym"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We have now all the information to order the data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xXRRxtoF4K"}],"key":"X5ac2HTOJ3"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"From the search results we know that the product is orderable and offline, we then need to order the product we searched for.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DDjhhTE5Y0"}],"key":"ItcpeyF87F"}],"key":"NkeDUzr9By"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json=ecmwf_properties, headers=auth_headers)\n\nif response.status_code != 200:\n    print(response.content)\nresponse.raise_for_status()\n\nordered_item = response.json()\n\nproduct_id = ordered_item[\"id\"]\nstorage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\norder_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\nfederation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\nprint(f\"Product ordered: {product_id}\")\nprint(f\"Provider: {federation_backend}\")\nprint(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\nprint(f\"Order status: {order_status}\")    ","visibility":"show","key":"hIiddoeecd"},{"type":"output","id":"Oaw1bMjJQ7yYb0UxMyaUG","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: 5db5d129-bf27-49bf-a6f7-bb3437c8ef52\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\n"}],"visibility":"show","key":"XmNkVe2qzW"}],"visibility":"show","key":"LAz1WyKpA3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Poll the API until product is ready","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q4Hc2ow1Uc"}],"identifier":"poll-the-api-until-product-is-ready","label":"Poll the API until product is ready","html_id":"poll-the-api-until-product-is-ready","implicit":true,"key":"gJ3QxatOsm"}],"key":"rpEvSQyeYk"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We request the product itself to get an update of its status.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XX1NYc2bP7"}],"key":"neqweSbXa7"}],"visibility":"show","key":"Oy3GfaWibQ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\nself_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\nitem = {}\n\nfor i in range(0, TIMEOUT, STEP):\n    print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n    response = requests.get(self_url, headers=auth_headers)\n    if response.status_code != 200:\n        print(response.content)\n    response.raise_for_status()\n    item = response.json()\n\n    storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n    if storage_tier == ONLINE_STATUS:\n        download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n        print(\"Product is ready to be downloaded.\")\n        print(f\"Asset URL: {download_url}\")\n        break\n\n    sleep(STEP)\nelse:\n    order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n    print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")\n    \n","visibility":"show","key":"z6aJSE3sVc"},{"type":"output","id":"KQM1h2pPSbDiolRrCNE2X","data":[{"name":"stdout","output_type":"stream","text":"Polling 1/300\nPolling 2/300\nPolling 3/300\nPolling 4/300\nPolling 5/300\nPolling 6/300\nPolling 7/300\nPolling 8/300\nPolling 9/300\nPolling 10/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.lumi.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_EXTREMES/5db5d129-bf27-49bf-a6f7-bb3437c8ef52/downloadLink\n"}],"visibility":"show","key":"cpOnGY761h"}],"visibility":"show","key":"cnKFqQlf3E"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BYFn5iqSeq"}],"identifier":"download","label":"Download","html_id":"download","implicit":true,"key":"ffAX6zEwZB"}],"key":"VuEVMaQFZY"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"response = requests.get(download_url, stream=True, headers=auth_headers)\nresponse.raise_for_status()\n\ncontent_disposition = response.headers.get('Content-Disposition')\ntotal_size = int(response.headers.get(\"content-length\", 0))\nif content_disposition:\n    filename = content_disposition.split('filename=')[1].strip('\"')\n    filename = unquote(filename)\nelse:\n    filename = os.path.basename(url)\n\n# Open a local file in binary write mode and write the content\nprint(f\"downloading {filename}\")\n\nwith tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n    with open(filename, 'wb') as f:\n        for data in response.iter_content(1024):\n            progress_bar.update(len(data))\n            f.write(data)","visibility":"show","key":"VWf4GYdZ4L"},{"type":"output","id":"-Dnt--jQXGcdD_MSakKxa","data":[{"name":"stdout","output_type":"stream","text":"downloading 5db5d129-bf27-49bf-a6f7-bb3437c8ef52.grib\n"},{"name":"stderr","output_type":"stream","text":"121MB [00:01, 62.7MB/s] \n"}],"visibility":"show","key":"iWpFkfyrnv"}],"visibility":"show","key":"BSwAECEHrN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IY4AW2sEQZ"}],"label":"ExtremeDT-ParameterPlotter.ipynb-EarthKit","identifier":"extremedt-parameterplotter.ipynb-earthkit","html_id":"extremedt-parameterplotter-ipynb-earthkit","key":"WN1LjdMkCV"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Lets plot the result file with ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Oy9CdLHbRB"},{"type":"link","url":"https://earthkit.readthedocs.io/en/latest/index.html","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"etKecI7lvl"}],"urlSource":"https://earthkit.readthedocs.io/en/latest/index.html","key":"yOlKbgX4rQ"},{"type":"text","value":" selecting only the Europe area in the plot.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dzKF8Q770L"}],"key":"IxetgHvCZM"}],"key":"vHezNlTvGS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data\nimport earthkit.plots\nimport earthkit.regrid\n\ndata = earthkit.data.from_source(\"file\", filename)\nearthkit.plots.quickplot(data,domain=\"Europe\")","visibility":"show","key":"QrfnfNwDyZ"},{"type":"output","id":"FRXudUQrtXxanQQvfDScB","data":[{"output_type":"execute_result","execution_count":109,"metadata":{},"data":{"text/plain":{"content":"<earthkit.plots.components.figures.Figure at 0x7f055cfab550>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1b5abe17889ca3c658fd46477c596e9c","path":"/build/1b5abe17889ca3c658fd46477c596e9c.png"},"text/plain":{"content":"<Figure size 800x700 with 4 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"dEdscSyba6"}],"visibility":"show","key":"sjeqiIewuf"}],"key":"qxiDM2rzo1"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3001"}