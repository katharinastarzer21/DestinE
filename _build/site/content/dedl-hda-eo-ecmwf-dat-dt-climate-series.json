{"version":2,"kind":"Notebook","sha256":"db9a04bdd350fa6360b922f928ee55a6f13545c78f6459d1591f4d8b96b9eb15","slug":"dedl-hda-eo-ecmwf-dat-dt-climate-series","location":"/production/HDA/DestinE_Digital_Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb","dependencies":[],"frontmatter":{"title":"Climate DT Parameter Series Plot- Data Access using DEDL HDA","subtitle":"This notebook authenticates a user with DestinE services, constructs and submits data requests to the DEDL HDA API for Climate Digital Twin projections, polls for availability, downloads GRIB data for multiple years, and visualizes it using EarthKit.","tags":["HDA","ECMWF","Authentication","Digital Twin"],"copyright":"漏 2025 EUMETSAT","authors":[{"id":" Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)","name":" Micheal Schick (EUMETSAT), Serena Avolio (EUMETSAT/Starion)"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"../../img/ECMWF.png","kernelspec":{"name":"python_dedl","display_name":"Python DEDL","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb","url":"/DEDL-HDA-EO.ECMWF.DA-b6d68ba10593b8a27584c2fc9eb513a5.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":" Launch in JupyterHub","key":"lDhakpLCG0"}],"key":"M48RP5hWVw"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb","key":"UuhIdQabnS"}],"key":"g2dI7qdRiw"}],"key":"wzEAEkMVXe"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"strong","children":[{"type":"text","value":"Prerequisites:","key":"Mv2sSe6Cs1"}],"key":"ag0LrbwDD7"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DEDL data a ","key":"BXBjuT5sFL"},{"type":"link","url":"https://platform.destine.eu/","children":[{"type":"text","value":"DestinE user account","key":"aDt2410ocf"}],"urlSource":"https://platform.destine.eu/","key":"hKL6tjaBDD"},{"type":"text","value":" is needed","key":"FBJK5xMKP2"}],"key":"NjOexGEabJ"}],"key":"g2vUgkCweb"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To search and access DT data an ","key":"X9BtFSQprf"},{"type":"link","url":"https://platform.destine.eu/support-pages/access-policy/","children":[{"type":"text","value":"upgraded access","key":"OiydQ6bb2I"}],"urlSource":"https://platform.destine.eu/support-pages/access-policy/","key":"QhpvBvZle9"},{"type":"text","value":" is needed.","key":"Jb035sGhm4"}],"key":"vWPdG712qx"}],"key":"eSiPE3V71C"}],"key":"N5iHRQVXoE"},{"type":"strong","children":[{"type":"text","value":"References:","key":"XPymAkckDG"}],"key":"IBOdBCpoMa"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","children":[{"type":"text","value":"DestinE Data Lake (DEDL) Harmonized Data Access (HDA) documentation","key":"UTn9Y8BJ9X"}],"urlSource":"https://destine-data-lake-docs.data.destination-earth.eu/en/latest/dedl-discovery-and-data-access/Use-of-Harmonized-Data-Access/Use-of-Harmonized-Data-Access.html","key":"AbmTCuUkIM"}],"key":"wwMd1kBKEG"}],"key":"esnBV7QZRM"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://destine.ecmwf.int/climate-change-adaptation-digital-twin-climate-dt/","children":[{"type":"text","value":"Climate Change Adaptation DT (Climate DT)","key":"NA7ts3X821"}],"urlSource":"https://destine.ecmwf.int/climate-change-adaptation-digital-twin-climate-dt/","key":"PWXOyBBBZZ"}],"key":"eSjJR5mXjW"}],"key":"zhqo5gBw7I"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","url":"https://confluence.ecmwf.int/display/DDCZ/Climate+DT+Phase+1+data+catalogue","children":[{"type":"text","value":"Climate DT data catalogue","key":"unTbC71rsQ"}],"urlSource":"https://confluence.ecmwf.int/display/DDCZ/Climate+DT+Phase+1+data+catalogue","key":"w4cDey33PR"}],"key":"IeCzYDhI4T"}],"key":"zquBvWaPCc"}],"key":"Bq1AtXmF2p"},{"type":"strong","children":[{"type":"text","value":"Credit:","key":"mpPJk2yWzk"}],"key":"V7MIhzhe15"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Earthkit and HDA Polytope used in this context are both packages provided by the European Centre for Medium-Range Weather Forecasts (ECMWF).","key":"wSxjlViUym"}],"key":"QLww52jHfH"}],"key":"a7fLxEwodO"}],"key":"uTdxLOPJju"}],"key":"KC4pxelkcj"}],"visibility":"show","key":"yr8yD7mqfT"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EIQwafHays"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA (Harmonized Data Access)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uIv5jhb4qr"}],"key":"T3WkR0ZvA3"},{"type":"text","value":" API to query and access Climate DT data to plot a parameter series.\nBelow the main steps covered by this tutorial.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zArW6xiMzo"}],"key":"S2ox0YznKY"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TFmo7z5DRb"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_climate-series.ipynb-setup","label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb-Setup","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-series-ipynb-setup","key":"dGpB3M746v"},{"type":"text","value":": Import the required libraries.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"kO2ikid3sN"}],"key":"dmqoRgjb2t"}],"key":"R5grNbktel"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QU1g6VZsDn"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_climate-series.ipynb-order-and-download","label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb-Order-and-Download","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-series-ipynb-order-and-download","key":"IIzPTMlaAM"},{"type":"text","value":": How to filter and download climate Dt data.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"w2XMjwATj6"}],"key":"HhoZ8SKdiN"}],"key":"Ln2Fc2IyoH"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"crossReference","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Plot","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vvjVzn7g59"}],"identifier":"dedl-hda-eo.ecmwf.dat.dt_climate-series.ipynb-earthkit","label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb-EarthKit","kind":"heading","template":"{name}","resolved":true,"html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-series-ipynb-earthkit","key":"XQXTuwLAZw"},{"type":"text","value":": How to visualize hourly data on single levels data through Earthkit.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wT6bf6KraM"}],"key":"BgQ8QEu45F"}],"key":"ZfCxUrRbFH"}],"key":"vqsz2AJLRK"}],"key":"rUysAGa1F6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HgPptugLFn"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb-Setup","identifier":"dedl-hda-eo.ecmwf.dat.dt_climate-series.ipynb-setup","html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-series-ipynb-setup","key":"WAaaHi3VtC"}],"key":"WxqB9ZQKAI"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import all the required packages.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZiQ5seW5aG"}],"key":"lvIYRk83Bg"}],"visibility":"show","key":"PkQdMTwVQL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import destinelab as deauth\nimport json\nimport datetime\nimport importlib.metadata\n\nimport requests\nfrom requests.adapters import HTTPAdapter\nfrom urllib3.util.retry import Retry\nimport os\nfrom getpass import getpass\nfrom tqdm import tqdm\nimport time\nfrom datetime import datetime\nfrom urllib.parse import unquote\nfrom time import sleep\nfrom IPython.display import JSON","visibility":"show","key":"CG33N6gdtr"},{"type":"output","id":"cCMUQ0tN7Qh0bkWQ9uawe","data":[],"visibility":"show","key":"IYn0peA2Xl"}],"visibility":"show","key":"A8EUWcAnYY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Order and Download","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"aubHnvydZL"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb-Order-and-Download","identifier":"dedl-hda-eo.ecmwf.dat.dt_climate-series.ipynb-order-and-download","html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-series-ipynb-order-and-download","key":"o5fPYlNlhp"}],"key":"ox4AvGs8QM"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Obtain Authentication Token","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BgCc06QGoW"}],"identifier":"obtain-authentication-token","label":"Obtain Authentication Token","html_id":"obtain-authentication-token","implicit":true,"key":"nd85boOFi5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To perform our request we need to be authenticated.\nBelow to request of an authentication token.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eWESDfAE8m"}],"key":"MSYBVjERfm"}],"visibility":"show","key":"xOJRWzoDcW"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"DESP_USERNAME = input(\"Please input your DESP username: \")\nDESP_PASSWORD = getpass(\"Please input your DESP password: \")\n\nauth = deauth.AuthHandler(DESP_USERNAME, DESP_PASSWORD)\naccess_token = auth.get_token()\nif access_token is not None:\n    print(\"DEDL/DESP Access Token Obtained Successfully\")\nelse:\n    print(\"Failed to Obtain DEDL/DESP Access Token\")\n\nauth_headers = {\"Authorization\": f\"Bearer {access_token}\"}","visibility":"show","key":"JUrcXo0ewK"},{"type":"output","id":"kIFLDUWLduPnm7WgziGBr","data":[{"name":"stdout","output_type":"stream","text":"Please input your DESP username:  eum-dedl-user\nPlease input your DESP password:  路路路路路路路路\n"},{"name":"stdout","output_type":"stream","text":"Response code: 200\nDEDL/DESP Access Token Obtained Successfully\n"}],"visibility":"show","key":"KBKjO8y1TA"}],"visibility":"show","key":"B7i1Nv7dhA"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check if DT access is granted","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jg8B7vxrHc"}],"identifier":"check-if-dt-access-is-granted","label":"Check if DT access is granted","html_id":"check-if-dt-access-is-granted","implicit":true,"key":"nJXpQCifdY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If DT access is not granted, you will not be able to execute the rest of the notebook.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yoQpGVINsr"}],"key":"ye8WUJBB8F"}],"visibility":"show","key":"TIdHMiicoW"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import importlib\ninstalled_version = importlib.metadata.version(\"destinelab\")\nversion_number = installed_version.split('.')[1]\nif((int(version_number) >= 8 and float(installed_version) < 1) or float(installed_version) >= 1):\n    auth.is_DTaccess_allowed(access_token)","visibility":"show","key":"VOX909Cqgd"},{"type":"output","id":"bM9zES30YA45GMYNF9Voi","data":[{"name":"stdout","output_type":"stream","text":"DT Output access allowed\n"}],"visibility":"show","key":"CsOb4nHBss"}],"visibility":"show","key":"iBPvy2GopQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HDA Endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uQINQHbVJU"}],"identifier":"hda-endpoint","label":"HDA Endpoint","html_id":"hda-endpoint","implicit":true,"key":"dVzxo1q0ou"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HDA API is based on the Spatio Temporal Asset Catalog specification (STAC), it is convenient define a costant with its endpoint.\nAnd another one with the ID of the Cliamte DT collection.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YLD3fj9Pvh"}],"key":"RawRESEeYS"}],"key":"xSZzppnnqc"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"HDA_STAC_ENDPOINT=\"https://hda.data.destination-earth.eu/stac/v2\"\nCOLLECTION_ID=\"EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION\"","visibility":"show","key":"kGB2Hm1Awx"},{"type":"output","id":"cbJrHwX0SJ3vFA5C30Uw0","data":[],"visibility":"show","key":"unoMrGKoa9"}],"visibility":"show","key":"xypjwJdqTo"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Order and download data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O8g0GbR9dR"}],"identifier":"order-and-download-data","label":"Order and download data","html_id":"order-and-download-data","implicit":true,"key":"sEl4YD1HnF"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We have to setup up a filter and define which data to obtain.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wnuf2ZDPbx"}],"key":"L7yrWUp6cr"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Search into asynchronous datasets, as the DTs are, always return a single item:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Ech3ESWAqr"}],"key":"ZxbPCzw83S"}],"key":"NzDRUN2hE7"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"datechoice = \"20280610\"\n\nfilter_params = {\n        \"ecmwf:class\": \"d1\",             # fixed \n        \"ecmwf:dataset\": \"climate-dt\",   # fixed climate-dt access\n        \"ecmwf:activity\": \"ScenarioMIP\", # activity + experiment + model (go together)\n        \"ecmwf:experiment\": \"SSP3-7.0\",  # activity + experiment + model (go together)\n        \"ecmwf:model\": \"IFS-NEMO\",       # activity + experiment + model (go together)\n        \"ecmwf:generation\": \"1\",         # fixed Specifies the generation of the dataset, which can be incremented as required (latest is 1)\n        \"ecmwf:realization\": \"1\",        # fixed Specifies the climate realization. Default 1. Based on perturbations of initial conditions\n        \"ecmwf:resolution\": \"high\",      # standard/ high \n        \"ecmwf:expver\": \"0001\",          # fixed experiment version \n        \"ecmwf:stream\": \"clte\",          # fixed climate\n        \"ecmwf:time\": \"0000\",            # choose the hourly slot(s)\n        \"ecmwf:type\": \"fc\",              # fixed forecasted fields\n        \"ecmwf:levtype\": \"sfc\",          # Surface fields (levtype=sfc), Height level fields (levtype=hl), Pressure level fields (levtype=pl), Model Level (Levtype=ml)\n#        \"levelist\": \"1/2/3/...\",  # for ml/pl/sol type data\n        \"ecmwf:param\": \"167\",             # 2m Temperature parameter\n        \"ecmwf:date\":datechoice+\"/to/\"+datechoice\n    }","visibility":"show","key":"YI7MzP3bPk"},{"type":"output","id":"qj_hwmgUu81rFEv0fZSkO","data":[],"visibility":"show","key":"k8a0gaoLhw"}],"visibility":"show","key":"ppmO2AmNwW"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define date choice and filters if needed\ndatechoice = \"2024-07-01\"\n\n# Initialize a list to store filenames\nfilenames = []\n\n# Define start and end years\nstart_year = 2024\nstart_month = 7\nend_year = 2028\n\n#timeout and step for polling (sec)\nTIMEOUT = 300\nSTEP = 1\nONLINE_STATUS = \"online\"\n\n# Loop \nfor year in range(start_year, end_year + 1):\n    # Create a datetime object \n    obsdate = datetime(year, start_month, 1)\n    datechoice = obsdate.strftime(\"%Y%m%d\")\n    filter_params[\"ecmwf:date\"]=datechoice+\"/to/\"+datechoice\n    response = requests.post(f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/order\", json=filter_params, headers=auth_headers)\n\n    if response.status_code != 200:\n        print(response.content)\n    response.raise_for_status()\n\n    ordered_item = response.json()\n\n    product_id = ordered_item[\"id\"]\n    storage_tier = ordered_item[\"properties\"].get(\"storage:tier\", \"online\")\n    order_status = ordered_item[\"properties\"].get(\"order:status\", \"unknown\")\n    federation_backend = ordered_item[\"properties\"].get(\"federation:backends\", [None])[0]\n\n    print(f\"Product ordered: {product_id}\")\n    print(f\"Provider: {federation_backend}\")\n    print(f\"Storage tier: {storage_tier} (product must have storage tier \\\"online\\\" to be downloadable)\")\n    print(f\"Order status: {order_status}\")      \n\n    self_url = f\"{HDA_STAC_ENDPOINT}/collections/{COLLECTION_ID}/items/{product_id}\"\n    item = {}\n\n    for i in range(0, TIMEOUT, STEP):\n        print(f\"Polling {i + 1}/{TIMEOUT // STEP}\")\n\n        response = requests.get(self_url, headers=auth_headers)\n        if response.status_code != 200:\n            print(response.content)\n        response.raise_for_status()\n        item = response.json()\n\n        storage_tier = item[\"properties\"].get(\"storage:tier\", ONLINE_STATUS)\n\n        if storage_tier == ONLINE_STATUS:\n            download_url = item[\"assets\"][\"downloadLink\"][\"href\"]\n            print(\"Product is ready to be downloaded.\")\n            print(f\"Asset URL: {download_url}\")\n            break\n        sleep(STEP)\n    else:\n        order_status = item[\"properties\"].get(\"order:status\", \"unknown\")\n        print(f\"We could not download the product after {TIMEOUT // STEP} tries. Current order status is {order_status}\")\n    \n    response = requests.get(download_url, stream=True, headers=auth_headers)\n    response.raise_for_status()\n\n    content_disposition = response.headers.get('Content-Disposition')\n    total_size = int(response.headers.get(\"content-length\", 0))\n    if content_disposition:\n        filename = content_disposition.split('filename=')[1].strip('\"')\n        filename = unquote(filename)\n    else:\n        filename = os.path.basename(url)\n\n    # Open a local file in binary write mode and write the content\n    print(f\"downloading {filename}\")\n\n    with tqdm(total=total_size, unit=\"B\", unit_scale=True) as progress_bar:\n        with open(filename, 'wb') as f:\n            for data in response.iter_content(1024):\n                progress_bar.update(len(data))\n                f.write(data)\n               \n    # Add the filename to the list\n    filenames.append(filename)","visibility":"show","key":"bNG5ZVeXm7"},{"type":"output","id":"TtoaaHuBlhZoV0ssZHjkQ","data":[{"name":"stdout","output_type":"stream","text":"Product ordered: 704ae6fe-01aa-4bcf-9908-1e92d41c9861\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\nPolling 1/300\nPolling 2/300\nPolling 3/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/704ae6fe-01aa-4bcf-9908-1e92d41c9861/downloadLink\ndownloading 704ae6fe-01aa-4bcf-9908-1e92d41c9861.grib\n"},{"name":"stderr","output_type":"stream","text":"26.2MB [00:00, 58.0MB/s]\n"},{"name":"stdout","output_type":"stream","text":"Product ordered: 79aa0e44-0d20-467e-a6fe-c50d345a5f7b\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\nPolling 1/300\nPolling 2/300\nPolling 3/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/79aa0e44-0d20-467e-a6fe-c50d345a5f7b/downloadLink\ndownloading 79aa0e44-0d20-467e-a6fe-c50d345a5f7b.grib\n"},{"name":"stderr","output_type":"stream","text":"24.6MB [00:02, 11.0MB/s]\n"},{"name":"stdout","output_type":"stream","text":"Product ordered: 362b41cd-1ade-417c-9a46-94c45b3e1c46\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\nPolling 1/300\nPolling 2/300\nPolling 3/300\nPolling 4/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/362b41cd-1ade-417c-9a46-94c45b3e1c46/downloadLink\ndownloading 362b41cd-1ade-417c-9a46-94c45b3e1c46.grib\n"},{"name":"stderr","output_type":"stream","text":"26.2MB [00:00, 59.0MB/s]\n"},{"name":"stdout","output_type":"stream","text":"Product ordered: 9524d2ca-a265-4a74-9b7f-f4353eb082aa\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\nPolling 1/300\nPolling 2/300\nPolling 3/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/9524d2ca-a265-4a74-9b7f-f4353eb082aa/downloadLink\ndownloading 9524d2ca-a265-4a74-9b7f-f4353eb082aa.grib\n"},{"name":"stderr","output_type":"stream","text":"26.2MB [00:01, 17.7MB/s]\n"},{"name":"stdout","output_type":"stream","text":"Product ordered: 504321d7-37c6-40d1-be4e-ba5fc7afb9ce\nProvider: dedt_lumi\nStorage tier: offline (product must have storage tier \"online\" to be downloadable)\nOrder status: shipping\nPolling 1/300\nPolling 2/300\nPolling 3/300\nProduct is ready to be downloaded.\nAsset URL: https://hda-download.central.data.destination-earth.eu/data/dedt_lumi/EO.ECMWF.DAT.DT_CLIMATE_ADAPTATION/504321d7-37c6-40d1-be4e-ba5fc7afb9ce/downloadLink\ndownloading 504321d7-37c6-40d1-be4e-ba5fc7afb9ce.grib\n"},{"name":"stderr","output_type":"stream","text":"26.3MB [00:00, 54.5MB/s]\n"}],"visibility":"show","key":"dVIFP1ZAyS"}],"visibility":"show","key":"KAVQAlskuM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"o4ojXSU08b"}],"label":"DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.ipynb-EarthKit","identifier":"dedl-hda-eo.ecmwf.dat.dt_climate-series.ipynb-earthkit","html_id":"dedl-hda-eo-ecmwf-dat-dt-climate-series-ipynb-earthkit","key":"CJEsMtPF8z"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Lets plot the result file with ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"H2mXRmBIaC"},{"type":"link","url":"https://earthkit.readthedocs.io/en/latest/index.html","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"EarthKit","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"P7vRg9V5Kr"}],"urlSource":"https://earthkit.readthedocs.io/en/latest/index.html","key":"beUwHVUe3K"},{"type":"text","value":" selecting only the Europe area in the plot.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"b54WBdcQpy"}],"key":"SOnmcoXfoU"}],"key":"q85yWjalca"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import earthkit.data\nimport earthkit.plots\nimport earthkit.regrid","visibility":"show","key":"rWQfHxCb0N"},{"type":"output","id":"vf63jBc_QgSAKRZWALdqS","data":[],"visibility":"show","key":"i8RmgcIl41"}],"visibility":"show","key":"kIzC6uEY9g"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Iterate over filenames\nfor filename in filenames:\n    print(filename)  # For example, print each filename\n    data = earthkit.data.from_source(\"file\", filename)\n    earthkit.plots.quickplot(data)\n","visibility":"show","key":"ADQZ4eFs7L"},{"type":"output","id":"P8bws4C-MkgUr1n7wj9v3","data":[{"name":"stdout","output_type":"stream","text":"704ae6fe-01aa-4bcf-9908-1e92d41c9861.grib\n79aa0e44-0d20-467e-a6fe-c50d345a5f7b.grib\n362b41cd-1ade-417c-9a46-94c45b3e1c46.grib\n9524d2ca-a265-4a74-9b7f-f4353eb082aa.grib\n504321d7-37c6-40d1-be4e-ba5fc7afb9ce.grib\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9e8d0d93d2c7ad1d9f7d85c3a0cad773","path":"/9e8d0d93d2c7ad1d9f7d85c3a0cad773.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"27b08326a2c2d3506c988c11abb6f511","path":"/27b08326a2c2d3506c988c11abb6f511.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e57ebd36b3b6cf80d3c74408f76cfe9f","path":"/e57ebd36b3b6cf80d3c74408f76cfe9f.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"31bff3c2e75af544eaa21decc5cf6dc3","path":"/31bff3c2e75af544eaa21decc5cf6dc3.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2a19973285cc70b2a0bd6dcbfaf7dba9","path":"/2a19973285cc70b2a0bd6dcbfaf7dba9.png"},"text/plain":{"content":"<Figure size 800x700 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"UMam2mB9p6"}],"visibility":"show","key":"OFnXSPLYZy"}],"key":"JVDEprZlVI"},"references":{"cite":{"order":[],"data":{}}}}