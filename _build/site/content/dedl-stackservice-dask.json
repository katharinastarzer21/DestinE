{"version":2,"kind":"Notebook","sha256":"f7d0138c2b6babc8dc19134e0f262f68a79f13f171125329eabbdd8f451bf1e7","slug":"dedl-stackservice-dask","location":"/production/STACK/DEDL_StackService_Dask.ipynb","dependencies":[],"frontmatter":{"title":"STACK Service Dask","subtitle":"This notebook introduces authentication and multi-cluster management using the DEDL Stack client with OIDC, enabling users to securely spawn, monitor, and scale Dask clusters across Central and LUMI locations within the DestinE Data Lake.","tags":["STACK","Dask","GFM"],"copyright":"Â© 2024 EUMETSAT","authors":[{"id":"Author: Eumetsat","name":"Author: Eumetsat"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/dask-55232318e36306007797c96fb8ae0744.png","kernelspec":{"name":"python3","display_name":"dedl","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"DEDL_StackService_Dask.ipynb","url":"/DEDL_StackService_Da-f81f94b9151b6d16cb11fd21057b45b4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"margin":"6px 0"},"children":[{"type":"link","style":{"textDecoration":"none"},"url":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/STACK/DEDL_StackService_Dask.ipynb","children":[{"type":"span","class":"launch","children":[{"type":"text","value":"ðŸš€ Launch in JupyterHub","key":"rbnl6TvCmJ"}],"key":"XZqjsGRruC"}],"urlSource":"https://jupyter.central.data.destination-earth.eu/user-redirect/lab/tree/DestinE-DataLake-Lab/STACK/DEDL_StackService_Dask.ipynb","key":"tU4eTvMQGw"}],"key":"UGeD0ItM6f"}],"key":"hAOlq3Ek8A"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Authentication via OIDC password grant flow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SUbTakbEXy"}],"identifier":"authentication-via-oidc-password-grant-flow","label":"Authentication via OIDC password grant flow","html_id":"authentication-via-oidc-password-grant-flow","implicit":true,"key":"EIQ0u0pu5p"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The DEDL Stack client library holds the DaskOIDC class as a helper class to authenticate a user against the given identity provider of DestinE Data Lake.\nThe users password is directly handed over to the request object and is not stored.\nRefreshed token is used to request a new access token in case it is expired.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fspy1TKGv0"}],"key":"TKJDg1KYPB"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The DaskMultiCluster class provides an abstraction layer to spawn multiple Dask clusters, one per location, within the data lake. Each cluster will be composed of 2 workers per default, with adaptive scaling enabled towards a maximum of 10 workers. In addition, the workers are configured to have 2 cores and 2 GB RAM per default. This can be changed via the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FawEGDrALY"},{"type":"link","url":"https://gateway.dask.org/cluster-options.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"cluster options","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GfY1lzoBCI"}],"urlSource":"https://gateway.dask.org/cluster-options.html","key":"HYh2ObVNAh"},{"type":"text","value":" exposed up to the given service quota of the individual user role:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mOm5kHcY2S"}],"key":"IS1jdOieY0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Worker cores:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"y3uWJfXzDw"}],"key":"yopcKR24y4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"min: 1","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"H5urMrZZkt"}],"key":"kv74GJHxEi"}],"key":"IEzU0ICj0a"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"max: ..::service-quota::..","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"q84RdKOZqh"}],"key":"q9z54Z86EZ"}],"key":"eq2xpGbsmI"}],"key":"bdiAfbW6Jz"}],"key":"mgEJCzv95W"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Worker memory:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"xiT0rzMIw7"}],"key":"cNtK8JqLVP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"min: 1 GB","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"vUIHjwULiM"}],"key":"OuFwnjCzjx"}],"key":"Z2Rvx7TPIf"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"max: ..::service-quota::.. GB","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"PqxdIIAxGw"}],"key":"uvo08MMJdt"}],"key":"uGVR35UrNW"}],"key":"H4iLqzJMbr"}],"key":"zm6mUGg9KT"}],"key":"cFYCaqQ6kR"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Dask Worker and Scheduler nodes are based on a custom build ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"CFPmsQKPjo"},{"type":"link","url":"registry.eodc.eu/eodc/clusters/dedl-deployment/dedl-dask","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"container image","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"jTHX8sDHmb"}],"urlSource":"registry.eodc.eu/eodc/clusters/dedl-deployment/dedl-dask","key":"dfWfmIEETK"},{"type":"text","value":" with the aim to match the environment, Jupyter Kernel, of the DEDL JupyterLab instance. Warnings will be displayed if a version missmatch is detected. Feel free to use your custom image to run your workloads by replacing the container image in the cluster options object.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"xmEpysOihU"}],"key":"sJgyibWYPP"}],"visibility":"show","key":"iQEBCwR9IB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from dedl_stack_client.authn import DaskOIDC\nfrom dedl_stack_client.dask import DaskMultiCluster\nfrom rich.prompt import Prompt\n\nmyAuth = DaskOIDC(username=Prompt.ask(prompt=\"Username\"))\nmyDEDLClusters = DaskMultiCluster(auth=myAuth)\nmyDEDLClusters.new_cluster()","key":"zAZm2bHDJ8"},{"type":"output","id":"64fS3xeBNYEWOrBbzYKRq","data":[],"key":"fjM5ZJ26kD"}],"key":"Sa35z7fYUn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Print the given client object details per location as well as the link to the Dask dashboard.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hVdXNIei8l"}],"key":"x9DayzvVI7"}],"key":"ycjTmFGT2U"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"with myDEDLClusters.as_current(location=\"central\") as myclient:\n    print(myclient)\n    print(myclient.dashboard_link)\nwith myDEDLClusters.as_current(location=\"lumi\") as myclient:\n    print(myclient)\n    print(myclient.dashboard_link)","visibility":"show","key":"sUZtmMyR39"},{"type":"output","id":"GsL1-ttrgTutWVJ5gYjIJ","data":[],"visibility":"show","key":"d3f0KqDvGu"}],"visibility":"show","key":"IsHIPsiQqc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shutdown the all clusters and free up all resources","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Bs8n5SPD1r"}],"identifier":"shutdown-the-all-clusters-and-free-up-all-resources","label":"Shutdown the all clusters and free up all resources","html_id":"shutdown-the-all-clusters-and-free-up-all-resources","implicit":true,"key":"f6cbKian4D"}],"key":"pXMKyhQthQ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"myDEDLClusters.shutdown()","visibility":"show","key":"gSj8EIJJUN"},{"type":"output","id":"70X2Ev5MWyHWqdoFhqUB-","data":[],"visibility":"show","key":"TT1o5kxiXE"}],"visibility":"show","key":"f1cjnMJzHF"}],"key":"OelbIU7dsc"},"references":{"cite":{"order":[],"data":{}}}}